(function(){UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu;window.UE=baidu.editor=window.UE||{};UE.plugins={};UE.commands={};UE.instants={};UE.I18N={};UE._customizeUI={};UE.version="1.4.3";var dom=UE.dom={};var browser=UE.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,i={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"};i.gecko=navigator.product=="Gecko"&&!i.webkit&&!i.opera&&!i.ie;var n=0;if(i.ie){var r=e.match(/(?:msie\s([\w.]+))/);var o=e.match(/(?:trident.*rv:([\w.]+))/);if(r&&o&&r[1]&&o[1]){n=Math.max(r[1]*1,o[1]*1)}else if(r&&r[1]){n=r[1]*1}else if(o&&o[1]){n=o[1]*1}else{n=0}i.ie11Compat=document.documentMode==11;i.ie9Compat=document.documentMode==9;i.ie8=!!document.documentMode;i.ie8Compat=document.documentMode==8;i.ie7Compat=n==7&&!document.documentMode||document.documentMode==7;i.ie6Compat=n<7||i.quirks;i.ie9above=n>8;i.ie9below=n<9;i.ie11above=n>10;i.ie11below=n<11}if(i.gecko){var a=e.match(/rv:([\d\.]+)/);if(a){a=a[1].split(".");n=a[0]*1e4+(a[1]||0)*100+(a[2]||0)*1}}if(/chrome\/(\d+\.\d)/i.test(e)){i.chrome=+RegExp["$1"]}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)){i.safari=+(RegExp["$1"]||RegExp["$2"])}if(i.opera)n=parseFloat(t.version());if(i.webkit)n=parseFloat(e.match(/ applewebkit\/(\d+)/)[1]);i.version=n;i.isCompatible=!i.mobile&&(i.ie&&n>=6||i.gecko&&n>=10801||i.opera&&n>=9.5||i.air&&n>=1||i.webkit&&n>=522||false);return i}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UE.utils={each:function(e,t,i){if(e==null)return;if(e.length===+e.length){for(var n=0,r=e.length;n<r;n++){if(t.call(i,e[n],n,e)===false)return false}}else{for(var o in e){if(e.hasOwnProperty(o)){if(t.call(i,e[o],o,e)===false)return false}}}},makeInstance:function(e){var t=new Function;t.prototype=e;e=new t;t.prototype=null;return e},extend:function(e,t,i){if(t){for(var n in t){if(!i||!e.hasOwnProperty(n)){e[n]=t[n]}}}return e},extend2:function(e){var t=arguments;for(var i=1;i<t.length;i++){var n=t[i];for(var r in n){if(!e.hasOwnProperty(r)){e[r]=n[r]}}}return e},inherits:function(e,t){var i=e.prototype,n=utils.makeInstance(t.prototype);utils.extend(n,i,true);e.prototype=n;return n.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,i){var n;return function(){if(i){clearTimeout(n)}n=setTimeout(e,t)}},indexOf:function(e,t,i){var n=-1;i=this.isNumber(i)?i:0;this.each(e,function(e,r){if(r>=i&&e===t){n=r;return false}});return n},removeItem:function(e,t){for(var i=0,n=e.length;i<n;i++){if(e[i]===t){e.splice(i,1);i--}}},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t=0,i,n={};i=e[t++];){n[i.toUpperCase()]=n[i]=1}return n},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(e,t){if(t){return e}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}}):""},unhtmlForUrl:function(e,t){return e?e.replace(t||/[<">']/g,function(e){return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={float:e.cssFloat!=undefined?"cssFloat":e.styleFloat!=undefined?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){var e=[];function t(t,i){try{for(var n=0,r;r=e[n++];){if(r.doc===t&&r.url==(i.src||i.href)){return r}}}catch(e){return null}}return function(i,n,r){var o=t(i,n);if(o){if(o.ready){r&&r()}else{o.funs.push(r)}return}e.push({doc:i,url:n.src||n.href,funs:[r]});if(!i.body){var a=[];for(var s in n){if(s=="tag")continue;a.push(s+'="'+n[s]+'"')}i.write("<"+n.tag+" "+a.join(" ")+" ></"+n.tag+">");return}if(n.id&&i.getElementById(n.id)){return}var l=i.createElement(n.tag);delete n.tag;for(var s in n){l.setAttribute(s,n[s])}l.onload=l.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){o=t(i,n);if(o.funs.length>0){o.ready=1;for(var e;e=o.funs.pop();){e()}}l.onload=l.onreadystatechange=null}};l.onerror=function(){throw Error("The load "+(n.href||n.src)+" fails,check the url settings of file ueditor.config.js ")};i.getElementsByTagName("head")[0].appendChild(l)}}(),isEmptyObject:function(e){if(e==null)return true;if(this.isArray(e)||this.isString(e))return e.length===0;for(var t in e)if(e.hasOwnProperty(t))return false;return true},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var i=t.split(",");if(i.length>3)return"";t="#";for(var n=0,r;r=i[n++];){r=parseInt(r.replace(/[^\d]/gi,""),10).toString(16);t+=r.length==1?"0"+r:r}t=t.toUpperCase()}return t},optCss:function(e){var t,i,n;e=e.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(e,n,r,o){if(o.split(" ").length==1){switch(n){case"padding":!t&&(t={});t[r]=o;return"";case"margin":!i&&(i={});i[r]=o;return"";case"border":return o=="initial"?"":e}}return e});function r(e,t){if(!e){return""}var i=e.top,n=e.bottom,r=e.left,o=e.right,a="";if(!i||!r||!n||!o){for(var s in e){a+=";"+t+"-"+s+":"+e[s]+";"}}else{a+=";"+t+":"+(i==n&&n==r&&r==o?i:i==n&&r==o?i+" "+r:r==o?i+" "+r+" "+n:i+" "+o+" "+n+" "+r)+";"}return a}e+=r(t,"padding")+r(i,"margin");return e.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(e,t){return t?t+";;":";"})},clone:function(e,t){var i;t=t||{};for(var n in e){if(e.hasOwnProperty(n)){i=e[n];if(typeof i=="object"){t[n]=utils.isArray(i)?[]:{};utils.clone(e[n],t[n])}else{t[n]=i}}}return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e)){return e}var t;e.replace(/([\d.]+)(\w+)/,function(i,n,r){e=n;t=r});switch(t){case"cm":e=parseFloat(e)*25;break;case"pt":e=Math.round(parseFloat(e)*96/72)}return e+(e?"px":"")},domReady:function(){var e=[];function t(t){t.isReady=true;for(var i;i=e.pop();i()){}}return function(i,n){n=n||window;var r=n.document;i&&e.push(i);if(r.readyState==="complete"){t(r)}else{r.isReady&&t(r);if(browser.ie&&browser.version!=11){(function(){if(r.isReady)return;try{r.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}t(r)})();n.attachEvent("onload",function(){t(r)})}else{r.addEventListener("DOMContentLoaded",function(){r.removeEventListener("DOMContentLoaded",arguments.callee,false);t(r)},false);n.addEventListener("load",function(){t(r)},false)}}}}(),cssRule:browser.ie&&browser.version!=11?function(e,t,i){var n,r;if(t===undefined||t&&t.nodeType&&t.nodeType==9){i=t&&t.nodeType&&t.nodeType==9?t:i||document;n=i.indexList||(i.indexList={});r=n[e];if(r!==undefined){return i.styleSheets[r].cssText}return undefined}i=i||document;n=i.indexList||(i.indexList={});r=n[e];if(t===""){if(r!==undefined){i.styleSheets[r].cssText="";delete n[e];return true}return false}if(r!==undefined){sheetStyle=i.styleSheets[r]}else{sheetStyle=i.createStyleSheet("",r=i.styleSheets.length);n[e]=r}sheetStyle.cssText=t}:function(e,t,i){var n,r;if(t===undefined||t&&t.nodeType&&t.nodeType==9){i=t&&t.nodeType&&t.nodeType==9?t:i||document;r=i.getElementById(e);return r?r.innerHTML:undefined}i=i||document;r=i.getElementById(e);if(t===""){if(r){r.parentNode.removeChild(r);return true}return false}if(r){r.innerHTML=t}else{r=i.createElement("style");r.id=e;r.innerHTML=t;i.getElementsByTagName("head")[0].appendChild(r)}},sort:function(e,t){t=t||function(e,t){return e.localeCompare(t)};for(var i=0,n=e.length;i<n;i++){for(var r=i,o=e.length;r<o;r++){if(t(e[i],e[r])>0){var a=e[i];e[i]=e[r];e[r]=a}}}return e},serializeParam:function(e){var t=[];for(var i in e){if(i=="method"||i=="timeout"||i=="async")continue;if(!((typeof e[i]).toLowerCase()=="function"||(typeof e[i]).toLowerCase()=="object")){t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]))}else if(utils.isArray(e[i])){for(var n=0;n<e[i].length;n++){t.push(encodeURIComponent(i)+"[]="+encodeURIComponent(e[i][n]))}}}return t.join("&")},formatUrl:function(e){var t=e.replace(/&&/g,"&");t=t.replace(/\?&/g,"?");t=t.replace(/&$/g,"");t=t.replace(/&#/g,"#");t=t.replace(/&+/g,"&");return t},isCrossDomainUrl:function(e){var t=document.createElement("a");t.href=e;if(browser.ie){t.href=t.href}return!(t.protocol==location.protocol&&t.hostname==location.hostname&&(t.port==location.port||t.port=="80"&&location.port==""||t.port==""&&location.port=="80"))},clearEmptyAttrs:function(e){for(var t in e){if(e[t]===""){delete e[t]}}return e},str2json:function(e){if(!utils.isString(e))return null;if(window.JSON){return JSON.parse(e)}else{return new Function("return "+utils.trim(e||""))()}},json2str:function(){if(window.JSON){return JSON.stringify}else{var e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function t(t){if(/["\\\x00-\x1f]/.test(t)){t=t.replace(/["\\\x00-\x1f]/g,function(t){var i=e[t];if(i){return i}i=t.charCodeAt();return"\\u00"+Math.floor(i/16).toString(16)+(i%16).toString(16)})}return'"'+t+'"'}function i(e){var t=["["],i=e.length,n,r,o;for(r=0;r<i;r++){o=e[r];switch(typeof o){case"undefined":case"function":case"unknown":break;default:if(n){t.push(",")}t.push(utils.json2str(o));n=1}}t.push("]");return t.join("")}function n(e){return e<10?"0"+e:e}function r(e){return'"'+e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+'"'}return function(e){switch(typeof e){case"undefined":return"undefined";case"number":return isFinite(e)?String(e):"null";case"string":return t(e);case"boolean":return String(e);default:if(e===null){return"null"}else if(utils.isArray(e)){return i(e)}else if(utils.isDate(e)){return r(e)}else{var n=["{"],o=utils.json2str,a,s;for(var l in e){if(Object.prototype.hasOwnProperty.call(e,l)){s=e[l];switch(typeof s){case"undefined":case"unknown":case"function":break;default:if(a){n.push(",")}a=1;n.push(o(l)+":"+o(s))}}}n.push("}");return n.join("")}}}}}()};utils.each(["String","Function","Array","Number","RegExp","Object","Date"],function(e){UE.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(/\s+/);for(var i=0,n;n=e[i++];){getListener(this,n,true).push(t)}},on:function(e,t){return this.addListener(e,t)},off:function(e,t){return this.removeListener(e,t)},trigger:function(){return this.fireEvent.apply(this,arguments)},removeListener:function(e,t){e=utils.trim(e).split(/\s+/);for(var i=0,n;n=e[i++];){utils.removeItem(getListener(this,n)||[],t)}},fireEvent:function(){var e=arguments[0];e=utils.trim(e).split(" ");for(var t=0,i;i=e[t++];){var n=getListener(this,i),r,o,a;if(n){a=n.length;while(a--){if(!n[a])continue;o=n[a].apply(this,arguments);if(o===true){return o}if(o!==undefined){r=o}}}if(o=this["on"+i.toLowerCase()]){r=o.apply(this,arguments)}}return r}};function getListener(e,t,i){var n;t=t.toLowerCase();return(n=e.__allListeners||i&&(e.__allListeners={}))&&(n[t]||i&&(n[t]=[]))}var dtd=dom.dtd=function(){function e(e){for(var t in e){e[t.toUpperCase()]=e[t]}return e}var t=utils.extend2;var i=e({isindex:1,fieldset:1}),n=e({input:1,button:1,select:1,textarea:1,label:1}),r=t(e({a:1}),n),o=t({iframe:1},r),a=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),s=e({ins:1,del:1,script:1,style:1}),l=t(e({b:1,acronym:1,bdo:1,var:1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),s),d=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),l),u=t(e({p:1}),d),c=t(e({iframe:1}),d,n),f=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,var:1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),m=t(e({a:0}),c),h=e({tr:1}),p=e({"#":1}),g=t(e({param:1}),f),v=t(e({form:1}),i,o,a,u),b=e({li:1,ol:1,ul:1}),y=e({style:1,script:1}),C=e({base:1,link:1,meta:1,title:1}),w=t(C,y),N=e({head:1,body:1}),x=e({html:1});var U=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),E=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(x,N,C),$block:U,$inline:m,$inlineWithA:t(e({a:1}),m),$body:t(e({script:1,style:1}),U),$cdata:e({script:1,style:1}),$empty:E,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:N,head:w,style:p,script:p,body:v,base:{},link:{},meta:{},title:p,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:v,td:v,br:{},th:v,center:v,kbd:m,button:t(u,a),basefont:{},h5:m,h4:m,samp:m,h6:m,ol:b,h1:m,h3:m,option:p,h2:m,form:t(i,o,a,u),select:e({optgroup:1,option:1}),font:m,ins:m,menu:b,abbr:m,label:m,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:m,tfoot:h,cite:m,li:v,input:{},iframe:v,strong:m,textarea:p,noframes:v,big:m,small:m,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:m,dt:m,sub:m,optgroup:e({option:1}),param:{},bdo:m,var:m,div:v,object:g,sup:m,dd:v,strike:m,area:{},dir:b,map:t(e({area:1,form:1,p:1}),i,s,a),applet:g,dl:e({dt:1,dd:1}),del:m,isindex:{},fieldset:t(e({legend:1}),f),thead:h,ul:b,acronym:m,b:m,a:t(e({a:1}),c),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),v),caption:m,i:m,u:m,tbody:h,s:m,address:t(o,u),tt:m,legend:m,q:m,pre:t(l,r),p:t(e({a:1}),m),em:m,dfn:m})}();function getDomNode(e,t,i,n,r,o){var a=n&&e[t],s;!a&&(a=e[i]);while(!a&&(s=(s||e).parentNode)){if(s.tagName=="BODY"||o&&!o(s)){return null}a=s[i]}if(a&&r&&!r(a)){return getDomNode(a,t,i,false,r)}return a}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(e,t){if(e===t){return 0}var i,n=[e],r=[t];i=e;while(i=i.parentNode){if(i===t){return 10}n.push(i)}i=t;while(i=i.parentNode){if(i===e){return 20}r.push(i)}n.reverse();r.reverse();if(n[0]!==r[0]){return 1}var o=-1;while(o++,n[o]===r[o]){}e=n[o];t=r[o];while(e=e.nextSibling){if(e===t){return 4}}return 2},getNodeIndex:function(e,t){var i=e,n=0;while(i=i.previousSibling){if(t&&i.nodeType==3){if(i.nodeType!=i.nextSibling.nodeType){n++}continue}n++}return n},inDoc:function(e,t){return domUtils.getPosition(e,t)==10},findParent:function(e,t,i){if(e&&!domUtils.isBody(e)){e=i?e:e.parentNode;while(e){if(!t||t(e)||domUtils.isBody(e)){return t&&!t(e)&&domUtils.isBody(e)?null:e}e=e.parentNode}}return null},findParentByTagName:function(e,t,i,n){t=utils.listToMap(utils.isArray(t)?t:[t]);return domUtils.findParent(e,function(e){return t[e.tagName]&&!(n&&n(e))},i)},findParents:function(e,t,i,n){var r=t&&(i&&i(e)||!i)?[e]:[];while(e=domUtils.findParent(e,i)){r.push(e)}return n?r:r.reverse()},insertAfter:function(e,t){return e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},remove:function(e,t){var i=e.parentNode,n;if(i){if(t&&e.hasChildNodes()){while(n=e.firstChild){i.insertBefore(n,e)}}i.removeChild(e)}return e},getNextDomNode:function(e,t,i,n){return getDomNode(e,"firstChild","nextSibling",t,i,n)},getPreDomNode:function(e,t,i,n){return getDomNode(e,"lastChild","previousSibling",t,i,n)},isBookmarkNode:function(e){return e.nodeType==1&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;var i=[e],n=[t],r=e,o=-1;while(r=r.parentNode){if(r===t){return r}i.push(r)}r=t;while(r=r.parentNode){if(r===e)return r;n.push(r)}i.reverse();n.reverse();while(o++,i[o]===n[o]){}return o==0?null:i[o-1]},clearEmptySibling:function(e,t,i){function n(e,t){var i;while(e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(e.nodeValue))){i=e[t];domUtils.remove(e);e=i}}!t&&n(e.nextSibling,"nextSibling");!i&&n(e.previousSibling,"previousSibling")},split:function(e,t){var i=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var n=i.createTextNode("");return domUtils.insertAfter(e,n)}var r=e.splitText(t);if(browser.ie8){var o=i.createTextNode("");domUtils.insertAfter(r,o);domUtils.remove(o)}return r},isWhitespace:function(e){return!new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(e.nodeValue)},getXY:function(e){var t=0,i=0;while(e.offsetParent){i+=e.offsetTop;t+=e.offsetLeft;e=e.offsetParent}return{x:t,y:i}},on:function(e,t,i){var n=utils.isArray(t)?t:utils.trim(t).split(/\s+/),r=n.length;if(r)while(r--){t=n[r];if(e.addEventListener){e.addEventListener(t,i,false)}else{if(!i._d){i._d={els:[]}}var o=t+i.toString(),a=utils.indexOf(i._d.els,e);if(!i._d[o]||a==-1){if(a==-1){i._d.els.push(e)}if(!i._d[o]){i._d[o]=function(e){return i.call(e.srcElement,e||window.event)}}e.attachEvent("on"+t,i._d[o])}}}e=null},un:function(e,t,i){var n=utils.isArray(t)?t:utils.trim(t).split(/\s+/),r=n.length;if(r)while(r--){t=n[r];if(e.removeEventListener){e.removeEventListener(t,i,false)}else{var o=t+i.toString();try{e.detachEvent("on"+t,i._d?i._d[o]:i)}catch(e){}if(i._d&&i._d[o]){var a=utils.indexOf(i._d.els,e);if(a!=-1){i._d.els.splice(a,1)}i._d.els.length==0&&delete i._d[o]}}}},isSameElement:function(e,t){if(e.tagName!=t.tagName){return false}var i=e.attributes,n=t.attributes;if(!ie&&i.length!=n.length){return false}var r,o,a=0,s=0;for(var l=0;r=i[l++];){if(r.nodeName=="style"){if(r.specified){a++}if(domUtils.isSameStyle(e,t)){continue}else{return false}}if(ie){if(r.specified){a++;o=n.getNamedItem(r.nodeName)}else{continue}}else{o=t.attributes[r.nodeName]}if(!o.specified||r.nodeValue!=o.nodeValue){return false}}if(ie){for(l=0;o=n[l++];){if(o.specified){s++}}if(a!=s){return false}}return true},isSameStyle:function(e,t){var i=e.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),n=t.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){i=e.style;n=t.style;if(i.length!=n.length)return false;for(var r in i){if(/^(\d+|csstext)$/i.test(r)){continue}if(i[r]!=n[r]){return false}}return true}if(!i||!n){return i==n}i=i.split(";");n=n.split(";");if(i.length!=n.length){return false}for(var o=0,a;a=i[o++];){if(utils.indexOf(n,a)==-1){return false}}return true},isBlockElm:function(e){return e.nodeType==1&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},isBody:function(e){return e&&e.nodeType==1&&e.tagName.toLowerCase()=="body"},breakParent:function(e,t){var i,n=e,r=e,o,a;do{n=n.parentNode;if(o){i=n.cloneNode(false);i.appendChild(o);o=i;i=n.cloneNode(false);i.appendChild(a);a=i}else{o=n.cloneNode(false);a=o.cloneNode(false)}while(i=r.previousSibling){o.insertBefore(i,o.firstChild)}while(i=r.nextSibling){a.appendChild(i)}r=n}while(t!==n);i=t.parentNode;i.insertBefore(o,t);i.insertBefore(a,t);i.insertBefore(e,a);domUtils.remove(t);return e},isEmptyInlineElement:function(e){if(e.nodeType!=1||!dtd.$removeEmpty[e.tagName]){return 0}e=e.firstChild;while(e){if(domUtils.isBookmarkNode(e)){return 0}if(e.nodeType==1&&!domUtils.isEmptyInlineElement(e)||e.nodeType==3&&!domUtils.isWhitespace(e)){return 0}e=e.nextSibling}return 1},trimWhiteTextNode:function(e){function t(t){var i;while((i=e[t])&&i.nodeType==3&&domUtils.isWhitespace(i)){e.removeChild(i)}}t("firstChild");t("lastChild")},mergeChild:function(e,t,i){var n=domUtils.getElementsByTagName(e,e.tagName.toLowerCase());for(var r=0,o;o=n[r++];){if(!o.parentNode||domUtils.isBookmarkNode(o)){continue}if(o.tagName.toLowerCase()=="span"){if(e===o.parentNode){domUtils.trimWhiteTextNode(e);if(e.childNodes.length==1){e.style.cssText=o.style.cssText+";"+e.style.cssText;domUtils.remove(o,true);continue}}o.style.cssText=e.style.cssText+";"+o.style.cssText;if(i){var a=i.style;if(a){a=a.split(";");for(var s=0,l;l=a[s++];){o.style[utils.cssStyleToDomStyle(l.split(":")[0])]=l.split(":")[1]}}}if(domUtils.isSameStyle(o,e)){domUtils.remove(o,true)}continue}if(domUtils.isSameElement(e,o)){domUtils.remove(o,true)}}},getElementsByTagName:function(e,t,i){if(i&&utils.isString(i)){var n=i;i=function(e){return domUtils.hasClass(e,n)}}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");var r=[];for(var o=0,a;a=t[o++];){var s=e.getElementsByTagName(a);for(var l=0,d;d=s[l++];){if(!i||i(d))r.push(d)}}return r},mergeToParent:function(e){var t=e.parentNode;while(t&&dtd.$removeEmpty[t.tagName]){if(t.tagName==e.tagName||t.tagName=="A"){domUtils.trimWhiteTextNode(t);if(t.tagName=="SPAN"&&!domUtils.isSameStyle(t,e)||t.tagName=="A"&&e.tagName=="SPAN"){if(t.childNodes.length>1||t!==e.parentNode){e.style.cssText=t.style.cssText+";"+e.style.cssText;t=t.parentNode;continue}else{t.style.cssText+=";"+e.style.cssText;if(t.tagName=="A"){t.style.textDecoration="underline"}}}if(t.tagName!="A"){t===e.parentNode&&domUtils.remove(e,true);break}}t=t.parentNode}},mergeSibling:function(e,t,i){function n(e,t,i){var n;if((n=i[e])&&!domUtils.isBookmarkNode(n)&&n.nodeType==1&&domUtils.isSameElement(i,n)){while(n.firstChild){if(t=="firstChild"){i.insertBefore(n.lastChild,i.firstChild)}else{i.appendChild(n.firstChild)}}domUtils.remove(n)}}!t&&n("previousSibling","firstChild",e);!i&&n("nextSibling","lastChild",e)},unSelectable:ie&&browser.ie9below||browser.opera?function(e){e.onselectstart=function(){return false};e.onclick=e.onkeyup=e.onkeydown=function(){return false};e.unselectable="on";e.setAttribute("unselectable","on");for(var t=0,i;i=e.all[t++];){switch(i.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:i.unselectable="on";e.setAttribute("unselectable","on")}}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n;n=t[i++];){n=attrFix[n]||n;switch(n){case"className":e[n]="";break;case"style":e.style.cssText="";var r=e.getAttributeNode("style");!browser.ie&&r&&e.removeAttributeNode(r)}e.removeAttribute(n)}},createElement:function(e,t,i){return domUtils.setAttributes(e.createElement(t),i)},setAttributes:function(e,t){for(var i in t){if(t.hasOwnProperty(i)){var n=t[i];switch(i){case"class":e.className=n;break;case"style":e.style.cssText=e.style.cssText+";"+n;break;case"innerHTML":e[i]=n;break;case"value":e.value=n;break;default:e.setAttribute(attrFix[i]||i,n)}}}return e},getComputedStyle:function(e,t){var i="width height top left";if(i.indexOf(t)>-1){return e["offset"+t.replace(/^\w/,function(e){return e.toUpperCase()})]+"px"}if(e.nodeType==3){e=e.parentNode}if(browser.ie&&browser.version<9&&t=="font-size"&&!e.style.fontSize&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]){var n=e.ownerDocument.createElement("span");n.style.cssText="padding:0;border:0;font-family:simsun;";n.innerHTML=".";e.appendChild(n);var r=n.offsetHeight;e.removeChild(n);n=null;return r+"px"}try{var o=domUtils.getStyle(e,t)||(window.getComputedStyle?domUtils.getWindow(e).getComputedStyle(e,"").getPropertyValue(t):(e.currentStyle||e.style)[utils.cssStyleToDomStyle(t)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(t,o))},removeClasses:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n,r=e.className;n=t[i++];){r=r.replace(new RegExp("\\b"+n+"\\b"),"")}r=utils.trim(r).replace(/[ ]{2,}/g," ");if(r){e.className=r}else{domUtils.removeAttributes(e,["class"])}},addClass:function(e,t){if(!e)return;t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n,r=e.className;n=t[i++];){if(!new RegExp("\\b"+n+"\\b").test(r)){r+=" "+n}}e.className=utils.trim(r)},hasClass:function(e,t){if(utils.isRegExp(t)){return t.test(e.className)}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n,r=e.className;n=t[i++];){if(!new RegExp("\\b"+n+"\\b","i").test(r)){return false}}return i-1==t.length},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=false},removeStyle:function(e,t){if(browser.ie){if(t=="color"){t="(^|;)"+t}e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")}else{if(e.style.removeProperty){e.style.removeProperty(t)}else{e.style.removeAttribute(utils.cssStyleToDomStyle(t))}}if(!e.style.cssText){domUtils.removeAttributes(e,["style"])}},getStyle:function(e,t){var i=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,i)},setStyle:function(e,t,i){e.style[utils.cssStyleToDomStyle(t)]=i;if(!utils.trim(e.style.cssText)){this.removeAttributes(e,"style")}},setStyles:function(e,t){for(var i in t){if(t.hasOwnProperty(i)){domUtils.setStyle(e,i,t[i])}}},removeDirtyAttr:function(e){for(var t=0,i,n=e.getElementsByTagName("*");i=n[t++];){i.removeAttribute("_moz_dirty")}e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var i=0,n=e.firstChild;t=t||function(){return 1};while(n){if(t(n)){i++}n=n.nextSibling}return i},isEmptyNode:function(e){return!e.firstChild||domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})==0},clearSelectedArr:function(e){var t;while(t=e.pop()){domUtils.removeAttributes(t,["class"])}},scrollToView:function(e,t,i){var n=function(){var e=t.document,i=e.compatMode=="CSS1Compat";return{width:(i?e.documentElement.clientWidth:e.body.clientWidth)||0,height:(i?e.documentElement.clientHeight:e.body.clientHeight)||0}},r=function(e){if("pageXOffset"in e){return{x:e.pageXOffset||0,y:e.pageYOffset||0}}else{var t=e.document;return{x:t.documentElement.scrollLeft||t.body.scrollLeft||0,y:t.documentElement.scrollTop||t.body.scrollTop||0}}};var o=n().height,a=o*-1+i;a+=e.offsetHeight||0;var s=domUtils.getXY(e);a+=s.y;var l=r(t).y;if(a>l||a<l-o){t.scrollTo(0,a+(a<0?-20:20))}},isBr:function(e){return e.nodeType==1&&e.tagName=="BR"},isFillChar:function(e,t){if(e.nodeType!=3)return false;var i=e.nodeValue;if(t){return new RegExp("^"+domUtils.fillChar).test(i)}return!i.replace(new RegExp(domUtils.fillChar,"g"),"").length},isStartInblock:function(e){var t=e.cloneRange(),i=0,n=t.startContainer,r;if(n.nodeType==1&&n.childNodes[t.startOffset]){n=n.childNodes[t.startOffset];var o=n.previousSibling;while(o&&domUtils.isFillChar(o)){n=o;o=o.previousSibling}}if(this.isFillChar(n,true)&&t.startOffset==1){t.setStartBefore(n);n=t.startContainer}while(n&&domUtils.isFillChar(n)){r=n;n=n.previousSibling}if(r){t.setStartBefore(r);n=t.startContainer}if(n.nodeType==1&&domUtils.isEmptyNode(n)&&t.startOffset==1){t.setStart(n,0).collapse(true)}while(!t.startOffset){n=t.startContainer;if(domUtils.isBlockElm(n)||domUtils.isBody(n)){i=1;break}var o=t.startContainer.previousSibling,a;if(!o){t.setStartBefore(t.startContainer)}else{while(o&&domUtils.isFillChar(o)){a=o;o=o.previousSibling}if(a){t.setStartBefore(a)}else{t.setStartBefore(t.startContainer)}}}return i&&!domUtils.isBody(t.startContainer)?1:0},isEmptyBlock:function(e,t){if(e.nodeType!=1)return 0;t=t||new RegExp("[  \t\r\n"+domUtils.fillChar+"]","g");if(e[browser.ie?"innerText":"textContent"].replace(t,"").length>0){return 0}for(var i in dtd.$isNotEmpty){if(e.getElementsByTagName(i).length){return 0}}return 1},setViewportOffset:function(e,t){var i=parseInt(e.style.left)|0;var n=parseInt(e.style.top)|0;var r=e.getBoundingClientRect();var o=t.left-r.left;var a=t.top-r.top;if(o){e.style.left=i+o+"px"}if(a){e.style.top=n+a+"px"}},fillNode:function(e,t){var i=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="";t.appendChild(i)},moveChild:function(e,t,i){while(e.firstChild){if(i&&t.firstChild){t.insertBefore(e.lastChild,t.firstChild)}else{t.appendChild(e.firstChild)}}},hasNoAttributes:function(e){return browser.ie?/^<\w+\s*?>/.test(e.outerHTML):e.attributes.length==0},isCustomeNode:function(e){return e.nodeType==1&&e.getAttribute("_ue_custom_node_")},isTagNode:function(e,t){return e.nodeType==1&&new RegExp("\\b"+e.tagName+"\\b","i").test(t)},filterNodeList:function(e,t,i){var n=[];if(!utils.isFunction(t)){var r=t;t=function(e){return utils.indexOf(utils.isArray(r)?r:r.split(" "),e.tagName.toLowerCase())!=-1}}utils.each(e,function(e){t(e)&&n.push(e)});return n.length==0?null:n.length==1||!i?n[0]:n},isInNodeEndBoundary:function(e,t){var i=e.startContainer;if(i.nodeType==3&&e.startOffset!=i.nodeValue.length){return 0}if(i.nodeType==1&&e.startOffset!=i.childNodes.length){return 0}while(i!==t){if(i.nextSibling){return 0}i=i.parentNode}return 1},isBoundaryNode:function(e,t){var i;while(!domUtils.isBody(e)){i=e;e=e.parentNode;if(i!==e[t]){return false}}return true},fillHtml:browser.ie11below?"&nbsp;":"<br/>"};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var e=0,t=domUtils.fillChar,i;function n(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer===e.endContainer&&e.startOffset==e.endOffset}function r(e){return!e.collapsed&&e.startContainer.nodeType==1&&e.startContainer===e.endContainer&&e.endOffset-e.startOffset==1}function o(e,t,i,r){if(t.nodeType==1&&(dtd.$empty[t.tagName]||dtd.$nonChild[t.tagName])){i=domUtils.getNodeIndex(t)+(e?0:1);t=t.parentNode}if(e){r.startContainer=t;r.startOffset=i;if(!r.endContainer){r.collapse(true)}}else{r.endContainer=t;r.endOffset=i;if(!r.startContainer){r.collapse(false)}}n(r);return r}function a(e,t){var i=e.startContainer,n=e.endContainer,r=e.startOffset,o=e.endOffset,a=e.document,s=a.createDocumentFragment(),l,d;if(i.nodeType==1){i=i.childNodes[r]||(l=i.appendChild(a.createTextNode("")))}if(n.nodeType==1){n=n.childNodes[o]||(d=n.appendChild(a.createTextNode("")))}if(i===n&&i.nodeType==3){s.appendChild(a.createTextNode(i.substringData(r,o-r)));if(t){i.deleteData(r,o-r);e.collapse(true)}return s}var u,c,f=s,m=domUtils.findParents(i,true),h=domUtils.findParents(n,true);for(var p=0;m[p]==h[p];){p++}for(var g=p,v;v=m[g];g++){u=v.nextSibling;if(v==i){if(!l){if(e.startContainer.nodeType==3){f.appendChild(a.createTextNode(i.nodeValue.slice(r)));if(t){
i.deleteData(r,i.nodeValue.length-r)}}else{f.appendChild(!t?i.cloneNode(true):i)}}}else{c=v.cloneNode(false);f.appendChild(c)}while(u){if(u===n||u===h[g]){break}v=u.nextSibling;f.appendChild(!t?u.cloneNode(true):u);u=v}f=c}f=s;if(!m[p]){f.appendChild(m[p-1].cloneNode(false));f=f.firstChild}for(var g=p,b;b=h[g];g++){u=b.previousSibling;if(b==n){if(!d&&e.endContainer.nodeType==3){f.appendChild(a.createTextNode(n.substringData(0,o)));if(t){n.deleteData(0,o)}}}else{c=b.cloneNode(false);f.appendChild(c)}if(g!=p||!m[p]){while(u){if(u===i){break}b=u.previousSibling;f.insertBefore(!t?u.cloneNode(true):u,f.firstChild);u=b}}f=c}if(t){e.setStartBefore(!h[p]?h[p-1]:!m[p]?m[p-1]:h[p]).collapse(true)}l&&domUtils.remove(l);d&&domUtils.remove(d);return s}var s=dom.Range=function(e){var t=this;t.startContainer=t.startOffset=t.endContainer=t.endOffset=null;t.document=e;t.collapsed=true};function l(e,t){try{if(i&&domUtils.inDoc(i,e)){if(!i.nodeValue.replace(fillCharReg,"").length){var n=i.parentNode;domUtils.remove(i);while(n&&domUtils.isEmptyInlineElement(n)&&(browser.safari?!(domUtils.getPosition(n,t)&domUtils.POSITION_CONTAINS):!n.contains(t))){i=n.parentNode;domUtils.remove(n);n=i}}else{i.nodeValue=i.nodeValue.replace(fillCharReg,"")}}}catch(e){}}function d(e,t){var i;e=e[t];while(e&&domUtils.isFillChar(e)){i=e[t];domUtils.remove(e);e=i}}s.prototype={cloneContents:function(){return this.collapsed?null:a(this,0)},deleteContents:function(){var e;if(!this.collapsed){a(this,1)}if(browser.webkit){e=this.startContainer;if(e.nodeType==3&&!e.nodeValue.length){this.setStartBefore(e).collapse(true);domUtils.remove(e)}}return this},extractContents:function(){return this.collapsed?null:a(this,2)},setStart:function(e,t){return o(true,e,t,this)},setEnd:function(e,t){return o(false,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return new s(e.document).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;if(e){t.endContainer=t.startContainer;t.endOffset=t.startOffset}else{t.startContainer=t.endContainer;t.startOffset=t.endOffset}t.collapsed=true;return t},shrinkBoundary:function(e){var t=this,i,n=t.collapsed;function r(e){return e.nodeType==1&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}while(t.startContainer.nodeType==1&&(i=t.startContainer.childNodes[t.startOffset])&&r(i)){t.setStart(i,0)}if(n){return t.collapse(true)}if(!e){while(t.endContainer.nodeType==1&&t.endOffset>0&&(i=t.endContainer.childNodes[t.endOffset-1])&&r(i)){t.setEnd(i,i.childNodes.length)}}return t},getCommonAncestor:function(e,t){var i=this,n=i.startContainer,o=i.endContainer;if(n===o){if(e&&r(this)){n=n.childNodes[i.startOffset];if(n.nodeType==1)return n}return t&&n.nodeType==3?n.parentNode:n}return domUtils.getCommonAncestor(n,o)},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,i=this.startOffset,n=this.collapsed,r=this.endContainer;if(t.nodeType==3){if(i==0){this.setStartBefore(t)}else{if(i>=t.nodeValue.length){this.setStartAfter(t)}else{var o=domUtils.split(t,i);if(t===r){this.setEnd(o,this.endOffset-i)}else if(t.parentNode===r){this.endOffset+=1}this.setStartBefore(o)}}if(n){return this.collapse(true)}}if(!e){i=this.endOffset;r=this.endContainer;if(r.nodeType==3){if(i==0){this.setEndBefore(r)}else{i<r.nodeValue.length&&domUtils.split(r,i);this.setEndAfter(r)}}}return this},txtToElmBoundary:function(e){function t(e,t){var i=e[t+"Container"],n=e[t+"Offset"];if(i.nodeType==3){if(!n){e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](i)}else if(n>=i.nodeValue.length){e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](i)}}}if(e||!this.collapsed){t(this,"start");t(this,"end")}return this},insertNode:function(e){var t=e,i=1;if(e.nodeType==11){t=e.firstChild;i=e.childNodes.length}this.trimBoundary(true);var n=this.startContainer,r=this.startOffset;var o=n.childNodes[r];if(o){n.insertBefore(e,o)}else{n.appendChild(e)}if(t.parentNode===this.endContainer){this.endOffset=this.endOffset+i}return this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(t,i){var n,r=this.document.createElement("span");r.style.cssText="display:none;line-height:0px;";r.appendChild(this.document.createTextNode("‍"));r.id="_baidu_bookmark_start_"+(i?"":e++);if(!this.collapsed){n=r.cloneNode(true);n.id="_baidu_bookmark_end_"+(i?"":e++)}this.insertNode(r);if(n){this.collapse().insertNode(n).setEndBefore(n)}this.setStartAfter(r);return{start:t?r.id:r,end:n?t?n.id:n:null,id:t}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,i=e.end&&e.id?this.document.getElementById(e.end):e.end;this.setStartBefore(t);domUtils.remove(t);if(i){this.setEndBefore(i);domUtils.remove(i)}else{this.collapse(true)}return this},enlarge:function(e,t){var i=domUtils.isBody,n,r,o=this.document.createTextNode("");if(e){r=this.startContainer;if(r.nodeType==1){if(r.childNodes[this.startOffset]){n=r=r.childNodes[this.startOffset]}else{r.appendChild(o);n=r=o}}else{n=r}while(1){if(domUtils.isBlockElm(r)){r=n;while((n=r.previousSibling)&&!domUtils.isBlockElm(n)){r=n}this.setStartBefore(r);break}n=r;r=r.parentNode}r=this.endContainer;if(r.nodeType==1){if(n=r.childNodes[this.endOffset]){r.insertBefore(o,n)}else{r.appendChild(o)}n=r=o}else{n=r}while(1){if(domUtils.isBlockElm(r)){r=n;while((n=r.nextSibling)&&!domUtils.isBlockElm(n)){r=n}this.setEndAfter(r);break}n=r;r=r.parentNode}if(o.parentNode===this.endContainer){this.endOffset--}domUtils.remove(o)}if(!this.collapsed){while(this.startOffset==0){if(t&&t(this.startContainer)){break}if(i(this.startContainer)){break}this.setStartBefore(this.startContainer)}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(t&&t(this.endContainer)){break}if(i(this.endContainer)){break}this.setEndAfter(this.endContainer)}}return this},enlargeToBlockElm:function(e){while(!domUtils.isBlockElm(this.startContainer)){this.setStartBefore(this.startContainer)}if(!e){while(!domUtils.isBlockElm(this.endContainer)){this.setEndAfter(this.endContainer)}}return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer)}while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setEndBefore(this.endContainer)}}return this},applyInlineStyle:function(e,t,i){if(this.collapsed)return this;this.trimBoundary().enlarge(false,function(e){return e.nodeType==1&&domUtils.isBlockElm(e)}).adjustmentBoundary();var n=this.createBookmark(),r=n.end,o=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br":!domUtils.isWhitespace(e)},a=domUtils.getNextDomNode(n.start,false,o),s,l,d=this.cloneRange();while(a&&domUtils.getPosition(a,r)&domUtils.POSITION_PRECEDING){if(a.nodeType==3||dtd[e][a.tagName]){d.setStartBefore(a);s=a;while(s&&(s.nodeType==3||dtd[e][s.tagName])&&s!==r){l=s;s=domUtils.getNextDomNode(s,s.nodeType==1,null,function(t){return dtd[e][t.tagName]})}var u=d.setEndAfter(l).extractContents(),c;if(i&&i.length>0){var f,m;m=f=i[0].cloneNode(false);for(var h=1,p;p=i[h++];){f.appendChild(p.cloneNode(false));f=f.firstChild}c=f}else{c=d.document.createElement(e)}if(t){domUtils.setAttributes(c,t)}c.appendChild(u);d.insertNode(i?m:c);var g;if(e=="span"&&t.style&&/text\-decoration/.test(t.style)&&(g=domUtils.findParentByTagName(c,"a",true))){domUtils.setAttributes(g,t);domUtils.remove(c,true);c=g}else{domUtils.mergeSibling(c);domUtils.clearEmptySibling(c)}domUtils.mergeChild(c,t);a=domUtils.getNextDomNode(c,false,o);domUtils.mergeToParent(c);if(s===r){break}}else{a=domUtils.getNextDomNode(a,true,o)}}return this.moveToBookmark(n)},removeInlineStyle:function(e){if(this.collapsed)return this;e=utils.isArray(e)?e:[e];this.shrinkBoundary().adjustmentBoundary();var t=this.startContainer,i=this.endContainer;while(1){if(t.nodeType==1){if(utils.indexOf(e,t.tagName.toLowerCase())>-1){break}if(t.tagName.toLowerCase()=="body"){t=null;break}}t=t.parentNode}while(1){if(i.nodeType==1){if(utils.indexOf(e,i.tagName.toLowerCase())>-1){break}if(i.tagName.toLowerCase()=="body"){i=null;break}}i=i.parentNode}var n=this.createBookmark(),r,o;if(t){o=this.cloneRange().setEndBefore(n.start).setStartBefore(t);r=o.extractContents();o.insertNode(r);domUtils.clearEmptySibling(t,true);t.parentNode.insertBefore(n.start,t)}if(i){o=this.cloneRange().setStartAfter(n.end).setEndAfter(i);r=o.extractContents();o.insertNode(r);domUtils.clearEmptySibling(i,false,true);i.parentNode.insertBefore(n.end,i.nextSibling)}var a=domUtils.getNextDomNode(n.start,false,function(e){return e.nodeType==1}),s;while(a&&a!==n.end){s=domUtils.getNextDomNode(a,true,function(e){return e.nodeType==1});if(utils.indexOf(e,a.tagName.toLowerCase())>-1){domUtils.remove(a,true)}a=s}return this.moveToBookmark(n)},getClosedNode:function(){var e;if(!this.collapsed){var t=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(r(t)){var i=t.startContainer.childNodes[t.startOffset];if(i&&i.nodeType==1&&(dtd.$empty[i.tagName]||dtd.$nonChild[i.tagName])){e=i}}}return e},select:browser.ie?function(e,n){var r;if(!this.collapsed)this.shrinkBoundary();var o=this.getClosedNode();if(o&&!n){try{r=this.document.body.createControlRange();r.addElement(o);r.select()}catch(e){}return this}var a=this.createBookmark(),s=a.start,u;r=this.document.body.createTextRange();r.moveToElementText(s);r.moveStart("character",1);if(!this.collapsed){var c=this.document.body.createTextRange();u=a.end;c.moveToElementText(u);r.setEndPoint("EndToEnd",c)}else{if(!e&&this.startContainer.nodeType!=3){var f=this.document.createTextNode(t),m=this.document.createElement("span");m.appendChild(this.document.createTextNode(t));s.parentNode.insertBefore(m,s);s.parentNode.insertBefore(f,s);l(this.document,f);i=f;d(m,"previousSibling");d(s,"nextSibling");r.moveStart("character",-1);r.collapse(true)}}this.moveToBookmark(a);m&&domUtils.remove(m);try{r.select()}catch(e){}return this}:function(e){function n(e){function t(t,i,n){if(t.nodeType==3&&t.nodeValue.length<i){e[n+"Offset"]=t.nodeValue.length}}t(e.startContainer,e.startOffset,"start");t(e.endContainer,e.endOffset,"end")}var r=domUtils.getWindow(this.document),o=r.getSelection(),a;browser.gecko?this.document.body.focus():r.focus();if(o){o.removeAllRanges();if(this.collapsed&&!e){var s=this.startContainer,u=s;if(s.nodeType==1){u=s.childNodes[this.startOffset]}if(!(s.nodeType==3&&this.startOffset)&&(u?!u.previousSibling||u.previousSibling.nodeType!=3:!s.lastChild||s.lastChild.nodeType!=3)){a=this.document.createTextNode(t);this.insertNode(a);l(this.document,a);d(a,"previousSibling");d(a,"nextSibling");i=a;this.setStart(a,browser.webkit?1:0).collapse(true)}}var c=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var u=this.startContainer.childNodes[this.startOffset];if(!u){u=this.startContainer.lastChild;if(u&&domUtils.isBr(u)){this.setStartBefore(u).collapse(true)}}else{while(u&&domUtils.isBlockElm(u)){if(u.nodeType==1&&u.childNodes[0]){u=u.childNodes[0]}else{break}}u&&this.setStartBefore(u).collapse(true)}}n(this);c.setStart(this.startContainer,this.startOffset);c.setEnd(this.endContainer,this.endOffset);o.addRange(c)}return this},scrollToView:function(e,t){e=e?window:domUtils.getWindow(this.document);var i=this,n=i.document.createElement("span");n.innerHTML="&nbsp;";i.cloneRange().insertNode(n);domUtils.scrollToView(n,e,t);domUtils.remove(n);return i},inFillChar:function(){var e=this.startContainer;if(this.collapsed&&e.nodeType==3&&e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==e.nodeValue.length){return true}return false},createAddress:function(e,t){var i={},n=this;function r(e){var i=e?n.startContainer:n.endContainer;var r=domUtils.findParents(i,true,function(e){return!domUtils.isBody(e)}),o=[];for(var a=0,s;s=r[a++];){o.push(domUtils.getNodeIndex(s,t))}var l=0;if(t){if(i.nodeType==3){var d=i.previousSibling;while(d&&d.nodeType==3){l+=d.nodeValue.replace(fillCharReg,"").length;d=d.previousSibling}l+=e?n.startOffset:n.endOffset}else{i=i.childNodes[e?n.startOffset:n.endOffset];if(i){l=domUtils.getNodeIndex(i,t)}else{i=e?n.startContainer:n.endContainer;var u=i.firstChild;while(u){if(domUtils.isFillChar(u)){u=u.nextSibling;continue}l++;if(u.nodeType==3){while(u&&u.nodeType==3){u=u.nextSibling}}else{u=u.nextSibling}}}}}else{l=e?domUtils.isFillChar(i)?0:n.startOffset:n.endOffset}if(l<0){l=0}o.push(l);return o}i.startAddress=r(true);if(!e){i.endAddress=n.collapsed?[].concat(i.startAddress):r()}return i},moveToAddress:function(e,t){var i=this;function n(e,t){var n=i.document.body,r,o;for(var a=0,s,l=e.length;a<l;a++){s=e[a];r=n;n=n.childNodes[s];if(!n){o=s;break}}if(t){if(n){i.setStartBefore(n)}else{i.setStart(r,o)}}else{if(n){i.setEndBefore(n)}else{i.setEnd(r,o)}}}n(e.startAddress,true);!t&&e.endAddress&&n(e.endAddress);return i},equals:function(e){for(var t in this){if(this.hasOwnProperty(t)){if(this[t]!==e[t])return false}}return true},traversal:function(e,t){if(this.collapsed)return this;var i=this.createBookmark(),n=i.end,r=domUtils.getNextDomNode(i.start,false,t);while(r&&r!==n&&domUtils.getPosition(r,n)&domUtils.POSITION_PRECEDING){var o=domUtils.getNextDomNode(r,false,t);e(r);r=o}return this.moveToBookmark(i)}}})();(function(){function e(e,t){var i=domUtils.getNodeIndex;e=e.duplicate();e.collapse(t);var n=e.parentElement();if(!n.hasChildNodes()){return{container:n,offset:0}}var r=n.children,o,a=e.duplicate(),s=0,l=r.length-1,d=-1,u;while(s<=l){d=Math.floor((s+l)/2);o=r[d];a.moveToElementText(o);var c=a.compareEndPoints("StartToStart",e);if(c>0){l=d-1}else if(c<0){s=d+1}else{return{container:n,offset:i(o)}}}if(d==-1){a.moveToElementText(n);a.setEndPoint("StartToStart",e);u=a.text.replace(/(\r\n|\r)/g,"\n").length;r=n.childNodes;if(!u){o=r[r.length-1];return{container:o,offset:o.nodeValue.length}}var f=r.length;while(u>0){u-=r[--f].nodeValue.length}return{container:r[f],offset:-u}}a.collapse(c>0);a.setEndPoint(c>0?"StartToStart":"EndToStart",e);u=a.text.replace(/(\r\n|\r)/g,"\n").length;if(!u){return dtd.$empty[o.tagName]||dtd.$nonChild[o.tagName]?{container:n,offset:i(o)+(c>0?0:1)}:{container:o,offset:c>0?0:o.childNodes.length}}while(u>0){try{var m=o;o=o[c>0?"previousSibling":"nextSibling"];u-=o.nodeValue.length}catch(e){return{container:n,offset:i(m)}}}return{container:o,offset:c>0?-u:o.nodeValue.length+u}}function t(t,i){if(t.item){i.selectNode(t.item(0))}else{var n=e(t,true);i.setStart(n.container,n.offset);if(t.compareEndPoints("StartToEnd",t)!=0){n=e(t,false);i.setEnd(n.container,n.offset)}}return i}function i(e){var t;try{t=e.getNative().createRange()}catch(e){return null}var i=t.item?t.item(0):t.parentElement();if((i.ownerDocument||i)===e.document){return t}return null}var n=dom.Selection=function(e){var t=this,n;t.document=e;if(browser.ie9below){n=domUtils.getWindow(e).frameElement;domUtils.on(n,"beforedeactivate",function(){t._bakIERange=t.getIERange()});domUtils.on(n,"activate",function(){try{if(!i(t)&&t._bakIERange){t._bakIERange.select()}}catch(e){}t._bakIERange=null})}n=e=null};n.prototype={rangeInBody:function(e,t){var i=browser.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return i===this.document.body||domUtils.inDoc(i,this.document)},getNative:function(){var e=this.document;try{return!e?null:browser.ie9below?e.selection:domUtils.getWindow(e).getSelection()}catch(e){return null}},getIERange:function(){var e=i(this);if(!e){if(this._bakIERange){return this._bakIERange}}return e},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath}var e=this.getStart();if(e){return domUtils.findParents(e,true,null,true)}return[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{if(browser.ie9below){var e=i(this);return!!(e&&this.rangeInBody(e))}else{return!!this.getNative().rangeCount}}catch(e){return false}},getRange:function(){var e=this;function i(t){var i=e.document.body.firstChild,n=t.collapsed;while(i&&i.firstChild){t.setStart(i,0);i=i.firstChild}if(!t.startContainer){t.setStart(e.document.body,0)}if(n){t.collapse(true)}}if(e._cachedRange!=null){return this._cachedRange}var n=new baidu.editor.dom.Range(e.document);if(browser.ie9below){var r=e.getIERange();if(r){try{t(r,n)}catch(e){i(n)}}else{i(n)}}else{var o=e.getNative();if(o&&o.rangeCount){var a=o.getRangeAt(0);var s=o.getRangeAt(o.rangeCount-1);n.setStart(a.startContainer,a.startOffset).setEnd(s.endContainer,s.endOffset);if(n.collapsed&&domUtils.isBody(n.startContainer)&&!n.startOffset){i(n)}}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document)){return this._bakRange}i(n)}}return this._bakRange=n},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement}var e=browser.ie9below?this.getIERange():this.getRange(),t,i,n,r;if(browser.ie9below){if(!e){return this.document.body.firstChild}if(e.item){return e.item(0)}t=e.duplicate();t.text.length>0&&t.moveStart("character",1);t.collapse(1);i=t.parentElement();r=n=e.parentElement();while(n=n.parentNode){if(n==i){i=r;break}}}else{e.shrinkBoundary();i=e.startContainer;if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[Math.min(i.childNodes.length-1,e.startOffset)]}if(i.nodeType==3){return i.parentNode}}return i},getText:function(){var e,t;if(this.isFocus()&&(e=this.getNative())){t=browser.ie9below?e.createRange():e.getRangeAt(0);return browser.ie9below?t.text:t.toString()}return""},clearRange:function(){this.getNative()[browser.ie9below?"empty":"removeAllRanges"]()}}})();(function(){var e=0,t;function i(e,t){var i;if(t.textarea){if(utils.isString(t.textarea)){for(var n=0,r,o=domUtils.getElementsByTagName(e,"textarea");r=o[n++];){if(r.id=="ueditor_textarea_"+t.options.textarea){i=r;break}}}else{i=t.textarea}}if(!i){e.appendChild(i=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"ueditor_textarea_"+t.options.textarea,style:"display:none"}));t.textarea=i}!i.getAttribute("name")&&i.setAttribute("name",t.options.textarea);i.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,true):""}function n(e){for(var t in UE.plugins){UE.plugins[t].call(e)}}function r(e){for(var t in e){return t}}function o(e){e.langIsReady=true;e.fireEvent("langReady")}var a=UE.Editor=function(t){var i=this;i.uid=e++;EventBase.call(i);i.commands={};i.options=utils.extend(utils.clone(t||{}),UEDITOR_CONFIG,true);i.shortcutkeys={};i.inputRules=[];i.outputRules=[];i.setOpt(a.defaultOptions(i));i.loadServerConfig();if(!utils.isEmptyObject(UE.I18N)){i.options.lang=r(UE.I18N);UE.plugin.load(i);o(i)}else{utils.loadFile(document,{src:i.options.langPath+i.options.lang+"/"+i.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){UE.plugin.load(i);o(i)})}UE.instants["ueditorInstant"+i.uid]=i};a.prototype={registerCommand:function(e,t){this.commands[e]=t},ready:function(e){var t=this;if(e){t.isReady?e.apply(t):t.addListener("ready",e)}},setOpt:function(e,t){var i={};if(utils.isString(e)){i[e]=t}else{i=e}utils.extend(this.options,i,true)},getOpt:function(e){return this.options[e]},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode;var i=e.textarea;if(!i){i=document.createElement("textarea");t.parentNode.insertBefore(i,t)}else{i.style.display=""}i.style.width=e.iframe.offsetWidth+"px";i.style.height=e.iframe.offsetHeight+"px";i.value=e.getContent();i.id=e.key;t.innerHTML="";domUtils.remove(t);var n=e.key;for(var r in e){if(e.hasOwnProperty(r)){delete this[r]}}UE.delEditor(n)},render:function(e){var t=this,i=t.options,n=function(t){return parseInt(domUtils.getComputedStyle(e,t))};if(utils.isString(e)){e=document.getElementById(e)}if(e){if(i.initialFrameWidth){i.minFrameWidth=i.initialFrameWidth}else{i.minFrameWidth=i.initialFrameWidth=e.offsetWidth}if(i.initialFrameHeight){i.minFrameHeight=i.initialFrameHeight}else{i.initialFrameHeight=i.minFrameHeight=e.offsetHeight}e.style.width=/%$/.test(i.initialFrameWidth)?"100%":i.initialFrameWidth-n("padding-left")-n("padding-right")+"px";e.style.height=/%$/.test(i.initialFrameHeight)?"100%":i.initialFrameHeight-n("padding-top")-n("padding-bottom")+"px";e.style.zIndex=i.zIndex;var r=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml' class='view' ><head>"+"<style type='text/css'>"+".view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:14px;}"+"p{margin:5px 0;}</style>"+(i.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(i.iframeCssUrl)+"'/>":"")+(i.initialStyle?"<style>"+i.initialStyle+"</style>":"")+"</head><body class='view' ></body>"+"<script type='text/javascript' "+(ie?"defer='defer'":"")+" id='_initialScript'>"+"setTimeout(function(){editor = window.parent.UE.instants['ueditorInstant"+t.uid+"'];editor._setup(document);},0);"+"var _tmpScript = document.getElementById('_initialScript');_tmpScript.parentNode.removeChild(_tmpScript);</script></html>";e.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+t.uid,name:"ueditor_"+t.uid,width:"100%",height:"100%",frameborder:"0",src:"about:blank"}));e.style.overflow="hidden";setTimeout(function(){if(/%$/.test(i.initialFrameWidth)){i.minFrameWidth=i.initialFrameWidth=e.offsetWidth}if(/%$/.test(i.initialFrameHeight)){i.minFrameHeight=i.initialFrameHeight=e.offsetHeight;e.style.height=i.initialFrameHeight+"px"}var n=document.getElementById("ueditor_"+t.uid);n.contentWindow.document.open();n.contentWindow.document.write(r);n.contentWindow.document.close()})}},_setup:function(e){var t=this,n=t.options;if(ie){e.body.disabled=true;e.body.contentEditable=true;e.body.disabled=false}else{e.body.contentEditable=true}e.body.spellcheck=false;t.document=e;t.window=e.defaultView||e.parentWindow;t.iframe=t.window.frameElement;t.body=e.body;t.selection=new dom.Selection(e);var r;if(browser.gecko&&(r=this.selection.getNative())){r.removeAllRanges()}this._initEvents();for(var o=this.iframe.parentNode;!domUtils.isBody(o);o=o.parentNode){if(o.tagName=="FORM"){t.form=o;if(t.options.autoSyncData){domUtils.on(t.window,"blur",function(){i(o,t)})}else{domUtils.on(o,"submit",function(){i(this,t)})}break}}if(n.initialContent){if(n.autoClearinitialContent){var a=t.execCommand;t.execCommand=function(){t.fireEvent("firstBeforeExecCommand");return a.apply(t,arguments)};this._setDefaultContent(n.initialContent)}else this.setContent(n.initialContent,false,true)}if(domUtils.isEmptyNode(t.body)){t.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"}if(n.focus){setTimeout(function(){t.focus(t.options.focusInEnd);!t.options.autoClearinitialContent&&t._selectionChange()},0)}if(!t.container){t.container=this.iframe.parentNode}if(n.fullscreen&&t.ui){t.ui.setFullScreen(true)}try{t.document.execCommand("2D-position",false,false)}catch(e){}try{t.document.execCommand("enableInlineTableEditing",false,false)}catch(e){}try{t.document.execCommand("enableObjectResizing",false,false)}catch(e){}t._bindshortcutKeys();t.isReady=1;t.fireEvent("ready");n.onready&&n.onready.call(t);if(!browser.ie9below){domUtils.on(t.window,["blur","focus"],function(e){if(e.type=="blur"){t._bakRange=t.selection.getRange();try{t._bakNativeRange=t.selection.getNative().getRangeAt(0);t.selection.getNative().removeAllRanges()}catch(e){t._bakNativeRange=null}}else{try{t._bakRange&&t._bakRange.select()}catch(e){}}})}if(browser.gecko&&browser.version<=10902){t.body.contentEditable=false;setTimeout(function(){t.body.contentEditable=true},100);setInterval(function(){t.body.style.height=t.iframe.offsetHeight-20+"px"},100)}!n.isShow&&t.setHide();n.readonly&&t.setDisabled()},sync:function(e){var t=this,n=e?document.getElementById(e):domUtils.findParent(t.iframe.parentNode,function(e){return e.tagName=="FORM"},true);n&&i(n,t)},setHeight:function(e,t){if(e!==parseInt(this.iframe.parentNode.style.height)){this.iframe.parentNode.style.height=e+"px"}!t&&(this.options.minFrameHeight=this.options.initialFrameHeight=e);this.body.style.height=e+"px";!t&&this.trigger("setHeight")},addshortcutkey:function(e,t){var i={};if(t){i[e]=t}else{i=e}utils.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(i,n){var r=n.keyCode||n.which;for(var o in t){var a=t[o].split(",");for(var s=0,l;l=a[s++];){l=l.split(":");var d=l[0],u=l[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(d.toLowerCase())||/^(\d+)$/.test(d)){if((RegExp.$1=="ctrl"?n.ctrlKey||n.metaKey:0)&&(RegExp.$2!=""?n[RegExp.$2.slice(1)+"Key"]:1)&&r==RegExp.$3||r==RegExp.$1){if(e.queryCommandState(o,u)!=-1)e.execCommand(o,u);domUtils.preventDefault(n)}}}}})},getContent:function(e,t,i,n,r){var o=this;if(e&&utils.isFunction(e)){t=e;e=""}if(t?!t():!this.hasContents()){return""}o.fireEvent("beforegetcontent");var a=UE.htmlparser(o.body.innerHTML,n);o.filterOutputRule(a);o.fireEvent("aftergetcontent",e,a);return a.toHtml(r)},getAllHtml:function(){var e=this,t=[],i="";e.fireEvent("getAllHtml",t);if(browser.ie&&browser.version>8){var n="";utils.each(e.document.styleSheets,function(e){n+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"});utils.each(e.document.getElementsByTagName("script"),function(e){n+=e.outerHTML})}return"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(n||e.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,true)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,"");t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,i){return dtd.$block[i]?"\n":t?t:""});return t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(e,t,n){var r=this;r.fireEvent("beforesetcontent",e);var o=UE.htmlparser(e);r.filterInputRule(o);e=o.toHtml();r.body.innerHTML=(t?r.body.innerHTML:"")+e;function a(e){return e.tagName=="DIV"&&e.getAttribute("cdata_tag")}if(r.options.enterTag=="p"){var s=this.body.firstChild,l;if(!s||s.nodeType==1&&(dtd.$cdata[s.tagName]||a(s)||domUtils.isCustomeNode(s))&&s===this.body.lastChild){this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML}else{var d=r.document.createElement("p");while(s){while(s&&(s.nodeType==3||s.nodeType==1&&dtd.p[s.tagName]&&!dtd.$cdata[s.tagName])){l=s.nextSibling;d.appendChild(s);s=l}if(d.firstChild){if(!s){r.body.appendChild(d);break}else{s.parentNode.insertBefore(d,s);d=r.document.createElement("p")}}s=s.nextSibling}}}r.fireEvent("aftersetcontent");r.fireEvent("contentchange");!n&&r._selectionChange();r._bakRange=r._bakIERange=r._bakNativeRange=null;var u;if(browser.gecko&&(u=this.selection.getNative())){u.removeAllRanges()}if(r.options.autoSyncData){r.form&&i(r.form,r)}},focus:function(e){try{var t=this,i=t.selection.getRange();if(e){var n=t.body.lastChild;if(n&&n.nodeType==1&&!dtd.$empty[n.tagName]){if(domUtils.isEmptyBlock(n)){i.setStartAtFirst(n)}else{i.setStartAtLast(n)}i.collapse(true)}i.setCursor(true)}else{if(!i.collapsed&&domUtils.isBody(i.startContainer)&&i.startOffset==0){var n=t.body.firstChild;if(n&&n.nodeType==1&&!dtd.$empty[n.tagName]){i.setStartAtFirst(n).collapse(true)}}i.select(true)}this.fireEvent("focus selectionchange")}catch(e){}},isFocus:function(){return this.selection.isFocus()},blur:function(){var e=this.selection.getNative();if(e.empty&&browser.ie){var t=document.body.createTextRange();t.moveToElementText(document.body);t.collapse(true);t.select();e.empty()}else{e.removeAllRanges()}},_initEvents:function(){var e=this,t=e.document,i=e.window;e._proxyDomEvent=utils.bind(e._proxyDomEvent,e);domUtils.on(t,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],e._proxyDomEvent);domUtils.on(i,["focus","blur"],e._proxyDomEvent);domUtils.on(e.body,"drop",function(t){if(browser.gecko&&t.stopPropagation){t.stopPropagation()}e.fireEvent("contentchange")});domUtils.on(t,["mouseup","keydown"],function(t){if(t.type=="keydown"&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){return}if(t.button==2)return;e._selectionChange(250,t)})},_proxyDomEvent:function(e){if(this.fireEvent("before"+e.type.replace(/^on/,"").toLowerCase())===false){return false}if(this.fireEvent(e.type.replace(/^on/,""),e)===false){return false}return this.fireEvent("after"+e.type.replace(/^on/,"").toLowerCase())},_selectionChange:function(e,i){var n=this;var r=false;var o,a;if(browser.ie&&browser.version<9&&i&&i.type=="mouseup"){var s=this.selection.getRange();if(!s.collapsed){r=true;o=i.clientX;a=i.clientY}}clearTimeout(t);t=setTimeout(function(){if(!n.selection||!n.selection.getNative()){return}var e;if(r&&n.selection.getNative().type=="None"){e=n.document.body.createTextRange();try{e.moveToPoint(o,a)}catch(t){e=null}}var t;if(e){t=n.selection.getIERange;n.selection.getIERange=function(){return e}}n.selection.cache();if(t){n.selection.getIERange=t}if(n.selection._cachedRange&&n.selection._cachedStartElement){n.fireEvent("beforeselectionchange");n.fireEvent("selectionchange",!!i);n.fireEvent("afterselectionchange");n.selection.clear()}},e||50)},_callCmdFn:function(e,t){var i=t[0].toLowerCase(),n,r;n=this.commands[i]||UE.commands[i];r=n&&n[e];if((!n||!r)&&e=="queryCommandState"){return 0}else if(r){return r.apply(this,t)}},execCommand:function(e){e=e.toLowerCase();var t=this,i,n=t.commands[e]||UE.commands[e];if(!n||!n.execCommand){return null}if(!n.notNeedUndo&&!t.__hasEnterExecCommand){t.__hasEnterExecCommand=true;if(t.queryCommandState.apply(t,arguments)!=-1){t.fireEvent("saveScene");t.fireEvent.apply(t,["beforeexeccommand",e].concat(arguments));i=this._callCmdFn("execCommand",arguments);t.fireEvent.apply(t,["afterexeccommand",e].concat(arguments));t.fireEvent("saveScene")}t.__hasEnterExecCommand=false}else{i=this._callCmdFn("execCommand",arguments);!t.__hasEnterExecCommand&&!n.ignoreContentChange&&!t._ignoreContentChange&&t.fireEvent("contentchange")}!t.__hasEnterExecCommand&&!n.ignoreContentChange&&!t._ignoreContentChange&&t._selectionChange();return i},queryCommandState:function(e){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(e){return this._callCmdFn("queryCommandValue",arguments)},
hasContents:function(e){if(e){for(var t=0,i;i=e[t++];){if(this.document.getElementsByTagName(i).length>0){return true}}}if(!domUtils.isEmptyBlock(this.body)){return true}e=["div"];for(t=0;i=e[t++];){var n=domUtils.getElementsByTagName(this.document,i);for(var r=0,o;o=n[r++];){if(domUtils.isCustomeNode(o)){return true}}}return false},reset:function(){this.fireEvent("reset")},setEnabled:function(){var e=this,t;if(e.body.contentEditable=="false"){e.body.contentEditable=true;t=e.selection.getRange();try{t.moveToBookmark(e.lastBk);delete e.lastBk}catch(i){t.setStartAtFirst(e.body).collapse(true)}t.select(true);if(e.bkqueryCommandState){e.queryCommandState=e.bkqueryCommandState;delete e.bkqueryCommandState}if(e.bkqueryCommandValue){e.queryCommandValue=e.bkqueryCommandValue;delete e.bkqueryCommandValue}e.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(e){var t=this;e=e?utils.isArray(e)?e:[e]:[];if(t.body.contentEditable=="true"){if(!t.lastBk){t.lastBk=t.selection.getRange().createBookmark(true)}t.body.contentEditable=false;t.bkqueryCommandState=t.queryCommandState;t.bkqueryCommandValue=t.queryCommandValue;t.queryCommandState=function(i){if(utils.indexOf(e,i)!=-1){return t.bkqueryCommandState.apply(t,arguments)}return-1};t.queryCommandValue=function(i){if(utils.indexOf(e,i)!=-1){return t.bkqueryCommandValue.apply(t,arguments)}return null};t.fireEvent("selectionchange")}},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;if(t.document.getElementById("initContent")){t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";t.removeListener("firstBeforeExecCommand focus",e);setTimeout(function(){t.focus();t._selectionChange()},0)}}return function(t){var i=this;i.body.innerHTML='<p id="initContent">'+t+"</p>";i.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this,t=e.selection.getRange();if(e.container.style.display=="none"){try{t.moveToBookmark(e.lastBk);delete e.lastBk}catch(i){t.setStartAtFirst(e.body).collapse(true)}setTimeout(function(){t.select(true)},100);e.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var e=this;if(!e.lastBk){e.lastBk=e.selection.getRange().createBookmark(true)}e.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UE.I18N[this.options.lang];if(!t){throw Error("not import language file")}e=(e||"").split(".");for(var i=0,n;n=e[i++];){t=t[n];if(!t)break}return t},getContentLength:function(e,t){var i=this.getContent(false,false,true).length;if(e){t=(t||[]).concat(["hr","img","iframe"]);i=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var n=0,r;r=t[n++];){i+=this.document.getElementsByTagName(r).length}}return i},addInputRule:function(e){this.inputRules.push(e)},filterInputRule:function(e){for(var t=0,i;i=this.inputRules[t++];){i.call(this,e)}},addOutputRule:function(e){this.outputRules.push(e)},filterOutputRule:function(e){for(var t=0,i;i=this.outputRules[t++];){i.call(this,e)}},getActionUrl:function(e){var t=this.getOpt(e)||e,i=this.getOpt("imageUrl"),n=this.getOpt("serverUrl");if(!n&&i){n=i.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2")}if(n){n=n+(n.indexOf("?")==-1?"?":"&")+"action="+(t||"");return utils.formatUrl(n)}else{return""}}};utils.inherits(a,EventBase)})();UE.Editor.defaultOptions=function(e){var t=e.options.UEDITOR_HOME_URL;return{isShow:true,initialContent:"",initialStyle:"",autoClearinitialContent:false,iframeCssUrl:t+"themes/iframe.css",textarea:"editorValue",focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:999,imagePopup:true,enterTag:"p",customDomain:false,lang:"zh-cn",langPath:t+"lang/",theme:"default",themePath:t+"themes/",allHtmlEnabled:false,scaleEnabled:false,tableNativeEditInFF:false,autoSyncData:true,fileNameFormat:"{time}{rand:6}"}};(function(){UE.Editor.prototype.loadServerConfig=function(){var me=this;setTimeout(function(){try{me.options.imageUrl&&me.setOpt("serverUrl",me.options.imageUrl.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2"));var configUrl=me.getActionUrl("config"),isJsonp=utils.isCrossDomainUrl(configUrl);me._serverConfigLoaded=false;configUrl&&UE.ajax.request(configUrl,{method:"GET",dataType:isJsonp?"jsonp":"",async:true,onsuccess:function(r){try{var config=isJsonp?r:eval("("+r.responseText+")");utils.extend(me.options,config);me.fireEvent("serverConfigLoaded");me._serverConfigLoaded=true}catch(e){showErrorMsg(me.getLang("loadconfigFormatError"))}},onerror:function(){showErrorMsg(me.getLang("loadconfigHttpError"))}})}catch(e){showErrorMsg(me.getLang("loadconfigError"))}});function showErrorMsg(e){console&&console.error(e)}};UE.Editor.prototype.isServerConfigLoaded=function(){var e=this;return e._serverConfigLoaded||false};UE.Editor.prototype.afterConfigReady=function(e){if(!e||!utils.isFunction(e))return;var t=this;var i=function(){e.apply(t,arguments);t.removeListener("serverConfigLoaded",i)};if(t.isServerConfigLoaded()){e.call(t,"serverConfigLoaded")}else{t.addListener("serverConfigLoaded",i)}}})();UE.ajax=function(){var e="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP");e="ActiveXObject('Msxml2.XMLHTTP')"}catch(t){try{new ActiveXObject("Microsoft.XMLHTTP");e="ActiveXObject('Microsoft.XMLHTTP')"}catch(e){}}var t=new Function("return new "+e);function i(e){var t=[];for(var i in e){if(i=="method"||i=="timeout"||i=="async"||i=="dataType"||i=="callback")continue;if(e[i]==undefined||e[i]==null)continue;if(!((typeof e[i]).toLowerCase()=="function"||(typeof e[i]).toLowerCase()=="object")){t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]))}else if(utils.isArray(e[i])){for(var n=0;n<e[i].length;n++){t.push(encodeURIComponent(i)+"[]="+encodeURIComponent(e[i][n]))}}}return t.join("&")}function n(e,n){var r=t(),o=false,a={method:"POST",timeout:5e3,async:true,data:{},onsuccess:function(){},onerror:function(){}};if(typeof e==="object"){n=e;e=n.url}if(!r||!e)return;var s=n?utils.extend(a,n):a;var l=i(s);if(!utils.isEmptyObject(s.data)){l+=(l?"&":"")+i(s.data)}var d=setTimeout(function(){if(r.readyState!=4){o=true;r.abort();clearTimeout(d)}},s.timeout);var u=s.method.toUpperCase();var c=e+(e.indexOf("?")==-1?"?":"&")+(u=="POST"?"":l+"&noCache="+ +new Date);r.open(u,c,s.async);r.onreadystatechange=function(){if(r.readyState==4){if(!o&&r.status==200){s.onsuccess(r)}else{s.onerror(r)}}};if(u=="POST"){r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.send(l)}else{r.send(null)}}function r(e,t){var n=t.onsuccess||function(){},r=document.createElement("SCRIPT"),o=t||{},a=o["charset"],s=o["jsonp"]||"callback",l,d=o["timeOut"]||0,u,c=new RegExp("(\\?|&)"+s+"=([^&]*)"),f;if(utils.isFunction(n)){l="bd__editor__"+Math.floor(Math.random()*2147483648).toString(36);window[l]=p(0)}else if(utils.isString(n)){l=n}else{if(f=c.exec(e)){l=f[2]}}e=e.replace(c,"$1"+s+"="+l);if(e.search(c)<0){e+=(e.indexOf("?")<0?"?":"&")+s+"="+l}var m=i(t);if(!utils.isEmptyObject(t.data)){m+=(m?"&":"")+i(t.data)}if(m){e=e.replace(/\?/,"?"+m+"&")}r.onerror=p(1);if(d){u=setTimeout(p(1),d)}h(r,e,a);function h(e,t,i){e.setAttribute("type","text/javascript");e.setAttribute("defer","defer");i&&e.setAttribute("charset",i);e.setAttribute("src",t);document.getElementsByTagName("head")[0].appendChild(e)}function p(e){return function(){try{if(e){o.onerror&&o.onerror()}else{try{clearTimeout(u);n.apply(window,arguments)}catch(e){}}}catch(e){o.onerror&&o.onerror.call(window,e)}finally{o.oncomplete&&o.oncomplete.apply(window,arguments);r.parentNode&&r.parentNode.removeChild(r);window[l]=null;try{delete window[l]}catch(e){}}}}}return{request:function(e,t){if(t&&t.dataType=="jsonp"){r(e,t)}else{n(e,t)}},getJSONP:function(e,t,i){var n={data:t,oncomplete:i};r(e,n)}}}();var filterWord=UE.filterWord=function(){function e(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(e)}function t(e){e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)});return e}function i(e){return e.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera){return""}try{if(/Bitmap/i.test(e)){return""}var i=e.match(/width:([ \d.]*p[tx])/i)[1],n=e.match(/height:([ \d.]*p[tx])/i)[1],r=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+t(i)+'" height="'+t(n)+'" src="'+r+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(e,t,i,n){return t=="class"&&n=="MsoListParagraph"?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,i){return i.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,i,n,r){var o=[],a=r.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)}).split(/;\s*/g);for(var s=0,l;l=a[s];s++){var d,u,c=l.split(":");if(c.length==2){d=c[0].toLowerCase();u=c[1].toLowerCase();if(/^(background)\w*/.test(d)&&u.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(d)&&/^0\w+$/.test(u)){continue}switch(d){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(i))o[s]=d.replace(/^mso-|-alt$/g,"")+":"+t(u);continue;case"horiz-align":o[s]="text-align:"+u;continue;case"vert-align":o[s]="vertical-align:"+u;continue;case"font-color":case"mso-foreground":o[s]="color:"+u;continue;case"mso-background":case"mso-highlight":o[s]="background:"+u;continue;case"mso-default-height":o[s]="min-height:"+t(u);continue;case"mso-default-width":o[s]="min-width:"+t(u);continue;case"mso-padding-between-alt":o[s]="border-collapse:separate;border-spacing:"+t(u);continue;case"text-line-through":if(u=="single"||u=="double"){o[s]="text-decoration:line-through"}continue;case"mso-zero-height":if(u=="yes"){o[s]="display:none"}continue;case"margin":if(!/[1-9]/.test(u)){continue}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(d)||/text\-indent|padding|margin/.test(d)&&/\-[\d.]+/.test(u)){continue}o[s]=d+":"+c[1]}}return i+(o.length?' style="'+o.join(";").replace(/;{2,}/g,";")+'"':"")})}return function(t){return e(t)?i(t):t}}();(function(){var e=UE.uNode=function(e){this.type=e.type;this.data=e.data;this.tagName=e.tagName;this.parentNode=e.parentNode;this.attrs=e.attrs||{};this.children=e.children};var t={href:1,src:1,_src:1,_href:1,cdata_data:1};var i={style:1,script:1};var n="    ",r="\n";function o(e,t,i){e.push(r);return t+(i?1:-1)}function a(e,t){for(var i=0;i<t;i++){e.push(n)}}e.createElement=function(t){if(/[<>]/.test(t)){return UE.htmlparser(t).children[0]}else{return new e({type:"element",children:[],tagName:t})}};e.createText=function(e,t){return new UE.uNode({type:"text",data:t?e:utils.unhtml(e||"")})};function s(e,t,i,n){switch(e.type){case"root":for(var r=0,c;c=e.children[r++];){if(i&&c.type=="element"&&!dtd.$inlineWithA[c.tagName]&&r>1){o(t,n,true);a(t,n)}s(c,t,i,n)}break;case"text":l(e,t);break;case"element":d(e,t,i,n);break;case"comment":u(e,t,i)}return t}function l(e,t){if(e.parentNode.tagName=="pre"){t.push(e.data)}else{t.push(i[e.parentNode.tagName]?utils.html(e.data):e.data.replace(/[ ]{2}/g," &nbsp;"))}}function d(e,i,n,r){var l="";if(e.attrs){l=[];var d=e.attrs;for(var u in d){l.push(u+(d[u]!==undefined?'="'+(t[u]?utils.html(d[u]).replace(/["]/g,function(e){return"&quot;"}):utils.unhtml(d[u]))+'"':""))}l=l.join(" ")}i.push("<"+e.tagName+(l?" "+l:"")+(dtd.$empty[e.tagName]?"/":"")+">");if(n&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"){if(e.children&&e.children.length){r=o(i,r,true);a(i,r)}}if(e.children&&e.children.length){for(var c=0,f;f=e.children[c++];){if(n&&f.type=="element"&&!dtd.$inlineWithA[f.tagName]&&c>1){o(i,r);a(i,r)}s(f,i,n,r)}}if(!dtd.$empty[e.tagName]){if(n&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"){if(e.children&&e.children.length){r=o(i,r);a(i,r)}}i.push("</"+e.tagName+">")}}function u(e,t){t.push("<!--"+e.data+"-->")}function c(e,t){var i;if(e.type=="element"&&e.getAttr("id")==t){return e}if(e.children&&e.children.length){for(var n=0,r;r=e.children[n++];){if(i=c(r,t)){return i}}}}function f(e,t,i){if(e.type=="element"&&e.tagName==t){i.push(e)}if(e.children&&e.children.length){for(var n=0,r;r=e.children[n++];){f(r,t,i)}}}function m(e,t){if(e.children&&e.children.length){for(var i=0,n;n=e.children[i];){m(n,t);if(n.parentNode){if(n.children&&n.children.length){t(n)}if(n.parentNode)i++}}}else{t(e)}}e.prototype={toHtml:function(e){var t=[];s(this,t,e,0);return t.join("")},innerHTML:function(e){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(utils.isString(e)){if(this.children){for(var t=0,i;i=this.children[t++];){i.parentNode=null}}this.children=[];var n=UE.htmlparser(e);for(var t=0,i;i=n.children[t++];){this.children.push(i);i.parentNode=this}return this}else{var n=new UE.uNode({type:"root",children:this.children});return n.toHtml()}},innerText:function(t,i){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(t){if(this.children){for(var n=0,r;r=this.children[n++];){r.parentNode=null}}this.children=[];this.appendChild(e.createText(t,i));return this}else{return this.toHtml().replace(/<[^>]+>/g,"")}},getData:function(){if(this.type=="element")return"";return this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var e=this.parentNode;for(var t=0,i;i=e.children[t];t++){if(i===this){return t==0?null:e.children[t-1]}}},nextSibling:function(){var e=this.parentNode;for(var t=0,i;i=e.children[t++];){if(i===this){return e.children[t]}}},replaceChild:function(e,t){if(this.children){if(e.parentNode){e.parentNode.removeChild(e)}for(var i=0,n;n=this.children[i];i++){if(n===t){this.children.splice(i,1,e);t.parentNode=null;e.parentNode=this;return e}}}},appendChild:function(e){if(this.type=="root"||this.type=="element"&&!dtd.$empty[this.tagName]){if(!this.children){this.children=[]}if(e.parentNode){e.parentNode.removeChild(e)}for(var t=0,i;i=this.children[t];t++){if(i===e){this.children.splice(t,1);break}}this.children.push(e);e.parentNode=this;return e}},insertBefore:function(e,t){if(this.children){if(e.parentNode){e.parentNode.removeChild(e)}for(var i=0,n;n=this.children[i];i++){if(n===t){this.children.splice(i,0,e);e.parentNode=this;return e}}}},insertAfter:function(e,t){if(this.children){if(e.parentNode){e.parentNode.removeChild(e)}for(var i=0,n;n=this.children[i];i++){if(n===t){this.children.splice(i+1,0,e);e.parentNode=this;return e}}}},removeChild:function(e,t){if(this.children){for(var i=0,n;n=this.children[i];i++){if(n===e){this.children.splice(i,1);n.parentNode=null;if(t&&n.children&&n.children.length){for(var r=0,o;o=n.children[r];r++){this.children.splice(i+r,0,o);o.parentNode=this}}return n}}}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(!e){delete this.attrs;return}if(!this.attrs){this.attrs={}}if(utils.isObject(e)){for(var i in e){if(!e[i]){delete this.attrs[i]}else{this.attrs[i.toLowerCase()]=e[i]}}}else{if(!t){delete this.attrs[e]}else{this.attrs[e.toLowerCase()]=t}}},getIndex:function(){var e=this.parentNode;for(var t=0,i;i=e.children[t];t++){if(i===this){return t}}return-1},getNodeById:function(e){var t;if(this.children&&this.children.length){for(var i=0,n;n=this.children[i++];){if(t=c(n,e)){return t}}}},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],i=this;utils.each(e,function(e){if(i.children&&i.children.length){for(var n=0,r;r=i.children[n++];){f(r,e,t)}}});return t},getStyle:function(e){var t=this.getAttr("style");if(!t){return""}var i=new RegExp("(^|;)\\s*"+e+":([^;]+)","i");var n=t.match(i);if(n&&n[0]){return n[2]}return""},setStyle:function(e,t){function i(e,t){var i=new RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi");n=n.replace(i,"$1");if(t){n=e+":"+utils.unhtml(t)+";"+n}}var n=this.getAttr("style");if(!n){n=""}if(utils.isObject(e)){for(var r in e){i(r,e[r])}}else{i(e,t)}this.setAttr("style",utils.trim(n))},traversal:function(e){if(this.children&&this.children.length){m(this,e)}return this}}})();var htmlparser=UE.htmlparser=function(e,t){var i=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,n=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var r={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),"");if(!t){e=e.replace(new RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,i){if(i&&r[i.toLowerCase()]){return e.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return e.replace(new RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")})}var o={href:1,src:1};var a=UE.uNode,s={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},l={ol:"li",ul:"li"};function d(e,t){if(l[e.tagName]){var i=a.createElement(l[e.tagName]);e.appendChild(i);i.appendChild(a.createText(t));e=i}else{e.appendChild(a.createText(t))}}function u(e,t,i){var r;if(r=s[t]){var l=e,d;while(l.type!="root"){if(utils.isArray(r)?utils.indexOf(r,l.tagName)!=-1:r==l.tagName){e=l;d=true;break}l=l.parentNode}if(!d){e=u(e,utils.isArray(r)?r[0]:r)}}var c=new a({parentNode:e,type:"element",tagName:t.toLowerCase(),children:dtd.$empty[t]?null:[]});if(i){var f={},m;while(m=n.exec(i)){f[m[1].toLowerCase()]=o[m[1].toLowerCase()]?m[2]||m[3]||m[4]:utils.unhtml(m[2]||m[3]||m[4])}c.attrs=f}e.children.push(c);return dtd.$empty[t]?e:c}function c(e,t){e.children.push(new a({type:"comment",data:t,parentNode:e}))}var f,m=0,h=0;var p=new a({type:"root",children:[]});var g=p;while(f=i.exec(e)){m=f.index;try{if(m>h){d(g,e.slice(h,m))}if(f[3]){if(dtd.$cdata[g.tagName]){d(g,f[0])}else{g=u(g,f[3].toLowerCase(),f[4])}}else if(f[1]){if(g.type!="root"){if(dtd.$cdata[g.tagName]&&!dtd.$cdata[f[1]]){d(g,f[0])}else{var v=g;while(g.type=="element"&&g.tagName!=f[1].toLowerCase()){g=g.parentNode;if(g.type=="root"){g=v;throw"break"}}g=g.parentNode}}}else if(f[2]){c(g,f[2])}}catch(e){}h=i.lastIndex}if(h<e.length){d(g,e.slice(h))}return p};var filterNode=UE.filterNode=function(){function e(t,i){switch(t.type){case"text":break;case"element":var n;if(n=i[t.tagName]){if(n==="-"){t.parentNode.removeChild(t)}else if(utils.isFunction(n)){var r=t.parentNode,o=t.getIndex();n(t);if(t.parentNode){if(t.children){for(var a=0,s;s=t.children[a];){e(s,i);if(s.parentNode){a++}}}}else{for(var a=o,s;s=r.children[a];){e(s,i);if(s.parentNode){a++}}}}else{var l=n["$"];if(l&&t.attrs){var d={},u;for(var c in l){u=t.getAttr(c);if(c=="style"&&utils.isArray(l[c])){var f=[];utils.each(l[c],function(e){var i;if(i=t.getStyle(e)){f.push(e+":"+i)}});u=f.join(";")}if(u){d[c]=u}}t.attrs=d}if(t.children){for(var a=0,s;s=t.children[a];){e(s,i);if(s.parentNode){a++}}}}}else{if(dtd.$cdata[t.tagName]){t.parentNode.removeChild(t)}else{var r=t.parentNode,o=t.getIndex();t.parentNode.removeChild(t,true);for(var a=o,s;s=r.children[a];){e(s,i);if(s.parentNode){a++}}}}break;case"comment":t.parentNode.removeChild(t)}}return function(t,i){if(utils.isEmptyObject(i)){return t}var n;if(n=i["-"]){utils.each(n.split(" "),function(e){i[e]="-"})}for(var r=0,o;o=t.children[r];){e(o,i);if(o.parentNode){r++}}return t}}();UE.plugin=function(){var e={};return{register:function(t,i,n,r){if(n&&utils.isFunction(n)){r=n;n=null}e[t]={optionName:n||t,execFn:i,afterDisabled:r}},load:function(t){utils.each(e,function(e){var i=e.execFn.call(t);if(t.options[e.optionName]!==false){if(i){utils.each(i,function(e,i){switch(i.toLowerCase()){case"shortcutkey":t.addshortcutkey(e);break;case"bindevents":utils.each(e,function(e,i){t.addListener(i,e)});break;case"bindmultievents":utils.each(utils.isArray(e)?e:[e],function(e){var i=utils.trim(e.type).split(/\s+/);utils.each(i,function(i){t.addListener(i,e.handler)})});break;case"commands":utils.each(e,function(e,i){t.commands[i]=e});break;case"outputrule":t.addOutputRule(e);break;case"inputrule":t.addInputRule(e);break;case"defaultoptions":t.setOpt(e)}})}}else if(e.afterDisabled){e.afterDisabled.call(t)}});utils.each(UE.plugins,function(e){e.call(t)})},run:function(t,i){var n=e[t];if(n){n.exeFn.call(i)}}}}();var keymap=UE.keymap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Del:46,NumLock:144,Cmd:91,"=":187,"-":189,b:66,i:73,z:90,y:89,v:86,x:88,s:83,n:78};var LocalStorage=UE.LocalStorage=function(){var e=window.localStorage||i()||null,t="localStorage";return{saveLocalData:function(t,i){if(e&&i){e.setItem(t,i);return true}return false},getLocalData:function(t){if(e){return e.getItem(t)}return null},removeItem:function(t){e&&e.removeItem(t)}};function i(){var e=document.createElement("div");e.style.display="none";if(!e.addBehavior){return null}e.addBehavior("#default#userdata");return{getItem:function(i){var n=null;try{document.body.appendChild(e);e.load(t);n=e.getAttribute(i);document.body.removeChild(e)}catch(e){}return n},setItem:function(i,n){document.body.appendChild(e);e.setAttribute(i,n);e.save(t);document.body.removeChild(e)},removeItem:function(i){document.body.appendChild(e);e.removeAttribute(i);e.save(t);document.body.removeChild(e)}}}}();(function(){var e="ueditor_preference";UE.Editor.prototype.setPreferences=function(t,i){var n={};if(utils.isString(t)){n[t]=i}else{n=t}var r=LocalStorage.getLocalData(e);if(r&&(r=utils.str2json(r))){utils.extend(r,n)}else{r=n}r&&LocalStorage.saveLocalData(e,utils.json2str(r))};UE.Editor.prototype.getPreferences=function(t){var i=LocalStorage.getLocalData(e);if(i&&(i=utils.str2json(i))){return t?i[t]:i}return null};UE.Editor.prototype.removePreferences=function(t){var i=LocalStorage.getLocalData(e);if(i&&(i=utils.str2json(i))){i[t]=undefined;delete i[t]}i&&LocalStorage.saveLocalData(e,utils.json2str(i))}})();UE.plugins["defaultfilter"]=function(){var e=this;e.setOpt({allowDivTransToP:true,disabledTableInTable:true});e.addInputRule(function(t){var i=this.options.allowDivTransToP;var n;function r(e){while(e&&e.type=="element"){if(e.tagName=="td"){return true}e=e.parentNode}return false}t.traversal(function(t){if(t.type=="element"){if(!dtd.$cdata[t.tagName]&&e.options.autoClearEmptyNode&&dtd.$inline[t.tagName]&&!dtd.$empty[t.tagName]&&(!t.attrs||utils.isEmptyObject(t.attrs))){if(!t.firstChild())t.parentNode.removeChild(t);else if(t.tagName=="span"&&(!t.attrs||utils.isEmptyObject(t.attrs))){t.parentNode.removeChild(t,true)}return}switch(t.tagName){case"style":case"script":t.setAttr({cdata_tag:t.tagName,cdata_data:t.innerHTML()||"",_ue_custom_node_:"true"});t.tagName="div";t.innerHTML("");break;case"a":if(n=t.getAttr("href")){t.setAttr("_href",n)}break;case"img":t.setAttr("_src",t.getAttr("src"));break;case"span":if(browser.webkit&&(n=t.getStyle("white-space"))){if(/nowrap|normal/.test(n)){t.setStyle("white-space","");if(e.options.autoClearEmptyNode&&utils.isEmptyObject(t.attrs)){t.parentNode.removeChild(t,true)}}}n=t.getAttr("id");if(n&&/^_baidu_bookmark_/i.test(n)){t.parentNode.removeChild(t)}break;case"p":if(n=t.getAttr("align")){t.setAttr("align");t.setStyle("text-align",n)}utils.each(t.children,function(e){if(e.type=="element"&&e.tagName=="p"){var i=e.nextSibling();t.parentNode.insertAfter(e,t);var n=e;while(i){var r=i.nextSibling();t.parentNode.insertAfter(i,n);n=i;i=r}return false}});if(!t.firstChild()){t.innerHTML(browser.ie?"&nbsp;":"<br/>")}break;case"div":if(t.getAttr("cdata_tag")){break}n=t.getAttr("class");if(n&&/^line number\d+/.test(n)){break}if(!i){break}var o,a=UE.uNode.createElement("p");while(o=t.firstChild()){if(o.type=="text"||!UE.dom.dtd.$block[o.tagName]){a.appendChild(o)}else{if(a.firstChild()){t.parentNode.insertBefore(a,t);a=UE.uNode.createElement("p")}else{t.parentNode.insertBefore(o,t)}}}if(a.firstChild()){t.parentNode.insertBefore(a,t)}t.parentNode.removeChild(t);break;case"dl":t.tagName="ul";break;case"dt":case"dd":t.tagName="li";break;case"li":var s=t.getAttr("class");if(!s||!/list\-/.test(s)){t.setAttr()}var l=t.getNodesByTagName("ol ul");UE.utils.each(l,function(e){t.parentNode.insertAfter(e,t)});break;case"td":case"th":case"caption":if(!t.children||!t.children.length){t.appendChild(browser.ie11below?UE.uNode.createText(" "):UE.uNode.createElement("br"))}break;case"table":if(e.options.disabledTableInTable&&r(t)){t.parentNode.insertBefore(UE.uNode.createText(t.innerText()),t);t.parentNode.removeChild(t)}}}})});e.addOutputRule(function(t){var i;t.traversal(function(t){if(t.type=="element"){if(e.options.autoClearEmptyNode&&dtd.$inline[t.tagName]&&!dtd.$empty[t.tagName]&&(!t.attrs||utils.isEmptyObject(t.attrs))){if(!t.firstChild())t.parentNode.removeChild(t);else if(t.tagName=="span"&&(!t.attrs||utils.isEmptyObject(t.attrs))){t.parentNode.removeChild(t,true)}return}switch(t.tagName){case"div":if(i=t.getAttr("cdata_tag")){t.tagName=i;t.appendChild(UE.uNode.createText(t.getAttr("cdata_data")));t.setAttr({cdata_tag:"",cdata_data:"",_ue_custom_node_:""})}break;case"a":if(i=t.getAttr("_href")){t.setAttr({href:utils.html(i),_href:""})}break;break;case"span":i=t.getAttr("id");if(i&&/^_baidu_bookmark_/i.test(i)){t.parentNode.removeChild(t)}break;case"img":if(i=t.getAttr("_src")){t.setAttr({src:t.getAttr("_src"),_src:""})}}}})})};UE.commands["inserthtml"]={execCommand:function(e,t,i){var n=this,r,o;if(!t){return}if(n.fireEvent("beforeinserthtml",t)===true){return}r=n.selection.getRange();o=r.document.createElement("div");o.style.display="inline";if(!i){var a=UE.htmlparser(t);if(n.options.filterRules){UE.filterNode(a,n.options.filterRules)}n.filterInputRule(a);t=a.toHtml()}o.innerHTML=utils.trim(t);if(!r.collapsed){var s=r.startContainer;if(domUtils.isFillChar(s)){r.setStartBefore(s)}s=r.endContainer;if(domUtils.isFillChar(s)){r.setEndAfter(s)}r.txtToElmBoundary();if(r.endContainer&&r.endContainer.nodeType==1){s=r.endContainer.childNodes[r.endOffset];if(s&&domUtils.isBr(s)){r.setEndAfter(s)}}if(r.startOffset==0){s=r.startContainer;if(domUtils.isBoundaryNode(s,"firstChild")){s=r.endContainer;if(r.endOffset==(s.nodeType==3?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild")){n.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";r.setStart(n.body.firstChild,0).collapse(true)}}}!r.collapsed&&r.deleteContents();if(r.startContainer.nodeType==1){var l=r.startContainer.childNodes[r.startOffset],d;if(l&&domUtils.isBlockElm(l)&&(d=l.previousSibling)&&domUtils.isBlockElm(d)){r.setEnd(d,d.childNodes.length).collapse();while(l.firstChild){d.appendChild(l.firstChild)}domUtils.remove(l)}}}var l,u,d,c,f=0,m;if(r.inFillChar()){l=r.startContainer;if(domUtils.isFillChar(l)){r.setStartBefore(l).collapse(true);domUtils.remove(l)}else if(domUtils.isFillChar(l,true)){l.nodeValue=l.nodeValue.replace(fillCharReg,"");r.startOffset--;r.collapsed&&r.collapse(true)}}var h=domUtils.findParentByTagName(r.startContainer,"li",true);if(h){var p,g;while(l=o.firstChild){while(l&&(l.nodeType==3||!domUtils.isBlockElm(l)||l.tagName=="HR")){p=l.nextSibling;r.insertNode(l).collapse();g=l;l=p}if(l){if(/^(ol|ul)$/i.test(l.tagName)){while(l.firstChild){g=l.firstChild;domUtils.insertAfter(h,l.firstChild);h=h.nextSibling}domUtils.remove(l)}else{var v;p=l.nextSibling;v=n.document.createElement("li");domUtils.insertAfter(h,v);v.appendChild(l);g=l;l=p;h=v}}}h=domUtils.findParentByTagName(r.startContainer,"li",true);if(domUtils.isEmptyBlock(h)){domUtils.remove(h)}if(g){r.setStartAfter(g).collapse(true).select(true)}}else{while(l=o.firstChild){if(f){var b=n.document.createElement("p");while(l&&(l.nodeType==3||!dtd.$block[l.tagName])){m=l.nextSibling;b.appendChild(l);l=m}if(b.firstChild){l=b}}r.insertNode(l);m=l.nextSibling;if(!f&&l.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(l)){u=domUtils.findParent(l,function(e){return domUtils.isBlockElm(e)});if(u&&u.tagName.toLowerCase()!="body"&&!(dtd[u.tagName][l.nodeName]&&l.parentNode===u)){if(!dtd[u.tagName][l.nodeName]){d=u}else{c=l.parentNode;while(c!==u){d=c;c=c.parentNode}}domUtils.breakParent(l,d||c);var d=l.previousSibling;domUtils.trimWhiteTextNode(d);if(!d.childNodes.length){domUtils.remove(d)}if(!browser.ie&&(p=l.nextSibling)&&domUtils.isBlockElm(p)&&p.lastChild&&!domUtils.isBr(p.lastChild)){p.appendChild(n.document.createElement("br"))}f=1}}var p=l.nextSibling;if(!o.firstChild&&p&&domUtils.isBlockElm(p)){r.setStart(p,0).collapse(true);break}r.setEndAfter(l).collapse()}l=r.startContainer;if(m&&domUtils.isBr(m)){domUtils.remove(m)}if(domUtils.isBlockElm(l)&&domUtils.isEmptyNode(l)){if(m=l.nextSibling){domUtils.remove(l);if(m.nodeType==1&&dtd.$block[m.tagName]){r.setStart(m,0).collapse(true).shrinkBoundary()}}else{try{l.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(e){r.setStartBefore(l);domUtils.remove(l)}}}try{r.select(true)}catch(e){}}setTimeout(function(){r=n.selection.getRange();r.scrollToView(n.autoHeightEnabled,n.autoHeightEnabled?domUtils.getXY(n.iframe).y:0);n.fireEvent("afterinserthtml",t)},200)}};UE.plugin.register("autosubmit",function(){return{shortcutkey:{autosubmit:"ctrl+13"},commands:{autosubmit:{execCommand:function(){var e=this,t=domUtils.findParentByTagName(e.iframe,"form",false);if(t){if(e.fireEvent("beforesubmit")===false){return}e.sync();$(t).find("input[type=submit]").click()}}}}}});UE.commands["imagefloat"]={execCommand:function(e,t){var i=this,n=i.selection.getRange();if(!n.collapsed){var r=n.getClosedNode();if(r&&r.tagName=="IMG"){switch(t){case"left":case"right":case"none":var o=r.parentNode,a,s,l;while(dtd.$inline[o.tagName]||o.tagName=="A"){o=o.parentNode}a=o;if(a.tagName=="P"&&domUtils.getStyle(a,"text-align")=="center"){if(!domUtils.isBody(a)&&domUtils.getChildCount(a,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1){s=a.previousSibling;l=a.nextSibling;if(s&&l&&s.nodeType==1&&l.nodeType==1&&s.tagName==l.tagName&&domUtils.isBlockElm(s)){s.appendChild(a.firstChild);while(l.firstChild){s.appendChild(l.firstChild)}domUtils.remove(a);domUtils.remove(l)}else{domUtils.setStyle(a,"text-align","")}}n.selectNode(r).select()}domUtils.setStyle(r,"float",t=="none"?"":t);if(t=="none"){domUtils.removeAttributes(r,"align")}break;case"center":if(i.queryCommandValue("imagefloat")!="center"){o=r.parentNode;domUtils.setStyle(r,"float","");domUtils.removeAttributes(r,"align");a=r;while(o&&domUtils.getChildCount(o,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1&&(dtd.$inline[o.tagName]||o.tagName=="A")){a=o;o=o.parentNode}n.setStartBefore(a).setCursor(false);o=i.document.createElement("div");o.appendChild(a);domUtils.setStyle(a,"float","");i.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+o.innerHTML+"</p>");a=i.document.getElementById("_img_parent_tmp");a.removeAttribute("id");a=a.firstChild;n.selectNode(a).select();l=a.parentNode.nextSibling;if(l&&domUtils.isEmptyNode(l)){domUtils.remove(l)}}break}}}},queryCommandValue:function(){var e=this.selection.getRange(),t,i;if(e.collapsed){return"none"}t=e.getClosedNode();if(t&&t.nodeType==1&&t.tagName=="IMG"){i=domUtils.getComputedStyle(t,"float")||t.getAttribute("align");if(i=="none"){
i=domUtils.getComputedStyle(t.parentNode,"text-align")=="center"?"center":i}return{left:1,right:1,center:1}[i]?i:"none"}return"none"},queryCommandState:function(){var e=this.selection.getRange(),t;if(e.collapsed)return-1;t=e.getClosedNode();if(t&&t.nodeType==1&&t.tagName=="IMG"){return 0}return-1}};UE.commands["insertimage"]={execCommand:function(e,t){t=utils.isArray(t)?t:[t];if(!t.length){return}var i=this,n=i.selection.getRange(),r=n.getClosedNode();if(i.fireEvent("beforeinsertimage",t)===true){return}function o(e){utils.each("width,height,border,hspace,vspace".split(","),function(t){if(e[t]){e[t]=parseInt(e[t],10)||0}});utils.each("src,_src".split(","),function(t){if(e[t]){e[t]=utils.unhtmlForUrl(e[t])}});utils.each("title,alt".split(","),function(t){if(e[t]){e[t]=utils.unhtml(e[t])}})}if(r&&/img/i.test(r.tagName)&&(r.className!="edui-faked-video"||r.className.indexOf("edui-upload-video")!=-1)&&!r.getAttribute("word_img")){var a=t.shift();var s=a["floatStyle"];delete a["floatStyle"];domUtils.setAttributes(r,a);i.execCommand("imagefloat",s);if(t.length>0){n.setStartAfter(r).setCursor(false,true);i.execCommand("insertimage",t)}}else{var l=[],d="",u;u=t[0];if(t.length==1){o(u);d='<img src="'+u.src+'" '+(u._src?' _src="'+u._src+'" ':"")+(u.width?'width="'+u.width+'" ':"")+(u.height?' height="'+u.height+'" ':"")+(u["floatStyle"]=="left"||u["floatStyle"]=="right"?' style="float:'+u["floatStyle"]+';"':"")+(u.title&&u.title!=""?' title="'+u.title+'"':"")+(u.border&&u.border!="0"?' border="'+u.border+'"':"")+(u.alt&&u.alt!=""?' alt="'+u.alt+'"':"")+(u.hspace&&u.hspace!="0"?' hspace = "'+u.hspace+'"':"")+(u.vspace&&u.vspace!="0"?' vspace = "'+u.vspace+'"':"")+"/>";if(u["floatStyle"]=="center"){d='<p style="text-align: center">'+d+"</p>"}l.push(d)}else{for(var c=0;u=t[c++];){o(u);d="<p "+(u["floatStyle"]=="center"?'style="text-align: center" ':"")+'><img src="'+u.src+'" '+(u.width?'width="'+u.width+'" ':"")+(u._src?' _src="'+u._src+'" ':"")+(u.height?' height="'+u.height+'" ':"")+' style="'+(u["floatStyle"]&&u["floatStyle"]!="center"?"float:"+u["floatStyle"]+";":"")+(u.border||"")+'" '+(u.title?' title="'+u.title+'"':"")+" /></p>";l.push(d)}}i.execCommand("insertHtml",l.join(""))}i.fireEvent("afterinsertimage",t)}};UE.plugins["justify"]=function(){var e=this,t=domUtils.isBlockElm,i={left:1,right:1,center:1,justify:1},n=function(e,i){var n=e.createBookmark(),r=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)};e.enlarge(true);var o=e.createBookmark(),a=domUtils.getNextDomNode(o.start,false,r),s=e.cloneRange(),l;while(a&&!(domUtils.getPosition(a,o.end)&domUtils.POSITION_FOLLOWING)){if(a.nodeType==3||!t(a)){s.setStartBefore(a);while(a&&a!==o.end&&!t(a)){l=a;a=domUtils.getNextDomNode(a,false,null,function(e){return!t(e)})}s.setEndAfter(l);var d=s.getCommonAncestor();if(!domUtils.isBody(d)&&t(d)){domUtils.setStyles(d,utils.isString(i)?{"text-align":i}:i);a=d}else{var u=e.document.createElement("p");domUtils.setStyles(u,utils.isString(i)?{"text-align":i}:i);var c=s.extractContents();u.appendChild(c);s.insertNode(u);a=u}a=domUtils.getNextDomNode(a,false,r)}else{a=domUtils.getNextDomNode(a,true,r)}}return e.moveToBookmark(o).moveToBookmark(n)};UE.commands["justify"]={execCommand:function(e,t){var i=this.selection.getRange(),r;if(i.collapsed){r=this.document.createTextNode("p");i.insertNode(r)}n(i,t);if(r){i.setStartBefore(r).collapse(true);domUtils.remove(r)}i.select();return true},queryCommandValue:function(){var e=this.selection.getStart(),t=domUtils.getComputedStyle(e,"text-align");return i[t]?t:"left"},queryCommandState:function(){var e=this.selection.getStart(),t=e&&domUtils.findParentByTagName(e,["td","th","caption"],true);return t?-1:0}}};UE.plugins["font"]=function(){var e=this,t={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},i={underline:1,strikethrough:1,fontborder:1},n={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]});function r(e){var t;while(t=e.parentNode){if(t.tagName=="SPAN"&&domUtils.getChildCount(t,function(e){return!domUtils.isBookmarkNode(e)&&!domUtils.isBr(e)})==1){t.style.cssText+=e.style.cssText;domUtils.remove(e,true);e=t}else{break}}}function o(e,t,i){if(n[t]){e.adjustmentBoundary();if(!e.collapsed&&e.startContainer.nodeType==1){var r=e.startContainer.childNodes[e.startOffset];if(r&&domUtils.isTagNode(r,"span")){var o=e.createBookmark();utils.each(domUtils.getElementsByTagName(r,"span"),function(e){if(!e.parentNode||domUtils.isBookmarkNode(e))return;if(t=="backcolor"&&domUtils.getComputedStyle(e,"background-color").toLowerCase()===i){return}domUtils.removeStyle(e,n[t]);if(e.style.cssText.replace(/^\s+$/,"").length==0){domUtils.remove(e,true)}});e.moveToBookmark(o)}}}}function a(e,t,i){var n=e.collapsed,a=e.createBookmark(),s;if(n){s=a.start.parentNode;while(dtd.$inline[s.tagName]){s=s.parentNode}}else{s=domUtils.getCommonAncestor(a.start,a.end)}utils.each(domUtils.getElementsByTagName(s,"span"),function(e){if(!e.parentNode||domUtils.isBookmarkNode(e))return;if(/\s*border\s*:\s*none;?\s*/i.test(e.style.cssText)){if(/^\s*border\s*:\s*none;?\s*$/.test(e.style.cssText)){domUtils.remove(e,true)}else{domUtils.removeStyle(e,"border")}return}if(/border/i.test(e.style.cssText)&&e.parentNode.tagName=="SPAN"&&/border/i.test(e.parentNode.style.cssText)){e.style.cssText=e.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")}if(!(t=="fontborder"&&i=="none")){var n=e.nextSibling;while(n&&n.nodeType==1&&n.tagName=="SPAN"){if(domUtils.isBookmarkNode(n)&&t=="fontborder"){e.appendChild(n);n=e.nextSibling;continue}if(n.style.cssText==e.style.cssText){domUtils.moveChild(n,e);domUtils.remove(n)}if(e.nextSibling===n)break;n=e.nextSibling}}r(e);if(browser.ie&&browser.version>8){var o=domUtils.findParent(e,function(e){return e.tagName=="SPAN"&&/background-color/.test(e.style.cssText)});if(o&&!/background-color/.test(e.style.cssText)){e.style.backgroundColor=o.style.backgroundColor}}});e.moveToBookmark(a);o(e,t,i)}e.addInputRule(function(e){utils.each(e.getNodesByTagName("u s del font strike"),function(e){if(e.tagName=="font"){var t=[];for(var i in e.attrs){switch(i){case"size":t.push("font-size:"+({1:"10",2:"12",3:"16",4:"18",5:"24",6:"32",7:"48"}[e.attrs[i]]||e.attrs[i])+"px");break;case"color":t.push("color:"+e.attrs[i]);break;case"face":t.push("font-family:"+e.attrs[i]);break;case"style":t.push(e.attrs[i])}}e.attrs={style:t.join(";")}}else{var n=e.tagName=="u"?"underline":"line-through";e.attrs={style:(e.getAttr("style")||"")+"text-decoration:"+n+";"}}e.tagName="span"})});for(var s in t){(function(e,t){UE.commands[e]={execCommand:function(n,r){r=r||(this.queryCommandState(n)?"none":n=="underline"?"underline":n=="fontborder"?"1px solid #000":"line-through");var o=this,s=this.selection.getRange(),l;if(r=="default"){if(s.collapsed){l=o.document.createTextNode("font");s.insertNode(l).select()}o.execCommand("removeFormat","span,a",t);if(l){s.setStartBefore(l).collapse(true);domUtils.remove(l)}a(s,n,r);s.select()}else{if(!s.collapsed){if(i[e]&&o.queryCommandValue(e)){o.execCommand("removeFormat","span,a",t)}s=o.selection.getRange();s.applyInlineStyle("span",{style:t+":"+r});a(s,n,r);s.select()}else{var d=domUtils.findParentByTagName(s.startContainer,"span",true);l=o.document.createTextNode("font");if(d&&!d.children.length&&!d[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){s.insertNode(l);if(i[e]){s.selectNode(l).select();o.execCommand("removeFormat","span,a",t,null);d=domUtils.findParentByTagName(l,"span",true);s.setStartBefore(l)}d&&(d.style.cssText+=";"+t+":"+r);s.collapse(true).select()}else{s.insertNode(l);s.selectNode(l).select();d=s.document.createElement("span");if(i[e]){if(domUtils.findParentByTagName(l,"a",true)){s.setStartBefore(l).setCursor();domUtils.remove(l);return}o.execCommand("removeFormat","span,a",t)}d.style.cssText=t+":"+r;l.parentNode.insertBefore(d,l);if(!browser.ie||browser.ie&&browser.version==9){var u=d.parentNode;while(!domUtils.isBlockElm(u)){if(u.tagName=="SPAN"){d.style.cssText=u.style.cssText+";"+d.style.cssText}u=u.parentNode}}if(opera){setTimeout(function(){s.setStart(d,0).collapse(true);a(s,n,r);s.select()})}else{s.setStart(d,0).collapse(true);a(s,n,r);s.select()}}domUtils.remove(l)}}return true},queryCommandValue:function(e){var i=this.selection.getStart();if(e=="underline"||e=="strikethrough"){var n=i,r;while(n&&!domUtils.isBlockElm(n)&&!domUtils.isBody(n)){if(n.nodeType==1){r=domUtils.getComputedStyle(n,t);if(r!="none"){return r}}n=n.parentNode}return"none"}if(e=="fontborder"){var o=i,a;while(o&&dtd.$inline[o.tagName]){if(a=domUtils.getComputedStyle(o,"border")){if(/1px/.test(a)&&/solid/.test(a)){return a}}o=o.parentNode}return""}if(e=="FontSize"){var s=domUtils.getComputedStyle(i,t),o=/^([\d\.]+)(\w+)$/.exec(s);if(o){return Math.floor(o[1])+o[2]}return s}return domUtils.getComputedStyle(i,t)},queryCommandState:function(e){if(!i[e])return 0;var t=this.queryCommandValue(e);if(e=="fontborder"){return/1px/.test(t)&&/solid/.test(t)}else{return e=="underline"?/underline/.test(t):/line\-through/.test(t)}}}})(s,t[s])}};UE.plugins["link"]=function(){function e(e){var t=e.startContainer,i=e.endContainer;if(t=domUtils.findParentByTagName(t,"a",true)){e.setStartBefore(t)}if(i=domUtils.findParentByTagName(i,"a",true)){e.setEndAfter(i)}}UE.commands["unlink"]={execCommand:function(){var t=this.selection.getRange(),i;if(t.collapsed&&!domUtils.findParentByTagName(t.startContainer,"a",true)){return}i=t.createBookmark();e(t);t.removeInlineStyle("a").moveToBookmark(i).select()},queryCommandState:function(){return!this.highlight&&this.queryCommandValue("link")?0:-1}};function t(t,i,n){var r=t.cloneRange(),o=n.queryCommandValue("link");e(t=t.adjustmentBoundary());var a=t.startContainer;if(a.nodeType==1&&o){a=a.childNodes[t.startOffset];if(a&&a.nodeType==1&&a.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(a[browser.ie?"innerText":"textContent"])){a[browser.ie?"innerText":"textContent"]=utils.html(i.textValue||i.href)}}if(!r.collapsed||o){t.removeInlineStyle("a");r=t.cloneRange()}if(r.collapsed){var s=t.document.createElement("a"),l="";if(i.textValue){l=utils.html(i.textValue);delete i.textValue}else{l=utils.html(i.href)}domUtils.setAttributes(s,i);a=domUtils.findParentByTagName(r.startContainer,"a",true);if(a&&domUtils.isInNodeEndBoundary(r,a)){t.setStartAfter(a).collapse(true)}s[browser.ie?"innerText":"textContent"]=l;t.insertNode(s).selectNode(s)}else{t.applyInlineStyle("a",i)}}UE.commands["link"]={execCommand:function(e,i){var n;i._href&&(i._href=utils.unhtml(i._href,/[<">]/g));i.href&&(i.href=utils.unhtml(i.href,/[<">]/g));i.textValue&&(i.textValue=utils.unhtml(i.textValue,/[<">]/g));t(n=this.selection.getRange(),i,this);n.collapse().select(true)},queryCommandValue:function(){var e=this.selection.getRange(),t;if(e.collapsed){t=e.startContainer;t=t.nodeType==1?t:t.parentNode;if(t&&(t=domUtils.findParentByTagName(t,"a",true))&&!domUtils.isInNodeEndBoundary(e,t)){return t}}else{e.shrinkBoundary();var i=e.startContainer.nodeType==3||!e.startContainer.childNodes[e.startOffset]?e.startContainer:e.startContainer.childNodes[e.startOffset],n=e.endContainer.nodeType==3||e.endOffset==0?e.endContainer:e.endContainer.childNodes[e.endOffset-1],r=e.getCommonAncestor();t=domUtils.findParentByTagName(r,"a",true);if(!t&&r.nodeType==1){var o=r.getElementsByTagName("a"),a,s;for(var l=0,d;d=o[l++];){a=domUtils.getPosition(d,i),s=domUtils.getPosition(d,n);if((a&domUtils.POSITION_FOLLOWING||a&domUtils.POSITION_CONTAINS)&&(s&domUtils.POSITION_PRECEDING||s&domUtils.POSITION_CONTAINS)){t=d;break}}}return t}},queryCommandState:function(){var e=this.selection.getRange().getClosedNode(),t=e&&(e.className=="edui-faked-video"||e.className.indexOf("edui-upload-video")!=-1);return t?-1:0}}};UE.plugins["removeformat"]=function(){var e=this;e.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"});e.commands["removeformat"]={execCommand:function(e,t,i,n,r){var o=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),a=i?[]:(n||this.options.removeFormatAttributes).split(","),s=new dom.Range(this.document),l,d,u,c=function(e){return e.nodeType==1};function f(e){if(e.nodeType==3||e.tagName.toLowerCase()!="span"){return 0}if(browser.ie){var t=e.attributes;if(t.length){for(var i=0,n=t.length;i<n;i++){if(t[i].specified){return 0}}return 1}}return!e.attributes.length}function m(e){var t=e.createBookmark();if(e.collapsed){e.enlarge(true)}if(!r){var n=domUtils.findParentByTagName(e.startContainer,"a",true);if(n){e.setStartBefore(n)}n=domUtils.findParentByTagName(e.endContainer,"a",true);if(n){e.setEndAfter(n)}}l=e.createBookmark();h=l.start;while((u=h.parentNode)&&!domUtils.isBlockElm(u)){domUtils.breakParent(h,u);domUtils.clearEmptySibling(h)}if(l.end){h=l.end;while((u=h.parentNode)&&!domUtils.isBlockElm(u)){domUtils.breakParent(h,u);domUtils.clearEmptySibling(h)}var s=domUtils.getNextDomNode(l.start,false,c),d;while(s){if(s==l.end){break}d=domUtils.getNextDomNode(s,true,c);if(!dtd.$empty[s.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(s)){if(o.test(s.tagName)){if(i){domUtils.removeStyle(s,i);if(f(s)&&i!="text-decoration"){domUtils.remove(s,true)}}else{domUtils.remove(s,true)}}else{if(!dtd.$tableContent[s.tagName]&&!dtd.$list[s.tagName]){domUtils.removeAttributes(s,a);if(f(s)){domUtils.remove(s,true)}}}}s=d}}var m=l.start.parentNode;if(domUtils.isBlockElm(m)&&!dtd.$tableContent[m.tagName]&&!dtd.$list[m.tagName]){domUtils.removeAttributes(m,a)}m=l.end.parentNode;if(l.end&&domUtils.isBlockElm(m)&&!dtd.$tableContent[m.tagName]&&!dtd.$list[m.tagName]){domUtils.removeAttributes(m,a)}e.moveToBookmark(l).moveToBookmark(t);var h=e.startContainer,p,g=e.collapsed;while(h.nodeType==1&&domUtils.isEmptyNode(h)&&dtd.$removeEmpty[h.tagName]){p=h.parentNode;e.setStartBefore(h);if(e.startContainer===e.endContainer){e.endOffset--}domUtils.remove(h);h=p}if(!g){h=e.endContainer;while(h.nodeType==1&&domUtils.isEmptyNode(h)&&dtd.$removeEmpty[h.tagName]){p=h.parentNode;e.setEndBefore(h);domUtils.remove(h);h=p}}}s=this.selection.getRange();m(s);s.select()}}};UE.plugins["blockquote"]=function(){var e=this;function t(e){return domUtils.filterNodeList(e.selection.getStartElementPath(),"blockquote")}e.commands["blockquote"]={execCommand:function(e,i){var n=this.selection.getRange(),r=t(this),o=dtd.blockquote,a=n.createBookmark();if(r){var s=n.startContainer,l=domUtils.isBlockElm(s)?s:domUtils.findParent(s,function(e){return domUtils.isBlockElm(e)}),d=n.endContainer,u=domUtils.isBlockElm(d)?d:domUtils.findParent(d,function(e){return domUtils.isBlockElm(e)});l=domUtils.findParentByTagName(l,"li",true)||l;u=domUtils.findParentByTagName(u,"li",true)||u;if(l.tagName=="LI"||l.tagName=="TD"||l===r||domUtils.isBody(l)){domUtils.remove(r,true)}else{domUtils.breakParent(l,r)}if(l!==u){r=domUtils.findParentByTagName(u,"blockquote");if(r){if(u.tagName=="LI"||u.tagName=="TD"||domUtils.isBody(u)){r.parentNode&&domUtils.remove(r,true)}else{domUtils.breakParent(u,r)}}}var c=domUtils.getElementsByTagName(this.document,"blockquote");for(var f=0,m;m=c[f++];){if(!m.childNodes.length){domUtils.remove(m)}else if(domUtils.getPosition(m,l)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(m,u)&domUtils.POSITION_PRECEDING){domUtils.remove(m,true)}}}else{var h=n.cloneRange(),p=h.startContainer.nodeType==1?h.startContainer:h.startContainer.parentNode,g=p,v=1;while(1){if(domUtils.isBody(p)){if(g!==p){if(n.collapsed){h.selectNode(g);v=0}else{h.setStartBefore(g)}}else{h.setStart(p,0)}break}if(!o[p.tagName]){if(n.collapsed){h.selectNode(g)}else{h.setStartBefore(g)}break}g=p;p=p.parentNode}if(v){g=p=p=h.endContainer.nodeType==1?h.endContainer:h.endContainer.parentNode;while(1){if(domUtils.isBody(p)){if(g!==p){h.setEndAfter(g)}else{h.setEnd(p,p.childNodes.length)}break}if(!o[p.tagName]){h.setEndAfter(g);break}g=p;p=p.parentNode}}p=n.document.createElement("blockquote");domUtils.setAttributes(p,i);p.appendChild(h.extractContents());h.insertNode(p);var b=domUtils.getElementsByTagName(p,"blockquote");for(var f=0,y;y=b[f++];){if(y.parentNode){domUtils.remove(y,true)}}}n.moveToBookmark(a).select()},queryCommandState:function(){return t(this)?1:0}}};UE.commands["touppercase"]=UE.commands["tolowercase"]={execCommand:function(e){var t=this;var i=t.selection.getRange();if(i.collapsed){return i}var n=i.createBookmark(),r=n.end,o=function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)},a=domUtils.getNextDomNode(n.start,false,o);while(a&&domUtils.getPosition(a,r)&domUtils.POSITION_PRECEDING){if(a.nodeType==3){a.nodeValue=a.nodeValue[e=="touppercase"?"toUpperCase":"toLowerCase"]()}a=domUtils.getNextDomNode(a,true,o);if(a===r){break}}i.moveToBookmark(n).select()}};UE.commands["indent"]={execCommand:function(){var e=this,t=e.queryCommandState("indent")?"0em":e.options.indentValue||"2em";e.execCommand("Paragraph","p",{style:"text-indent:"+t})},queryCommandState:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e&&e.style.textIndent&&parseInt(e.style.textIndent)?1:0}};UE.commands["preview"]={execCommand:function(){var e=window.open("","_blank",""),t=e.document;t.open();t.write('<!DOCTYPE html><html><head><meta charset="utf-8"/><script src="'+this.options.UEDITOR_HOME_URL+'ueditor.parse.js"></script><script>'+"setTimeout(function(){uParse('div',{rootPath: '"+this.options.UEDITOR_HOME_URL+"'})},300)"+"</script></head><body><div>"+this.getContent(null,null,true)+"</div></body></html>");t.close()},notNeedUndo:1};UE.plugins["paragraph"]=function(){var e=this,t=domUtils.isBlockElm,i=["TD","LI","PRE"],n=function(e,n,r,o){var a=e.createBookmark(),s=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)},l;e.enlarge(true);var d=e.createBookmark(),u=domUtils.getNextDomNode(d.start,false,s),c=e.cloneRange(),f;while(u&&!(domUtils.getPosition(u,d.end)&domUtils.POSITION_FOLLOWING)){if(u.nodeType==3||!t(u)){c.setStartBefore(u);while(u&&u!==d.end&&!t(u)){f=u;u=domUtils.getNextDomNode(u,false,null,function(e){return!t(e)})}c.setEndAfter(f);l=e.document.createElement(n);if(r){domUtils.setAttributes(l,r);if(o&&o=="customstyle"&&r.style){l.style.cssText=r.style}}l.appendChild(c.extractContents());if(domUtils.isEmptyNode(l)){domUtils.fillChar(e.document,l)}c.insertNode(l);var m=l.parentNode;if(t(m)&&!domUtils.isBody(l.parentNode)&&utils.indexOf(i,m.tagName)==-1){if(!(o&&o=="customstyle")){m.getAttribute("dir")&&l.setAttribute("dir",m.getAttribute("dir"));m.style.cssText&&(l.style.cssText=m.style.cssText+";"+l.style.cssText);m.style.textAlign&&!l.style.textAlign&&(l.style.textAlign=m.style.textAlign);m.style.textIndent&&!l.style.textIndent&&(l.style.textIndent=m.style.textIndent);m.style.padding&&!l.style.padding&&(l.style.padding=m.style.padding)}if(r&&/h\d/i.test(m.tagName)&&!/h\d/i.test(l.tagName)){domUtils.setAttributes(m,r);if(o&&o=="customstyle"&&r.style){m.style.cssText=r.style}domUtils.remove(l,true);l=m}else{domUtils.remove(l.parentNode,true)}}if(utils.indexOf(i,m.tagName)!=-1){u=m}else{u=l}u=domUtils.getNextDomNode(u,false,s)}else{u=domUtils.getNextDomNode(u,true,s)}}return e.moveToBookmark(d).moveToBookmark(a)};e.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});e.commands["paragraph"]={execCommand:function(e,t,i,r){var o=this.selection.getRange();if(o.collapsed){var a=this.document.createTextNode("p");o.insertNode(a);if(browser.ie){var s=a.previousSibling;if(s&&domUtils.isWhitespace(s)){domUtils.remove(s)}s=a.nextSibling;if(s&&domUtils.isWhitespace(s)){domUtils.remove(s)}}}o=n(o,t,i,r);if(a){o.setStartBefore(a).collapse(true);pN=a.parentNode;domUtils.remove(a);if(domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)){domUtils.fillNode(this.document,pN)}}if(browser.gecko&&o.collapsed&&o.startContainer.nodeType==1){var l=o.startContainer.childNodes[o.startOffset];if(l&&l.nodeType==1&&l.tagName.toLowerCase()==t){o.setStart(l,0).collapse(true)}}o.select();return true},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e?e.tagName.toLowerCase():""}}};(function(){var e=domUtils.isBlockElm,t=function(e){return domUtils.filterNodeList(e.selection.getStartElementPath(),function(e){return e&&e.nodeType==1&&e.getAttribute("dir")})},i=function(i,n,r){var o,a=function(e){return e.nodeType==1?!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)},s=t(n);if(s&&i.collapsed){s.setAttribute("dir",r);return i}o=i.createBookmark();i.enlarge(true);var l=i.createBookmark(),d=domUtils.getNextDomNode(l.start,false,a),u=i.cloneRange(),c;while(d&&!(domUtils.getPosition(d,l.end)&domUtils.POSITION_FOLLOWING)){if(d.nodeType==3||!e(d)){u.setStartBefore(d);while(d&&d!==l.end&&!e(d)){c=d;d=domUtils.getNextDomNode(d,false,null,function(t){return!e(t)})}u.setEndAfter(c);var f=u.getCommonAncestor();if(!domUtils.isBody(f)&&e(f)){f.setAttribute("dir",r);d=f}else{var m=i.document.createElement("p");m.setAttribute("dir",r);var h=u.extractContents();m.appendChild(h);u.insertNode(m);d=m}d=domUtils.getNextDomNode(d,false,a)}else{d=domUtils.getNextDomNode(d,true,a)}}return i.moveToBookmark(l).moveToBookmark(o)};UE.commands["directionality"]={execCommand:function(e,t){var n=this.selection.getRange();if(n.collapsed){var r=this.document.createTextNode("d");n.insertNode(r)}i(n,this,t);if(r){n.setStartBefore(r).collapse(true);domUtils.remove(r)}n.select();return true},queryCommandValue:function(){var e=t(this);return e?e.getAttribute("dir"):"ltr"}}})();UE.plugins["horizontal"]=function(){var e=this;e.commands["horizontal"]={execCommand:function(e){var t=this;if(t.queryCommandState(e)!==-1){t.execCommand("insertHtml","<hr>");var i=t.selection.getRange(),n=i.startContainer;if(n.nodeType==1&&!n.childNodes[i.startOffset]){var r;if(r=n.childNodes[i.startOffset-1]){if(r.nodeType==1&&r.tagName=="HR"){if(t.options.enterTag=="p"){r=t.document.createElement("p");i.insertNode(r);i.setStart(r,0).setCursor()}else{r=t.document.createElement("br");i.insertNode(r);i.setStartBefore(r).setCursor()}}}}return true}},queryCommandState:function(){return domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}};e.addListener("delkeydown",function(e,t){var i=this.selection.getRange();i.txtToElmBoundary(true);if(domUtils.isStartInblock(i)){var n=i.startContainer;var r=n.previousSibling;if(r&&domUtils.isTagNode(r,"hr")){domUtils.remove(r);i.select();domUtils.preventDefault(t);return true}}})};UE.plugins["insertcode"]=function(){var e=this;e.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",e.document)});e.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"});e.commands["insertcode"]={execCommand:function(e,t){var i=this,n=i.selection.getRange(),r=domUtils.findParentByTagName(n.startContainer,"pre",true);if(r){r.className="brush:"+t+";toolbar:true;"}else{var o="";if(n.collapsed){o=browser.ie&&browser.ie11below?browser.version<=8?"&nbsp;":"":"<br/>"}else{var a=n.extractContents();var s=i.document.createElement("div");s.appendChild(a);utils.each(UE.filterNode(UE.htmlparser(s.innerHTML.replace(/[\r\t]/g,"")),i.options.filterTxtRules).children,function(e){if(browser.ie&&browser.ie11below&&browser.version>8){if(e.type=="element"){if(e.tagName=="br"){o+="\n"}else if(!dtd.$empty[e.tagName]){utils.each(e.children,function(t){if(t.type=="element"){if(t.tagName=="br"){o+="\n"}else if(!dtd.$empty[e.tagName]){o+=t.innerText()}}else{o+=t.data}});if(!/\n$/.test(o)){o+="\n"}}}else{o+=e.data+"\n"}if(!e.nextSibling()&&/\n$/.test(o)){o=o.replace(/\n$/,"")}}else{if(browser.ie&&browser.ie11below){if(e.type=="element"){if(e.tagName=="br"){o+="<br>"}else if(!dtd.$empty[e.tagName]){utils.each(e.children,function(t){if(t.type=="element"){if(t.tagName=="br"){o+="<br>"}else if(!dtd.$empty[e.tagName]){o+=t.innerText()}}else{o+=t.data}});if(!/br>$/.test(o)){o+="<br>"}}}else{o+=e.data+"<br>"}if(!e.nextSibling()&&/<br>$/.test(o)){o=o.replace(/<br>$/,"")}}else{o+=e.type=="element"?dtd.$empty[e.tagName]?"":e.innerText():e.data;if(!/br\/?\s*>$/.test(o)){if(!e.nextSibling())return;o+="<br>"}}}})}i.execCommand("inserthtml",'<pre id="coder"class="brush:'+t+';toolbar:true">'+o+"</pre>",true);r=i.document.getElementById("coder");domUtils.removeAttributes(r,"id");var l=r.previousSibling;if(l&&(l.nodeType==3&&l.nodeValue.length==1&&browser.ie&&browser.version==6||domUtils.isEmptyBlock(l))){domUtils.remove(l)}var n=i.selection.getRange();if(domUtils.isEmptyBlock(r)){n.setStart(r,0).setCursor(false,true)}else{n.selectNodeContents(r).select()}}},queryCommandValue:function(){var e=this.selection.getStartElementPath();var t="";utils.each(e,function(e){if(e.nodeName=="PRE"){var i=e.className.match(/brush:([^;]+)/);t=i&&i[1]?i[1]:"";return false}});return t}};e.addInputRule(function(e){utils.each(e.getNodesByTagName("pre"),function(e){var t=e.getNodesByTagName("br");if(t.length){browser.ie&&browser.ie11below&&browser.version>8&&utils.each(t,function(e){var t=UE.uNode.createText("\n");e.parentNode.insertBefore(t,e);e.parentNode.removeChild(e)});return}if(browser.ie&&browser.ie11below&&browser.version>8)return;var i=e.innerText().split(/\n/);e.innerHTML("");utils.each(i,function(t){if(t.length){e.appendChild(UE.uNode.createText(t))}e.appendChild(UE.uNode.createElement("br"))})})});e.addOutputRule(function(e){utils.each(e.getNodesByTagName("pre"),function(e){var t="";utils.each(e.children,function(e){if(e.type=="text"){t+=e.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,"")}else{if(e.tagName=="br"){t+="\n"}else{t+=!dtd.$empty[e.tagName]?"":e.innerText()}}});e.innerText(t.replace(/(&nbsp;|\n)+$/,""))})});e.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,insertpbefore:1,insertpafter:1};var t=e.queryCommandState;e.queryCommandState=function(e){var t=this;if(!t.notNeedCodeQuery[e.toLowerCase()]&&t.selection&&t.queryCommandValue("insertcode")){return-1}return UE.Editor.prototype.queryCommandState.apply(this,arguments)};e.addListener("beforeenterkeydown",function(){var t=e.selection.getRange();var i=domUtils.findParentByTagName(t.startContainer,"pre",true);if(i){e.fireEvent("saveScene");if(!t.collapsed){t.deleteContents()}if(!browser.ie||browser.ie9above){var n=e.document.createElement("br"),i;t.insertNode(n).setStartAfter(n).collapse(true);var r=n.nextSibling;if(!r&&(!browser.ie||browser.version>10)){t.insertNode(n.cloneNode(false))}else{t.setStartAfter(n)}i=n.previousSibling;var o;while(i){o=i;i=i.previousSibling;if(!i||i.nodeName=="BR"){i=o;break}}if(i){var a="";while(i&&i.nodeName!="BR"&&new RegExp("^[\\s"+domUtils.fillChar+"]*$").test(i.nodeValue)){a+=i.nodeValue;i=i.nextSibling}if(i.nodeName!="BR"){var s=i.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)"));if(s&&s[1]){a+=s[1]}}if(a){a=e.document.createTextNode(a);t.insertNode(a).setStartAfter(a)}}t.collapse(true).select(true)}else{if(browser.version>8){var l=e.document.createTextNode("\n");var d=t.startContainer;if(t.startOffset==0){var u=d.previousSibling;if(u){t.insertNode(l);var c=e.document.createTextNode(" ");t.setStartAfter(l).insertNode(c).setStart(c,0).collapse(true).select(true)}}else{t.insertNode(l).setStartAfter(l);var c=e.document.createTextNode(" ");d=t.startContainer.childNodes[t.startOffset];if(d&&!/^\n/.test(d.nodeValue)){t.setStartBefore(l)}t.insertNode(c).setStart(c,0).collapse(true).select(true)}}else{var n=e.document.createElement("br");t.insertNode(n);t.insertNode(e.document.createTextNode(domUtils.fillChar));t.setStartAfter(n);i=n.previousSibling;var o;while(i){o=i;i=i.previousSibling;if(!i||i.nodeName=="BR"){i=o;break}}if(i){var a="";while(i&&i.nodeName!="BR"&&new RegExp("^[ "+domUtils.fillChar+"]*$").test(i.nodeValue)){a+=i.nodeValue;i=i.nextSibling}if(i.nodeName!="BR"){var s=i.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)"));if(s&&s[1]){a+=s[1]}}a=e.document.createTextNode(a);t.insertNode(a).setStartAfter(a)}t.collapse(true).select()}}e.fireEvent("saveScene");return true}});e.addListener("tabkeydown",function(t,i){var n=e.selection.getRange();var r=domUtils.findParentByTagName(n.startContainer,"pre",true);if(r){e.fireEvent("saveScene");if(i.shiftKey){}else{if(!n.collapsed){var o=n.createBookmark();var a=o.start.previousSibling;while(a){if(r.firstChild===a&&!domUtils.isBr(a)){r.insertBefore(e.document.createTextNode("    "),a);break}if(domUtils.isBr(a)){r.insertBefore(e.document.createTextNode("    "),a.nextSibling);break}a=a.previousSibling}var s=o.end;a=o.start.nextSibling;if(r.firstChild===o.start){r.insertBefore(e.document.createTextNode("    "),a.nextSibling)}while(a&&a!==s){if(domUtils.isBr(a)&&a.nextSibling){if(a.nextSibling===s){break}r.insertBefore(e.document.createTextNode("    "),a.nextSibling)}a=a.nextSibling}n.moveToBookmark(o).select()}else{var l=e.document.createTextNode("    ");n.insertNode(l).setStartAfter(l).collapse(true).select(true)}}e.fireEvent("saveScene");return true}});e.addListener("beforeinserthtml",function(e,t){var i=this,n=i.selection.getRange(),r=domUtils.findParentByTagName(n.startContainer,"pre",true);if(r){if(!n.collapsed){n.deleteContents()}var o="";if(browser.ie&&browser.version>8){utils.each(UE.filterNode(UE.htmlparser(t),i.options.filterTxtRules).children,function(e){if(e.type=="element"){if(e.tagName=="br"){o+="\n"}else if(!dtd.$empty[e.tagName]){utils.each(e.children,function(t){if(t.type=="element"){if(t.tagName=="br"){o+="\n"}else if(!dtd.$empty[e.tagName]){o+=t.innerText()}}else{o+=t.data}});if(!/\n$/.test(o)){o+="\n"}}}else{o+=e.data+"\n"}if(!e.nextSibling()&&/\n$/.test(o)){o=o.replace(/\n$/,"")}});var a=i.document.createTextNode(utils.html(o.replace(/&nbsp;/g," ")));n.insertNode(a).selectNode(a).select()}else{var s=i.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(t),i.options.filterTxtRules).children,function(e){if(e.type=="element"){if(e.tagName=="br"){s.appendChild(i.document.createElement("br"))}else if(!dtd.$empty[e.tagName]){utils.each(e.children,function(t){if(t.type=="element"){if(t.tagName=="br"){s.appendChild(i.document.createElement("br"))}else if(!dtd.$empty[e.tagName]){s.appendChild(i.document.createTextNode(utils.html(t.innerText().replace(/&nbsp;/g," "))))}}else{s.appendChild(i.document.createTextNode(utils.html(t.data.replace(/&nbsp;/g," "))))}});if(s.lastChild.nodeName!="BR"){s.appendChild(i.document.createElement("br"))}}}else{s.appendChild(i.document.createTextNode(utils.html(e.data.replace(/&nbsp;/g," "))))}if(!e.nextSibling()&&s.lastChild.nodeName=="BR"){s.removeChild(s.lastChild)}});n.insertNode(s).select()}return true}});e.addListener("keydown",function(e,t){var i=this,n=t.keyCode||t.which;if(n==40){var r=i.selection.getRange(),o,a=r.startContainer;if(r.collapsed&&(o=domUtils.findParentByTagName(r.startContainer,"pre",true))&&!o.nextSibling){var s=o.lastChild
;while(s&&s.nodeName=="BR"){s=s.previousSibling}if(s===a||r.startContainer===o&&r.startOffset==o.childNodes.length){i.execCommand("insertparagraph");domUtils.preventDefault(t)}}}});e.addListener("delkeydown",function(t,i){var n=this.selection.getRange();n.txtToElmBoundary(true);var r=n.startContainer;if(domUtils.isTagNode(r,"pre")&&n.collapsed&&domUtils.isStartInblock(n)){var o=e.document.createElement("p");domUtils.fillNode(e.document,o);r.parentNode.insertBefore(o,r);domUtils.remove(r);n.setStart(o,0).setCursor(false,true);domUtils.preventDefault(i);return true}})};UE.plugin.register("anchor",function(){return{bindEvents:{ready:function(){utils.cssRule("anchor",".anchorclass{background: url('"+this.options.themePath+this.options.theme+"/images/anchor.gif') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}",this.document)}},outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){var t;if(t=e.getAttr("anchorname")){e.tagName="a";e.setAttr({anchorname:"",name:t,class:""})}})},inputRule:function(e){utils.each(e.getNodesByTagName("a"),function(e){var t;if((t=e.getAttr("name"))&&!e.getAttr("href")){e.tagName="img";e.setAttr({anchorname:e.getAttr("name"),class:"anchorclass"});e.setAttr("name")}})},commands:{anchor:{execCommand:function(e,t){var i=this.selection.getRange(),n=i.getClosedNode();if(n&&n.getAttribute("anchorname")){if(t){n.setAttribute("anchorname",t)}else{i.setStartBefore(n).setCursor();domUtils.remove(n)}}else{if(t){var r=this.document.createElement("img");i.collapse(true);domUtils.setAttributes(r,{anchorname:t,class:"anchorclass"});i.insertNode(r).setStartAfter(r).setCursor(false,true)}}}}}}});UE.plugins["pagebreak"]=function(){var e=this,t=["td"];e.setOpt("pageBreakTag","_ueditor_page_break_tag_");function i(t){if(domUtils.isEmptyBlock(t)){var i=t.firstChild,n;while(i&&i.nodeType==1&&domUtils.isEmptyBlock(i)){n=i;i=i.firstChild}!n&&(n=t);domUtils.fillNode(e.document,n)}}e.ready(function(){utils.cssRule("pagebreak",".pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}",e.document)});function n(e){return e&&e.nodeType==1&&e.tagName=="HR"&&e.className=="pagebreak"}e.addInputRule(function(t){t.traversal(function(t){if(t.type=="text"&&t.data==e.options.pageBreakTag){var i=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');t.parentNode.insertBefore(i,t);t.parentNode.removeChild(t)}})});e.addOutputRule(function(t){utils.each(t.getNodesByTagName("hr"),function(t){if(t.getAttr("class")=="pagebreak"){var i=UE.uNode.createText(e.options.pageBreakTag);t.parentNode.insertBefore(i,t);t.parentNode.removeChild(t)}})});e.commands["pagebreak"]={execCommand:function(){var r=e.selection.getRange(),o=e.document.createElement("hr");domUtils.setAttributes(o,{class:"pagebreak",noshade:"noshade",size:"5"});domUtils.unSelectable(o);var a=domUtils.findParentByTagName(r.startContainer,t,true),s=[],l;if(a){switch(a.tagName){case"TD":l=a.parentNode;if(!l.previousSibling){var d=domUtils.findParentByTagName(l,"table");d.parentNode.insertBefore(o,d);s=domUtils.findParents(o,true)}else{l.parentNode.insertBefore(o,l);s=domUtils.findParents(o)}l=s[1];if(o!==l){domUtils.breakParent(o,l)}e.fireEvent("afteradjusttable",e.document)}}else{if(!r.collapsed){r.deleteContents();var u=r.startContainer;while(!domUtils.isBody(u)&&domUtils.isBlockElm(u)&&domUtils.isEmptyNode(u)){r.setStartBefore(u).collapse(true);domUtils.remove(u);u=r.startContainer}}r.insertNode(o);var l=o.parentNode,c;while(!domUtils.isBody(l)){domUtils.breakParent(o,l);c=o.nextSibling;if(c&&domUtils.isEmptyBlock(c)){domUtils.remove(c)}l=o.parentNode}c=o.nextSibling;var f=o.previousSibling;if(n(f)){domUtils.remove(f)}else{f&&i(f)}if(!c){var m=e.document.createElement("p");o.parentNode.appendChild(m);domUtils.fillNode(e.document,m);r.setStart(m,0).collapse(true)}else{if(n(c)){domUtils.remove(c)}else{i(c)}r.setEndAfter(o).collapse(false)}r.select(true)}}}};UE.plugins["dragdrop"]=function(){var e=this;e.ready(function(){domUtils.on(this.body,"dragend",function(){var t=e.selection.getRange();var i=t.getClosedNode()||e.selection.getStart();if(i&&i.tagName=="IMG"){var n=i.previousSibling,r;while(r=i.nextSibling){if(r.nodeType==1&&r.tagName=="SPAN"&&!r.firstChild){domUtils.remove(r)}else{break}}if((n&&n.nodeType==1&&!domUtils.isEmptyBlock(n)||!n)&&(!r||r&&!domUtils.isEmptyBlock(r))){if(n&&n.tagName=="P"&&!domUtils.isEmptyBlock(n)){n.appendChild(i);domUtils.moveChild(r,n);domUtils.remove(r)}else if(r&&r.tagName=="P"&&!domUtils.isEmptyBlock(r)){r.insertBefore(i,r.firstChild)}if(n&&n.tagName=="P"&&domUtils.isEmptyBlock(n)){domUtils.remove(n)}if(r&&r.tagName=="P"&&domUtils.isEmptyBlock(r)){domUtils.remove(r)}t.selectNode(i).select();e.fireEvent("saveScene")}}})});e.addListener("keyup",function(t,i){var n=i.keyCode||i.which;if(n==13){var r=e.selection.getRange(),o;if(o=domUtils.findParentByTagName(r.startContainer,"p",true)){if(domUtils.getComputedStyle(o,"text-align")=="center"){domUtils.removeStyle(o,"text-align")}}}})};UE.plugins["undo"]=function(){var e;var t=this,i=t.options.maxUndoCount||20,n=t.options.maxInputCount||20,r=new RegExp(domUtils.fillChar+"|</hr>","gi");var o={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var a=t.options.autoClearEmptyNode;function s(e,t){if(e.length!=t.length)return 0;for(var i=0,n=e.length;i<n;i++){if(e[i]!=t[i])return 0}return 1}function l(e,t){if(e.collapsed!=t.collapsed){return 0}if(!s(e.startAddress,t.startAddress)||!s(e.endAddress,t.endAddress)){return 0}return 1}function d(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0)}}this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index)}}this.restore(++this.index)}};this.restore=function(){var e=this.editor;var t=this.list[this.index];var i=UE.htmlparser(t.content.replace(r,""));e.options.autoClearEmptyNode=false;e.filterInputRule(i);e.options.autoClearEmptyNode=a;e.document.body.innerHTML=i.toHtml();e.fireEvent("afterscencerestore");if(browser.ie){utils.each(domUtils.getElementsByTagName(e.document,"td th caption p"),function(t){if(domUtils.isEmptyNode(t)){domUtils.fillNode(e.document,t)}})}try{var n=new dom.Range(e.document).moveToAddress(t.address);n.select(o[n.startContainer.nodeName.toLowerCase()])}catch(e){}this.update();this.clearKey();e.fireEvent("reset",true)};this.getScene=function(){var e=this.editor;var t=e.selection.getRange(),i=t.createAddress(false,true);e.fireEvent("beforegetscene");var n=UE.htmlparser(e.body.innerHTML);e.options.autoClearEmptyNode=false;e.filterOutputRule(n);e.options.autoClearEmptyNode=a;var r=n.toHtml();e.fireEvent("aftergetscene");return{address:i,content:r}};this.save=function(n,r){clearTimeout(e);var o=this.getScene(r),a=this.list[this.index];if(a&&a.content!=o.content){t.trigger("contentchange")}if(a&&a.content==o.content&&(n?1:l(a.address,o.address))){return}this.list=this.list.slice(0,this.index+1);this.list.push(o);if(this.list.length>i){this.list.shift()}this.index=this.list.length-1;this.clearKey();this.update()};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey()};this.clearKey=function(){f=0;m=null}}t.undoManger=new d;t.undoManger.editor=t;function u(){this.undoManger.save()}t.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)});t.addListener("reset",function(e,t){if(!t){this.undoManger.reset()}});t.commands["redo"]=t.commands["undo"]={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+(e.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var c={16:1,17:1,18:1,37:1,38:1,39:1,40:1},f=0,m;var h=false;t.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){h=true});domUtils.on(this.body,"compositionend",function(){h=false})});t.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var p=true;t.addListener("keydown",function(t,i){var r=this;var o=i.keyCode||i.which;if(!c[o]&&!i.ctrlKey&&!i.metaKey&&!i.shiftKey&&!i.altKey){if(h)return;if(!r.selection.getRange().collapsed){r.undoManger.save(false,true);p=false;return}if(r.undoManger.list.length==0){r.undoManger.save(true)}clearTimeout(e);function a(e){e.undoManger.save(false,true);e.fireEvent("selectionchange")}e=setTimeout(function(){if(h){var e=setInterval(function(){if(!h){a(r);clearInterval(e)}},300);return}a(r)},200);m=o;f++;if(f>=n){a(r)}}});t.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(!c[i]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(h)return;if(!p){this.undoManger.save(false,true);p=true}}});t.stopCmdUndo=function(){t.__hasEnterExecCommand=true};t.startCmdUndo=function(){t.__hasEnterExecCommand=false}};UE.plugins["paste"]=function(){function e(e){var t=this.document;if(t.getElementById("baidu_pastebin")){return}var i=this.selection.getRange(),n=i.createBookmark(),r=t.createElement("div");r.id="baidu_pastebin";browser.webkit&&r.appendChild(t.createTextNode(domUtils.fillChar+domUtils.fillChar));t.body.appendChild(r);n.start.style.display="";r.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(n.start).y+"px";i.selectNodeContents(r).select(true);setTimeout(function(){if(browser.webkit){for(var o=0,a=t.querySelectorAll("#baidu_pastebin"),s;s=a[o++];){if(domUtils.isEmptyNode(s)){domUtils.remove(s)}else{r=s;break}}}try{r.parentNode.removeChild(r)}catch(e){}i.moveToBookmark(n).select(true);e(r)},0)}var t=this;t.setOpt({retainOnlyLabelPasted:false});var i,n,r;function o(e){return e.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(e,t,i,n){i=i.toLowerCase();if({img:1}[i]){return e}n=n.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(e,t,i){if({src:1,href:1,name:1}[t.toLowerCase()]){return t+"="+i+" "}return""});if({span:1,div:1}[i]){return""}else{return"<"+t+i+" "+utils.trim(n)+">"}})}function a(e){var a;if(e.firstChild){var s=domUtils.getElementsByTagName(e,"span");for(var l=0,d;d=s[l++];){if(d.id=="_baidu_cut_start"||d.id=="_baidu_cut_end"){domUtils.remove(d)}}if(browser.webkit){var u=e.querySelectorAll("div br");for(var l=0,c;c=u[l++];){var f=c.parentNode;if(f.tagName=="DIV"&&f.childNodes.length==1){f.innerHTML="<p><br/></p>";domUtils.remove(f)}}var m=e.querySelectorAll("#baidu_pastebin");for(var l=0,h;h=m[l++];){var p=t.document.createElement("p");h.parentNode.insertBefore(p,h);while(h.firstChild){p.appendChild(h.firstChild)}domUtils.remove(h)}var g=e.querySelectorAll("meta");for(var l=0,v;v=g[l++];){domUtils.remove(v)}var u=e.querySelectorAll("br");for(l=0;v=u[l++];){if(/^apple-/i.test(v.className)){domUtils.remove(v)}}}if(browser.gecko){var b=e.querySelectorAll("[_moz_dirty]");for(l=0;v=b[l++];){v.removeAttribute("_moz_dirty")}}if(!browser.ie){var y=e.querySelectorAll("span.Apple-style-span");for(var l=0,v;v=y[l++];){domUtils.remove(v,true)}}a=e.innerHTML;a=UE.filterWord(a);var C=UE.htmlparser(a);if(t.options.filterRules){UE.filterNode(C,t.options.filterRules)}t.filterInputRule(C);if(browser.webkit){var w=C.lastChild();if(w&&w.type=="element"&&w.tagName=="br"){C.removeChild(w)}utils.each(t.body.querySelectorAll("div"),function(e){if(domUtils.isEmptyBlock(e)){domUtils.remove(e,true)}})}a={html:C.toHtml()};t.fireEvent("beforepaste",a,C);if(!a.html){return}C=UE.htmlparser(a.html,true);if(t.queryCommandState("pasteplain")===1){t.execCommand("insertHtml",UE.filterNode(C,t.options.filterTxtRules).toHtml(),true)}else{UE.filterNode(C,t.options.filterTxtRules);i=C.toHtml();n=a.html;r=t.selection.getRange().createAddress(true);t.execCommand("insertHtml",t.getOpt("retainOnlyLabelPasted")===true?o(n):n,true)}t.fireEvent("afterpaste",a)}}t.addListener("pasteTransfer",function(e,a){if(r&&i&&n&&i!=n){var s=t.selection.getRange();s.moveToAddress(r,true);if(!s.collapsed){while(!domUtils.isBody(s.startContainer)){var l=s.startContainer;if(l.nodeType==1){l=l.childNodes[s.startOffset];if(!l){s.setStartBefore(s.startContainer);continue}var d=l.previousSibling;if(d&&d.nodeType==3&&new RegExp("^[\n\r\t "+domUtils.fillChar+"]*$").test(d.nodeValue)){s.setStartBefore(d)}}if(s.startOffset==0){s.setStartBefore(s.startContainer)}else{break}}while(!domUtils.isBody(s.endContainer)){var u=s.endContainer;if(u.nodeType==1){u=u.childNodes[s.endOffset];if(!u){s.setEndAfter(s.endContainer);continue}var c=u.nextSibling;if(c&&c.nodeType==3&&new RegExp("^[\n\r\t"+domUtils.fillChar+"]*$").test(c.nodeValue)){s.setEndAfter(c)}}if(s.endOffset==s.endContainer[s.endContainer.nodeType==3?"nodeValue":"childNodes"].length){s.setEndAfter(s.endContainer)}else{break}}}s.deleteContents();s.select(true);t.__hasEnterExecCommand=true;var f=n;if(a===2){f=o(f)}else if(a){f=i}t.execCommand("inserthtml",f,true);t.__hasEnterExecCommand=false;var m=t.selection.getRange();while(!domUtils.isBody(m.startContainer)&&!m.startOffset&&m.startContainer[m.startContainer.nodeType==3?"nodeValue":"childNodes"].length){m.setStartBefore(m.startContainer)}var h=m.createAddress(true);r.endAddress=h.startAddress}});t.addListener("ready",function(){domUtils.on(t.body,"cut",function(){var e=t.selection.getRange();if(!e.collapsed&&t.undoManger){t.undoManger.save()}});domUtils.on(t.body,browser.ie||browser.opera?"keydown":"paste",function(i){if((browser.ie||browser.opera)&&(!i.ctrlKey&&!i.metaKey||i.keyCode!="86")){return}e.call(t,function(e){a(e)})})});t.commands["paste"]={execCommand:function(i){if(browser.ie){e.call(t,function(e){a(e)});t.document.execCommand("paste")}else{alert(t.getLang("pastemsg"))}}}};UE.plugins["pasteplain"]=function(){var e=this;e.setOpt({pasteplain:false,filterTxtRules:function(){function e(e){e.tagName="p";e.setStyle()}function t(e){e.parentNode.removeChild(e,true)}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:function(e){var t,i=UE.uNode.createElement("p");while(t=e.firstChild()){if(t.type=="text"||!UE.dom.dtd.$block[t.tagName]){i.appendChild(t)}else{if(i.firstChild()){e.parentNode.insertBefore(i,e);i=UE.uNode.createElement("p")}else{e.parentNode.insertBefore(t,e)}}}if(i.firstChild()){e.parentNode.insertBefore(i,e)}e.parentNode.removeChild(e)},ol:t,ul:t,dl:t,dt:t,dd:t,li:t,caption:e,th:e,tr:e,h1:e,h2:e,h3:e,h4:e,h5:e,h6:e,td:function(e){var t=!!e.innerText();if(t){e.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),e)}e.parentNode.removeChild(e,e.innerText())}}}()});var t=e.options.pasteplain;e.commands["pasteplain"]={queryCommandState:function(){return t?1:0},execCommand:function(){t=!t|0},notNeedUndo:1}};UE.plugins["list"]=function(){var e=this,t={TD:1,PRE:1,BLOCKQUOTE:1};var i={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"};e.setOpt({autoTransWordToList:false,insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1,disablePInList:false});function n(e){var t=[];for(var i in e){t.push(i)}return t}var r={OL:n(e.options.insertorderedlist),UL:n(e.options.insertunorderedlist)};var o=e.options.listiconpath;for(var a in i){if(!e.options.insertorderedlist.hasOwnProperty(a)&&!e.options.insertunorderedlist.hasOwnProperty(a)){delete i[a]}}e.ready(function(){var t=[];for(var n in i){if(n=="dash"||n=="dot"){t.push("li.list-"+i[n]+"{background-image:url("+o+i[n]+".gif)}");t.push("ul.custom_"+n+"{list-style:none;}ul.custom_"+n+" li{background-position:0 3px;background-repeat:no-repeat}")}else{for(var r=0;r<99;r++){t.push("li.list-"+i[n]+r+"{background-image:url("+o+"list-"+i[n]+r+".gif)}")}t.push("ol.custom_"+n+"{list-style:none;}ol.custom_"+n+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(n){case"cn":t.push("li.list-"+n+"-paddingleft-1{padding-left:25px}");t.push("li.list-"+n+"-paddingleft-2{padding-left:40px}");t.push("li.list-"+n+"-paddingleft-3{padding-left:55px}");break;case"cn1":t.push("li.list-"+n+"-paddingleft-1{padding-left:30px}");t.push("li.list-"+n+"-paddingleft-2{padding-left:40px}");t.push("li.list-"+n+"-paddingleft-3{padding-left:55px}");break;case"cn2":t.push("li.list-"+n+"-paddingleft-1{padding-left:40px}");t.push("li.list-"+n+"-paddingleft-2{padding-left:55px}");t.push("li.list-"+n+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":t.push("li.list-"+n+"-paddingleft-1{padding-left:25px}");break;case"num2":t.push("li.list-"+n+"-paddingleft-1{padding-left:35px}");t.push("li.list-"+n+"-paddingleft-2{padding-left:40px}");break;case"dash":t.push("li.list-"+n+"-paddingleft{padding-left:35px}");break;case"dot":t.push("li.list-"+n+"-paddingleft{padding-left:20px}")}}t.push(".list-paddingleft-1{padding-left:0}");t.push(".list-paddingleft-2{padding-left:"+e.options.listDefaultPaddingLeft+"px}");t.push(".list-paddingleft-3{padding-left:"+e.options.listDefaultPaddingLeft*2+"px}");utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+t.join("\n"),e.document)});e.ready(function(){domUtils.on(e.body,"cut",function(){setTimeout(function(){var t=e.selection.getRange(),i;if(!t.collapsed){if(i=domUtils.findParentByTagName(t.startContainer,"li",true)){if(!i.nextSibling&&domUtils.isEmptyBlock(i)){var n=i.parentNode,r;if(r=n.previousSibling){domUtils.remove(n);t.setStartAtLast(r).collapse(true);t.select(true)}else if(r=n.nextSibling){domUtils.remove(n);t.setStartAtFirst(r).collapse(true);t.select(true)}else{var o=e.document.createElement("p");domUtils.fillNode(e.document,o);n.parentNode.insertBefore(o,n);domUtils.remove(n);t.setStart(o,0).collapse(true);t.select(true)}}}}})})});function s(e){var t=e.className;if(domUtils.hasClass(e,/custom_/)){return t.match(/custom_(\w+)/)[1]}return domUtils.getStyle(e,"list-style-type")}e.addListener("beforepaste",function(e,t){var n=this,o=n.selection.getRange(),a;var l=UE.htmlparser(t.html,true);if(a=domUtils.findParentByTagName(o.startContainer,"li",true)){var d=a.parentNode,u=d.tagName=="OL"?"ul":"ol";utils.each(l.getNodesByTagName(u),function(t){t.tagName=d.tagName;t.setAttr();if(t.parentNode===l){e=s(d)||(d.tagName=="OL"?"decimal":"disc")}else{var n=t.parentNode.getAttr("class");if(n&&/custom_/.test(n)){e=n.match(/custom_(\w+)/)[1]}else{e=t.parentNode.getStyle("list-style-type")}if(!e){e=d.tagName=="OL"?"decimal":"disc"}}var o=utils.indexOf(r[d.tagName],e);if(t.parentNode!==l)o=o+1==r[d.tagName].length?0:o+1;var a=r[d.tagName][o];if(i[a]){t.setAttr("class","custom_"+a)}else{t.setStyle("list-style-type",a)}})}t.html=l.toHtml()});e.getOpt("disablePInList")===true&&e.addOutputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){var t=[],i=0;utils.each(e.children,function(n){if(n.tagName=="p"){var r;while(r=n.children.pop()){t.splice(i,0,r);r.parentNode=e;lastNode=r}r=t[t.length-1];if(!r||r.type!="element"||r.tagName!="br"){var o=UE.uNode.createElement("br");o.parentNode=e;t.push(o)}i=t.length}});if(t.length){e.children=t}})});e.addInputRule(function(t){utils.each(t.getNodesByTagName("li"),function(e){var t=UE.uNode.createElement("p");for(var i=0,n;n=e.children[i];){if(n.type=="text"||dtd.p[n.tagName]){t.appendChild(n)}else{if(t.firstChild()){e.insertBefore(t,n);t=UE.uNode.createElement("p");i=i+2}else{i++}}}if(t.firstChild()&&!t.parentNode||!e.firstChild()){e.appendChild(t)}if(!t.firstChild()){t.innerHTML(browser.ie?"&nbsp;":"<br/>")}var r=e.firstChild();var o=r.lastChild();if(o&&o.type=="text"&&/^\s*$/.test(o.data)){r.removeChild(o)}});if(e.options.autoTransWordToList){var n={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},r={square:"n"};function o(e,t){var i=t.firstChild();if(i&&i.type=="element"&&i.tagName=="span"&&/Wingdings|Symbol/.test(i.getStyle("font-family"))){for(var o in r){if(r[o]==i.data){return o}}return"disc"}for(var o in n){if(n[o].test(e)){return o}}}utils.each(t.getNodesByTagName("p"),function(t){if(t.getAttr("class")!="MsoListParagraph"){return}t.setStyle("margin","");t.setStyle("margin-left","");t.setAttr("class","");function r(e,t,i){if(e.tagName=="ol"){if(browser.ie){var r=t.firstChild();if(r.type=="element"&&r.tagName=="span"&&n[i].test(r.innerText())){t.removeChild(r)}}else{t.innerHTML(t.innerHTML().replace(n[i],""))}}else{t.removeChild(t.firstChild())}var o=UE.uNode.createElement("li");o.appendChild(t);e.appendChild(o)}var a=t,s,l=t;if(t.parentNode.tagName!="li"&&(s=o(t.innerText(),t))){var d=UE.uNode.createElement(e.options.insertorderedlist.hasOwnProperty(s)?"ol":"ul");if(i[s]){d.setAttr("class","custom_"+s)}else{d.setStyle("list-style-type",s)}while(t&&t.parentNode.tagName!="li"&&o(t.innerText(),t)){a=t.nextSibling();if(!a){t.parentNode.insertBefore(d,t)}r(d,t,s);t=a}if(!d.parentNode&&t&&t.parentNode){t.parentNode.insertBefore(d,t)}}var u=l.firstChild();if(u&&u.type=="element"&&u.tagName=="span"&&/^\s*(&nbsp;)+\s*$/.test(u.innerText())){u.parentNode.removeChild(u)}})}});e.addListener("contentchange",function(){l(e.document)});function l(e,t){utils.each(domUtils.getElementsByTagName(e,"ol ul"),function(n){if(!domUtils.inDoc(n,e))return;var o=n.parentNode;if(o.tagName==n.tagName){var a=s(n)||(n.tagName=="OL"?"decimal":"disc"),l=s(o)||(o.tagName=="OL"?"decimal":"disc");if(a==l){var c=utils.indexOf(r[n.tagName],a);c=c+1==r[n.tagName].length?0:c+1;u(n,r[n.tagName][c])}}var f=0,m=2;if(domUtils.hasClass(n,/custom_/)){if(!(/[ou]l/i.test(o.tagName)&&domUtils.hasClass(o,/custom_/))){m=1}}else{if(/[ou]l/i.test(o.tagName)&&domUtils.hasClass(o,/custom_/)){m=3}}var h=domUtils.getStyle(n,"list-style-type");h&&(n.style.cssText="list-style-type:"+h);n.className=utils.trim(n.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+m;utils.each(domUtils.getElementsByTagName(n,"li"),function(e){e.style.cssText&&(e.style.cssText="");if(!e.firstChild){domUtils.remove(e);return}if(e.parentNode!==n){return}f++;if(domUtils.hasClass(n,/custom_/)){var t=1,r=s(n);if(n.tagName=="OL"){if(r){switch(r){case"cn":case"cn1":case"cn2":if(f>10&&(f%10==0||f>10&&f<20)){t=2}else if(f>20){t=3}break;case"num2":if(f>9){t=2}}}e.className="list-"+i[r]+f+" "+"list-"+r+"-paddingleft-"+t}else{e.className="list-"+i[r]+" "+"list-"+r+"-paddingleft"}}else{e.className=e.className.replace(/list-[\w\-]+/gi,"")}var o=e.getAttribute("class");if(o!==null&&!o.replace(/\s/g,"")){domUtils.removeAttributes(e,"class")}});!t&&d(n,n.tagName.toLowerCase(),s(n)||domUtils.getStyle(n,"list-style-type"),true)})}function d(e,t,i,n){var r=e.nextSibling;if(r&&r.nodeType==1&&r.tagName.toLowerCase()==t&&(s(r)||domUtils.getStyle(r,"list-style-type")||(t=="ol"?"decimal":"disc"))==i){domUtils.moveChild(r,e);if(r.childNodes.length==0){domUtils.remove(r)}}if(r&&domUtils.isFillChar(r)){domUtils.remove(r)}var o=e.previousSibling;if(o&&o.nodeType==1&&o.tagName.toLowerCase()==t&&(s(o)||domUtils.getStyle(o,"list-style-type")||(t=="ol"?"decimal":"disc"))==i){domUtils.moveChild(e,o)}if(o&&domUtils.isFillChar(o)){domUtils.remove(o)}!n&&domUtils.isEmptyBlock(e)&&domUtils.remove(e);if(s(e)){l(e.ownerDocument,true)}}function u(e,t){if(i[t]){e.className="custom_"+t}try{domUtils.setStyle(e,"list-style-type",t)}catch(e){}}function c(e){var t=e.previousSibling;if(t&&domUtils.isEmptyBlock(t)){domUtils.remove(t)}t=e.nextSibling;if(t&&domUtils.isEmptyBlock(t)){domUtils.remove(t)}}e.addListener("keydown",function(t,i){function n(){i.preventDefault?i.preventDefault():i.returnValue=false;e.fireEvent("contentchange");e.undoManger&&e.undoManger.save()}function r(e,t){while(e&&!domUtils.isBody(e)){if(t(e)){return null}if(e.nodeType==1&&/[ou]l/i.test(e.tagName)){return e}e=e.parentNode}return null}var o=i.keyCode||i.which;if(o==13&&!i.shiftKey){var a=e.selection.getRange(),s=domUtils.findParent(a.startContainer,function(e){return domUtils.isBlockElm(e)},true),l=domUtils.findParentByTagName(a.startContainer,"li",true);if(s&&s.tagName!="PRE"&&!l){var d=s.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),"");if(/^\s*1\s*\.[^\d]/.test(d)){s.innerHTML=d.replace(/^\s*1\s*\./,"");a.setStartAtLast(s).collapse(true).select();e.__hasEnterExecCommand=true;e.execCommand("insertorderedlist");e.__hasEnterExecCommand=false}}var u=e.selection.getRange(),f=r(u.startContainer,function(e){return e.tagName=="TABLE"}),m=u.collapsed?f:r(u.endContainer,function(e){return e.tagName=="TABLE"});if(f&&m&&f===m){if(!u.collapsed){f=domUtils.findParentByTagName(u.startContainer,"li",true);m=domUtils.findParentByTagName(u.endContainer,"li",true);if(f&&m&&f===m){u.deleteContents();l=domUtils.findParentByTagName(u.startContainer,"li",true);if(l&&domUtils.isEmptyBlock(l)){w=l.previousSibling;next=l.nextSibling;b=e.document.createElement("p");domUtils.fillNode(e.document,b);g=l.parentNode;if(w&&next){u.setStart(next,0).collapse(true).select(true);domUtils.remove(l)}else{if(!w&&!next||!w){g.parentNode.insertBefore(b,g)}else{l.parentNode.parentNode.insertBefore(b,g.nextSibling)}domUtils.remove(l);if(!g.firstChild){domUtils.remove(g)}u.setStart(b,0).setCursor()}n();return}}else{var h=u.cloneRange(),p=h.collapse(false).createBookmark();u.deleteContents();h.moveToBookmark(p);var l=domUtils.findParentByTagName(h.startContainer,"li",true);c(l);h.select();n();return}}l=domUtils.findParentByTagName(u.startContainer,"li",true);if(l){if(domUtils.isEmptyBlock(l)){p=u.createBookmark();var g=l.parentNode;if(l!==g.lastChild){domUtils.breakParent(l,g);c(l)}else{g.parentNode.insertBefore(l,g.nextSibling);if(domUtils.isEmptyNode(g)){domUtils.remove(g)}}if(!dtd.$list[l.parentNode.tagName]){if(!domUtils.isBlockElm(l.firstChild)){b=e.document.createElement("p");l.parentNode.insertBefore(b,l);while(l.firstChild){b.appendChild(l.firstChild)}domUtils.remove(l)}else{domUtils.remove(l,true)}}u.moveToBookmark(p).select()}else{var v=l.firstChild;if(!v||!domUtils.isBlockElm(v)){var b=e.document.createElement("p");!l.firstChild&&domUtils.fillNode(e.document,b);while(l.firstChild){b.appendChild(l.firstChild)}l.appendChild(b);v=b}var y=e.document.createElement("span");u.insertNode(y);domUtils.breakParent(y,l);var C=y.nextSibling;v=C.firstChild;if(!v){b=e.document.createElement("p");domUtils.fillNode(e.document,b);C.appendChild(b);v=b}if(domUtils.isEmptyNode(v)){v.innerHTML="";domUtils.fillNode(e.document,v)}u.setStart(v,0).collapse(true).shrinkBoundary().select();domUtils.remove(y);var w=C.previousSibling;if(w&&domUtils.isEmptyBlock(w)){w.innerHTML="<p></p>";domUtils.fillNode(e.document,w.firstChild)}}n()}}}if(o==8){u=e.selection.getRange();if(u.collapsed&&domUtils.isStartInblock(u)){h=u.cloneRange().trimBoundary();l=domUtils.findParentByTagName(u.startContainer,"li",true);if(l&&domUtils.isStartInblock(h)){f=domUtils.findParentByTagName(u.startContainer,"p",true);if(f&&f!==l.firstChild){var g=domUtils.findParentByTagName(f,["ol","ul"]);domUtils.breakParent(f,g);c(f);e.fireEvent("contentchange");u.setStart(f,0).setCursor(false,true);e.fireEvent("saveScene");domUtils.preventDefault(i);return}if(l&&(w=l.previousSibling)){if(o==46&&l.childNodes.length){return}if(dtd.$list[w.tagName]){w=w.lastChild}e.undoManger&&e.undoManger.save();v=l.firstChild;if(domUtils.isBlockElm(v)){if(domUtils.isEmptyNode(v)){w.appendChild(v);u.setStart(v,0).setCursor(false,true);while(l.firstChild){w.appendChild(l.firstChild)}}else{y=e.document.createElement("span");u.insertNode(y);if(domUtils.isEmptyBlock(w)){w.innerHTML=""}domUtils.moveChild(l,w);u.setStartBefore(y).collapse(true).select(true);domUtils.remove(y)}}else{if(domUtils.isEmptyNode(l)){var b=e.document.createElement("p");w.appendChild(b);u.setStart(b,0).setCursor()}else{u.setEnd(w,w.childNodes.length).collapse().select(true);while(l.firstChild){w.appendChild(l.firstChild)}}}domUtils.remove(l);e.fireEvent("contentchange");e.fireEvent("saveScene");domUtils.preventDefault(i);return}if(l&&!l.previousSibling){var g=l.parentNode;var p=u.createBookmark();if(domUtils.isTagNode(g.parentNode,"ol ul")){g.parentNode.insertBefore(l,g);if(domUtils.isEmptyNode(g)){domUtils.remove(g)}}else{while(l.firstChild){g.parentNode.insertBefore(l.firstChild,g)}domUtils.remove(l);if(domUtils.isEmptyNode(g)){domUtils.remove(g)}}u.moveToBookmark(p).setCursor(false,true);e.fireEvent("contentchange");e.fireEvent("saveScene");domUtils.preventDefault(i);return}}}}});e.addListener("keyup",function(t,i){var n=i.keyCode||i.which;if(n==8){var r=e.selection.getRange(),o;if(o=domUtils.findParentByTagName(r.startContainer,["ol","ul"],true)){d(o,o.tagName.toLowerCase(),s(o)||domUtils.getComputedStyle(o,"list-style-type"),true)}}});e.addListener("tabkeydown",function(){var t=e.selection.getRange();function i(t){if(e.options.maxListLevel!=-1){var i=t.parentNode,n=0;while(/[ou]l/i.test(i.tagName)){n++;i=i.parentNode}if(n>=e.options.maxListLevel){return true}}}var n=domUtils.findParentByTagName(t.startContainer,"li",true);if(n){var o;if(t.collapsed){if(i(n))return true;var a=n.parentNode,l=e.document.createElement(a.tagName),c=utils.indexOf(r[l.tagName],s(a)||domUtils.getComputedStyle(a,"list-style-type"));c=c+1==r[l.tagName].length?0:c+1;var f=r[l.tagName][c];u(l,f);if(domUtils.isStartInblock(t)){e.fireEvent("saveScene");o=t.createBookmark();a.insertBefore(l,n);l.appendChild(n);d(l,l.tagName.toLowerCase(),f);e.fireEvent("contentchange");t.moveToBookmark(o).select(true);return true}}else{e.fireEvent("saveScene");o=t.createBookmark();for(var m=0,h,p=domUtils.findParents(n),g;g=p[m++];){if(domUtils.isTagNode(g,"ol ul")){h=g;break}}var v=n;if(o.end){while(v&&!(domUtils.getPosition(v,o.end)&domUtils.POSITION_FOLLOWING)){if(i(v)){v=domUtils.getNextDomNode(v,false,null,function(e){return e!==h});continue}var a=v.parentNode,l=e.document.createElement(a.tagName),c=utils.indexOf(r[l.tagName],s(a)||domUtils.getComputedStyle(a,"list-style-type"));var b=c+1==r[l.tagName].length?0:c+1;var f=r[l.tagName][b];u(l,f);a.insertBefore(l,v);while(v&&!(domUtils.getPosition(v,o.end)&domUtils.POSITION_FOLLOWING)){n=v.nextSibling;l.appendChild(v);if(!n||domUtils.isTagNode(n,"ol ul")){if(n){while(n=n.firstChild){if(n.tagName=="LI"){break}}}else{n=domUtils.getNextDomNode(v,false,null,function(e){return e!==h})}break}v=n}d(l,l.tagName.toLowerCase(),f);v=n}}e.fireEvent("contentchange");t.moveToBookmark(o).select();return true}}});function f(e){while(e&&!domUtils.isBody(e)){if(e.nodeName=="TABLE"){return null}if(e.nodeName=="LI"){return e}e=e.parentNode}}e.commands["insertorderedlist"]=e.commands["insertunorderedlist"]={execCommand:function(e,i){if(!i){i=e.toLowerCase()=="insertorderedlist"?"decimal":"disc"}var n=this,r=this.selection.getRange(),o=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br":!domUtils.isWhitespace(e)},a=e.toLowerCase()=="insertorderedlist"?"ol":"ul",l=n.document.createDocumentFragment();r.adjustmentBoundary().shrinkBoundary();var c=r.createBookmark(true),m=f(n.document.getElementById(c.start)),h=0,p=f(n.document.getElementById(c.end)),g=0,v,b,y,C;if(m||p){m&&(v=m.parentNode);if(!c.end){p=m}p&&(b=p.parentNode);if(v===b){while(m!==p){C=m;m=m.nextSibling;if(!domUtils.isBlockElm(C.firstChild)){var w=n.document.createElement("p");while(C.firstChild){w.appendChild(C.firstChild)}C.appendChild(w)}l.appendChild(C)}C=n.document.createElement("span");v.insertBefore(C,p);if(!domUtils.isBlockElm(p.firstChild)){w=n.document.createElement("p");while(p.firstChild){w.appendChild(p.firstChild)}p.appendChild(w)}l.appendChild(p)
;domUtils.breakParent(C,v);if(domUtils.isEmptyNode(C.previousSibling)){domUtils.remove(C.previousSibling)}if(domUtils.isEmptyNode(C.nextSibling)){domUtils.remove(C.nextSibling)}var N=s(v)||domUtils.getComputedStyle(v,"list-style-type")||(e.toLowerCase()=="insertorderedlist"?"decimal":"disc");if(v.tagName.toLowerCase()==a&&N==i){for(var x=0,U,E=n.document.createDocumentFragment();U=l.firstChild;){if(domUtils.isTagNode(U,"ol ul")){E.appendChild(U)}else{while(U.firstChild){E.appendChild(U.firstChild);domUtils.remove(U)}}}C.parentNode.insertBefore(E,C)}else{y=n.document.createElement(a);u(y,i);y.appendChild(l);C.parentNode.insertBefore(y,C)}domUtils.remove(C);y&&d(y,a,i);r.moveToBookmark(c).select();return}if(m){while(m){C=m.nextSibling;if(domUtils.isTagNode(m,"ol ul")){l.appendChild(m)}else{var T=n.document.createDocumentFragment(),S=0;while(m.firstChild){if(domUtils.isBlockElm(m.firstChild)){S=1}T.appendChild(m.firstChild)}if(!S){var k=n.document.createElement("p");k.appendChild(T);l.appendChild(k)}else{l.appendChild(T)}domUtils.remove(m)}m=C}v.parentNode.insertBefore(l,v.nextSibling);if(domUtils.isEmptyNode(v)){r.setStartBefore(v);domUtils.remove(v)}else{r.setStartAfter(v)}h=1}if(p&&domUtils.inDoc(b,n.document)){m=b.firstChild;while(m&&m!==p){C=m.nextSibling;if(domUtils.isTagNode(m,"ol ul")){l.appendChild(m)}else{T=n.document.createDocumentFragment();S=0;while(m.firstChild){if(domUtils.isBlockElm(m.firstChild)){S=1}T.appendChild(m.firstChild)}if(!S){k=n.document.createElement("p");k.appendChild(T);l.appendChild(k)}else{l.appendChild(T)}domUtils.remove(m)}m=C}var B=domUtils.createElement(n.document,"div",{tmpDiv:1});domUtils.moveChild(p,B);l.appendChild(B);domUtils.remove(p);b.parentNode.insertBefore(l,b);r.setEndBefore(b);if(domUtils.isEmptyNode(b)){domUtils.remove(b)}g=1}}if(!h){r.setStartBefore(n.document.getElementById(c.start))}if(c.end&&!g){r.setEndAfter(n.document.getElementById(c.end))}r.enlarge(true,function(e){return t[e.tagName]});l=n.document.createDocumentFragment();var I=r.createBookmark(),_=domUtils.getNextDomNode(I.start,false,o),R=r.cloneRange(),L,A=domUtils.isBlockElm;while(_&&_!==I.end&&domUtils.getPosition(_,I.end)&domUtils.POSITION_PRECEDING){if(_.nodeType==3||dtd.li[_.tagName]){if(_.nodeType==1&&dtd.$list[_.tagName]){while(_.firstChild){l.appendChild(_.firstChild)}L=domUtils.getNextDomNode(_,false,o);domUtils.remove(_);_=L;continue}L=_;R.setStartBefore(_);while(_&&_!==I.end&&(!A(_)||domUtils.isBookmarkNode(_))){L=_;_=domUtils.getNextDomNode(_,false,null,function(e){return!t[e.tagName]})}if(_&&A(_)){C=domUtils.getNextDomNode(L,false,o);if(C&&domUtils.isBookmarkNode(C)){_=domUtils.getNextDomNode(C,false,o);L=C}}R.setEndAfter(L);_=domUtils.getNextDomNode(L,false,o);var D=r.document.createElement("li");D.appendChild(R.extractContents());if(domUtils.isEmptyNode(D)){var L=r.document.createElement("p");while(D.firstChild){L.appendChild(D.firstChild)}D.appendChild(L)}l.appendChild(D)}else{_=domUtils.getNextDomNode(_,true,o)}}r.moveToBookmark(I).collapse(true);y=n.document.createElement(a);u(y,i);y.appendChild(l);r.insertNode(y);d(y,a,i);for(var x=0,U,O=domUtils.getElementsByTagName(y,"div");U=O[x++];){if(U.getAttribute("tmpDiv")){domUtils.remove(U,true)}}r.moveToBookmark(c).select()},queryCommandState:function(e){var t=e.toLowerCase()=="insertorderedlist"?"ol":"ul";var i=this.selection.getStartElementPath();for(var n=0,r;r=i[n++];){if(r.nodeName=="TABLE"){return 0}if(t==r.nodeName.toLowerCase()){return 1}}return 0},queryCommandValue:function(e){var t=e.toLowerCase()=="insertorderedlist"?"ol":"ul";var i=this.selection.getStartElementPath(),n;for(var r=0,o;o=i[r++];){if(o.nodeName=="TABLE"){n=null;break}if(t==o.nodeName.toLowerCase()){n=o;break}}return n?s(n)||domUtils.getComputedStyle(n,"list-style-type"):null}}};(function(){var e={textarea:function(e,t){var i=t.ownerDocument.createElement("textarea");i.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;";if(browser.ie&&browser.version<8){i.style.width=t.offsetWidth+"px";i.style.height=t.offsetHeight+"px";t.onresize=function(){i.style.width=t.offsetWidth+"px";i.style.height=t.offsetHeight+"px"}}t.appendChild(i);return{setContent:function(e){i.value=e},getContent:function(){return i.value},select:function(){var e;if(browser.ie){e=i.createTextRange();e.collapse(true);e.select()}else{i.setSelectionRange(0,0);i.focus()}},dispose:function(){t.removeChild(i);t.onresize=null;i=null;t=null}}}};UE.plugins["source"]=function(){var t=this;var i=this.options;var n=false;var r;var o;i.sourceEditor="textarea";t.setOpt({sourceEditorFirst:false});function a(i){return e["textarea"](t,i)}var s;var l,d;t.commands["source"]={execCommand:function(){n=!n;if(n){d=t.selection.getRange().createAddress(false,true);t.undoManger&&t.undoManger.save(true);if(browser.gecko){t.body.contentEditable=false}s=t.iframe.style.cssText;t.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;";t.fireEvent("beforegetcontent");var e=UE.htmlparser(t.body.innerHTML);t.filterOutputRule(e);e.traversal(function(e){if(e.type=="element"){switch(e.tagName){case"td":case"th":case"caption":if(e.children&&e.children.length==1){if(e.firstChild().tagName=="br"){e.removeChild(e.firstChild())}};break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}});t.fireEvent("aftergetcontent");var i=e.toHtml(true);r=a(t.iframe.parentNode);r.setContent(i);o=t.setContent;t.setContent=function(e){var i=UE.htmlparser(e);t.filterInputRule(i);e=i.toHtml();r.setContent(e)};setTimeout(function(){r.select();t.addListener("fullscreenchanged",function(){try{r.getCodeMirror().refresh()}catch(e){}})});l=t.getContent;t.getContent=function(){return r.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{t.iframe.style.cssText=s;var u=r.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";u=u.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){if(t&&!dtd.$inlineWithA[t.toLowerCase()]){return e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,"")}return e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});t.setContent=o;t.setContent(u);r.dispose();r=null;t.getContent=l;var c=t.body.firstChild;if(!c){t.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";c=t.body.firstChild}t.undoManger&&t.undoManger.save(true);if(browser.gecko){var f=document.createElement("input");f.style.cssText="position:absolute;left:0;top:-32768px";document.body.appendChild(f);t.body.contentEditable=false;setTimeout(function(){domUtils.setViewportOffset(f,{left:-32768,top:0});f.focus();setTimeout(function(){t.body.contentEditable=true;t.selection.getRange().moveToAddress(d).select(true);domUtils.remove(f)})})}else{try{t.selection.getRange().moveToAddress(d).select(true)}catch(e){}}}this.fireEvent("sourcemodechanged",n)},queryCommandState:function(){return n|0},notNeedUndo:1};var u=t.queryCommandState;t.queryCommandState=function(e){e=e.toLowerCase();if(n){return e in{source:1,fullscreen:1}?1:-1}return u.apply(this,arguments)}}})();UE.plugins["enterkey"]=function(){var e,t=this,i=t.options.enterTag;t.addListener("keyup",function(i,n){var r=n.keyCode||n.which;if(r==13){var o=t.selection.getRange(),a=o.startContainer,s;if(!browser.ie){if(/h\d/i.test(e)){if(browser.gecko){var l=domUtils.findParentByTagName(a,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],true);if(!l){t.document.execCommand("formatBlock",false,"<p>");s=1}}else{if(a.nodeType==1){var d=t.document.createTextNode(""),u;o.insertNode(d);u=domUtils.findParentByTagName(d,"div",true);if(u){var c=t.document.createElement("p");while(u.firstChild){c.appendChild(u.firstChild)}u.parentNode.insertBefore(c,u);domUtils.remove(u);o.setStartBefore(d).setCursor();s=1}domUtils.remove(d)}}if(t.undoManger&&s){t.undoManger.save()}}browser.opera&&o.select()}else{t.fireEvent("saveScene",true,true)}}});t.addListener("keydown",function(n,r){var o=r.keyCode||r.which;if(o==13){if(t.fireEvent("beforeenterkeydown")){domUtils.preventDefault(r);return}t.fireEvent("saveScene",true,true);e="";var a=t.selection.getRange();if(!a.collapsed){var s=a.startContainer,l=a.endContainer,d=domUtils.findParentByTagName(s,"td",true),u=domUtils.findParentByTagName(l,"td",true);if(d&&u&&d!==u||!d&&u||d&&!u){r.preventDefault?r.preventDefault():r.returnValue=false;return}}if(i=="p"){if(!browser.ie){s=domUtils.findParentByTagName(a.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],true);if(!s&&!browser.opera){t.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){a=t.selection.getRange();s=domUtils.findParentByTagName(a.startContainer,"p",true);s&&domUtils.removeDirtyAttr(s)}}else{e=s.tagName;s.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(s)}}}else{r.preventDefault?r.preventDefault():r.returnValue=false;if(!a.collapsed){a.deleteContents();s=a.startContainer;if(s.nodeType==1&&(s=s.childNodes[a.startOffset])){while(s.nodeType==1){if(dtd.$empty[s.tagName]){a.setStartBefore(s).setCursor();if(t.undoManger){t.undoManger.save()}return false}if(!s.firstChild){var c=a.document.createElement("br");s.appendChild(c);a.setStart(s,0).setCursor();if(t.undoManger){t.undoManger.save()}return false}s=s.firstChild}if(s===a.startContainer.childNodes[a.startOffset]){c=a.document.createElement("br");a.insertNode(c).setCursor()}else{a.setStart(s,0).setCursor()}}else{c=a.document.createElement("br");a.insertNode(c).setStartAfter(c).setCursor()}}else{c=a.document.createElement("br");a.insertNode(c);var f=c.parentNode;if(f.lastChild===c){c.parentNode.insertBefore(c.cloneNode(true),c);a.setStartBefore(c)}else{a.setStartAfter(c)}a.setCursor()}}}})};UE.plugins["keystrokes"]=function(){var e=this;var t=true;e.addListener("keydown",function(i,n){var r=n.keyCode||n.which,o=e.selection.getRange();if(!o.collapsed&&!(n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)&&(r>=65&&r<=90||r>=48&&r<=57||r>=96&&r<=111||{13:1,8:1,46:1}[r])){var a=o.startContainer;if(domUtils.isFillChar(a)){o.setStartBefore(a)}a=o.endContainer;if(domUtils.isFillChar(a)){o.setEndAfter(a)}o.txtToElmBoundary();if(o.endContainer&&o.endContainer.nodeType==1){a=o.endContainer.childNodes[o.endOffset];if(a&&domUtils.isBr(a)){o.setEndAfter(a)}}if(o.startOffset==0){a=o.startContainer;if(domUtils.isBoundaryNode(a,"firstChild")){a=o.endContainer;if(o.endOffset==(a.nodeType==3?a.nodeValue.length:a.childNodes.length)&&domUtils.isBoundaryNode(a,"lastChild")){e.fireEvent("saveScene");e.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";o.setStart(e.body.firstChild,0).setCursor(false,true);e._selectionChange();return}}}}if(r==keymap.Backspace){o=e.selection.getRange();t=o.collapsed;if(e.fireEvent("delkeydown",n)){return}var s,l;if(o.collapsed&&o.inFillChar()){s=o.startContainer;if(domUtils.isFillChar(s)){o.setStartBefore(s).shrinkBoundary(true).collapse(true);domUtils.remove(s)}else{s.nodeValue=s.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"");o.startOffset--;o.collapse(true).select(true)}}if(s=o.getClosedNode()){e.fireEvent("saveScene");o.setStartBefore(s);domUtils.remove(s);o.setCursor();e.fireEvent("saveScene");domUtils.preventDefault(n);return}if(!browser.ie){s=domUtils.findParentByTagName(o.startContainer,"table",true);l=domUtils.findParentByTagName(o.endContainer,"table",true);if(s&&!l||!s&&l||s!==l){n.preventDefault();return}}}if(r==keymap.Tab){var d={ol:1,ul:1,table:1};if(e.fireEvent("tabkeydown",n)){domUtils.preventDefault(n);return}var u=e.selection.getRange();e.fireEvent("saveScene");for(var c=0,f="",m=e.options.tabSize||4,h=e.options.tabNode||"&nbsp;";c<m;c++){f+=h}var p=e.document.createElement("span");p.innerHTML=f+domUtils.fillChar;if(u.collapsed){u.insertNode(p.cloneNode(true).firstChild).setCursor(true)}else{var g=function(e){return domUtils.isBlockElm(e)&&!d[e.tagName.toLowerCase()]};s=domUtils.findParent(u.startContainer,g,true);l=domUtils.findParent(u.endContainer,g,true);if(s&&l&&s===l){u.deleteContents();u.insertNode(p.cloneNode(true).firstChild).setCursor(true)}else{var v=u.createBookmark();u.enlarge(true);var b=u.createBookmark(),y=domUtils.getNextDomNode(b.start,false,g);while(y&&!(domUtils.getPosition(y,b.end)&domUtils.POSITION_FOLLOWING)){y.insertBefore(p.cloneNode(true).firstChild,y.firstChild);y=domUtils.getNextDomNode(y,false,g)}u.moveToBookmark(b).moveToBookmark(v).select()}}domUtils.preventDefault(n)}if(browser.gecko&&r==46){u=e.selection.getRange();if(u.collapsed){s=u.startContainer;if(domUtils.isEmptyBlock(s)){var C=s.parentNode;while(domUtils.getChildCount(C)==1&&!domUtils.isBody(C)){s=C;C=C.parentNode}if(s===C.lastChild)n.preventDefault();return}}}});e.addListener("keyup",function(e,i){var n=i.keyCode||i.which,r,o=this;if(n==keymap.Backspace){if(o.fireEvent("delkeyup")){return}r=o.selection.getRange();if(r.collapsed){var a,s=["h1","h2","h3","h4","h5","h6"];if(a=domUtils.findParentByTagName(r.startContainer,s,true)){if(domUtils.isEmptyBlock(a)){var l=a.previousSibling;if(l&&l.nodeName!="TABLE"){domUtils.remove(a);r.setStartAtLast(l).setCursor(false,true);return}else{var d=a.nextSibling;if(d&&d.nodeName!="TABLE"){domUtils.remove(a);r.setStartAtFirst(d).setCursor(false,true);return}}}}if(domUtils.isBody(r.startContainer)){var a=domUtils.createElement(o.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});r.insertNode(a).setStart(a,0).setCursor(false,true)}}if(!t&&(r.startContainer.nodeType==3||r.startContainer.nodeType==1&&domUtils.isEmptyBlock(r.startContainer))){if(browser.ie){var u=r.document.createElement("span");r.insertNode(u).setStartBefore(u).collapse(true);r.select();domUtils.remove(u)}else{r.select()}}}})};UE.plugins["fiximgclick"]=function(){var e=false;function t(){this.editor=null;this.resizer=null;this.cover=null;this.doc=document;this.prePos={x:0,y:0};this.startPos={x:0,y:0}}(function(){var n=[[0,0,-1,-1],[0,0,1,1],[0,0,-1,-1],[0,0,1,1]];t.prototype={init:function(e){var t=this;t.editor=e;t.startPos=this.prePos={x:0,y:0};t.dragId=-1;var n=[],r=t.cover=document.createElement("div"),o=t.resizer=document.createElement("div");r.id=t.editor.ui.id+"_imagescale_cover";r.style.cssText="position:absolute;display:none;z-index:"+t.editor.options.zIndex+";filter:alpha(opacity=0); opacity:0;background:#CCC;";domUtils.on(r,"mousedown click",function(){t.hide()});for(i=0;i<4;i++){n.push('<span class="edui-editor-imagescale-hand'+i+'"></span>')}o.id=t.editor.ui.id+"_imagescale";o.className="edui-editor-imagescale";o.innerHTML=n.join("");o.style.cssText+=";display:none;border:1px solid #3b77ff;z-index:"+t.editor.options.zIndex+";";t.editor.ui.getDom().appendChild(r);t.editor.ui.getDom().appendChild(o);t.initStyle();t.initEvents()},initStyle:function(){utils.cssRule("imagescale",".edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}"+".edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}"+".edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},initEvents:function(){var e=this;e.startPos.x=e.startPos.y=0;e.isDraging=false},_eventHandler:function(t){var i=this;switch(t.type){case"mousedown":var n=t.target||t.srcElement,n;if(n.className.indexOf("edui-editor-imagescale-hand")!=-1&&i.dragId==-1){i.dragId=n.className.slice(-1);i.startPos.x=i.prePos.x=t.clientX;i.startPos.y=i.prePos.y=t.clientY;domUtils.on(i.doc,"mousemove",i.proxy(i._eventHandler,i))}break;case"mousemove":if(i.dragId!=-1){i.updateContainerStyle(i.dragId,{x:t.clientX-i.prePos.x,y:t.clientY-i.prePos.y});i.prePos.x=t.clientX;i.prePos.y=t.clientY;e=true;i.updateTargetElement()}break;case"mouseup":if(i.dragId!=-1){i.updateContainerStyle(i.dragId,{x:t.clientX-i.prePos.x,y:t.clientY-i.prePos.y});i.updateTargetElement();if(i.target.parentNode)i.attachTo(i.target);i.dragId=-1}domUtils.un(i.doc,"mousemove",i.proxy(i._eventHandler,i));if(e){e=false;i.editor.fireEvent("contentchange")}break;default:break}},updateTargetElement:function(){var e=this;domUtils.setStyles(e.target,{width:e.resizer.style.width,height:e.resizer.style.height});e.target.width=parseInt(e.resizer.style.width);e.target.height=parseInt(e.resizer.style.height);e.attachTo(e.target)},updateContainerStyle:function(e,t){var i=this,r=i.resizer,o;var a=t.x;if(e!=3&&e!=1){a==t.y}console.log(a);if(n[e][0]!=0){o=parseInt(r.style.left)+t.x;r.style.left=i._validScaledProp("left",o)+"px"}if(n[e][1]!=0){o=parseInt(r.style.top)+t.y;r.style.top=i._validScaledProp("top",o)+"px"}if(n[e][2]!=0){o=r.clientWidth+n[e][2]*a;r.style.width=i._validScaledProp("width",o)+"px"}if(n[e][3]!=0){o=r.clientHeight+n[e][3]*a;r.style.height=i._validScaledProp("height",o)+"px"}},_validScaledProp:function(e,t){var i=this.resizer,n=document;t=isNaN(t)?0:t;switch(e){case"left":return t<0?0:t+i.clientWidth>n.clientWidth?n.clientWidth-i.clientWidth:t;case"top":return t<0?0:t+i.clientHeight>n.clientHeight?n.clientHeight-i.clientHeight:t;case"width":return t<=0?1:t+i.offsetLeft>n.clientWidth?n.clientWidth-i.offsetLeft:t;case"height":return t<=0?1:t+i.offsetTop>n.clientHeight?n.clientHeight-i.offsetTop:t}},hideCover:function(){var e=this;domUtils.setStyles(e.cover,{width:"0px",height:"0px",top:"-9999999px",left:"-9999999px",position:"absolute","z-index":"-1",display:"none"})},showCover:function(){var e=this,t=domUtils.getXY(e.editor.ui.getDom()),i=domUtils.getXY(e.editor.iframe);domUtils.setStyles(e.cover,{width:e.editor.iframe.offsetWidth+"px",height:e.editor.iframe.offsetHeight+"px",top:i.y-t.y+"px",left:i.x-t.x+"px",position:"absolute","z-index":e.editor.options.zIndex,display:""})},show:function(e){var t=this;t.resizer.style.display="block";if(e)t.attachTo(e);domUtils.on(this.resizer,"mousedown",t.proxy(t._eventHandler,t));domUtils.on(t.doc,"mouseup",t.proxy(t._eventHandler,t));t.showCover();t.editor.fireEvent("afterscaleshow",t);t.editor.fireEvent("saveScene")},hide:function(){var e=this;e.hideCover();e.resizer.style.display="none";domUtils.un(e.resizer,"mousedown",e.proxy(e._eventHandler,e));domUtils.un(e.doc,"mouseup",e.proxy(e._eventHandler,e));e.editor.fireEvent("afterscalehide",e)},proxy:function(e,t){return function(i){return e.apply(t||this,arguments)}},attachTo:function(e){var t=this,i=t.target=e,n=this.resizer,r=domUtils.getXY(i),o=domUtils.getXY(t.editor.iframe),a=domUtils.getXY(n.parentNode);domUtils.setStyles(n,{width:i.width+"px",height:i.height+"px",left:o.x+r.x-t.editor.document.body.scrollLeft-a.x-parseInt(n.style.borderLeftWidth)+"px",top:o.y+r.y-t.editor.document.body.scrollTop-a.y-parseInt(n.style.borderTopWidth)+"px"})}}})();return function(){var e=this,i;e.setOpt("imageScaleEnabled",true);if(!browser.ie&&e.options.imageScaleEnabled){e.addListener("click",function(n,r){var o=e.selection.getRange(),a=o.getClosedNode();var s=r.target;if(a&&a.tagName=="IMG"&&e.body.contentEditable!="false"&&s==a){if(a.className.indexOf("edui-faked-music")!=-1||a.getAttribute("anchorname")||domUtils.hasClass(a,"loadingclass")||domUtils.hasClass(a,"loaderrorclass")){return}if(!i){i=new t;i.init(e);e.ui.getDom().appendChild(i.resizer);var l=function(t){i.hide();if(i.target){e.selection.getRange().selectNode(i.target).select()}},d=function(e){var t=e.target||e.srcElement;if(t&&(t.className===undefined||t.className.indexOf("edui-editor-imagescale")==-1)){l(e)}},u;e.addListener("afterscaleshow",function(t){e.addListener("beforekeydown",l);e.addListener("beforemousedown",d);domUtils.on(document,"keydown",l);domUtils.on(document,"mousedown",d);e.selection.getNative().removeAllRanges()});e.addListener("afterscalehide",function(t){e.removeListener("beforekeydown",l);e.removeListener("beforemousedown",d);domUtils.un(document,"keydown",l);domUtils.un(document,"mousedown",d);var n=i.target;if(n.parentNode){e.selection.getRange().selectNode(n).select();e.focus(true)}});domUtils.on(i.resizer,"mousedown",function(t){e.selection.getNative().removeAllRanges();var n=t.target||t.srcElement;if(n&&n.className.indexOf("edui-editor-imagescale-hand")==-1){u=setTimeout(function(){i.hide();if(i.target){e.selection.getRange().selectNode(n).select()}},200)}});domUtils.on(i.resizer,"mouseup",function(e){var t=e.target||e.srcElement;if(t&&t.className.indexOf("edui-editor-imagescale-hand")==-1){clearTimeout(u)}})}i.show(a)}else{if(i&&i.resizer.style.display!="none"){i.hide()}}})}if(browser.webkit){e.addListener("click",function(t,i){if(i.target.tagName=="IMG"&&e.body.contentEditable!="false"){var n=new dom.Range(e.document);n.selectNode(i.target).select()}})}}}();UE.plugins["autoheight"]=function(){var e=this;e.autoHeightEnabled=e.options.autoHeightEnabled!==false;if(!e.autoHeightEnabled){return}var t,i=0,n=e.options,r,o;function a(){var e=this;clearTimeout(o);if(s)return;if(!e.queryCommandState||e.queryCommandState&&e.queryCommandState("source")!=1){o=setTimeout(function(){var t=e.body.lastChild;while(t&&t.nodeType!=1){t=t.previousSibling}if(t&&t.nodeType==1){t.style.clear="both";r=Math.max(domUtils.getXY(t).y+t.offsetHeight+25,Math.max(n.minFrameHeight,n.initialFrameHeight));if(r!=i){if(r!==parseInt(e.iframe.parentNode.style.height)){e.iframe.parentNode.style.height=r+"px"}e.body.style.height=r+"px";i=r}domUtils.removeStyle(t,"clear")}},50)}}var s;e.addListener("fullscreenchanged",function(e,t){s=t});e.addListener("destroy",function(){e.removeListener("contentchange afterinserthtml keyup mouseup",a)});e.enableAutoHeight=function(){var e=this;if(!e.autoHeightEnabled){return}var i=e.document;e.autoHeightEnabled=true;t=i.body.style.overflowY;i.body.style.overflowY="hidden";e.addListener("contentchange afterinserthtml keyup mouseup",a);setTimeout(function(){a.call(e)},browser.gecko?100:0);e.fireEvent("autoheightchanged",e.autoHeightEnabled)};e.disableAutoHeight=function(){e.body.style.overflowY=t||"";e.removeListener("contentchange",a);e.removeListener("keyup",a);e.removeListener("mouseup",a);e.autoHeightEnabled=false;e.fireEvent("autoheightchanged",e.autoHeightEnabled)};e.on("setHeight",function(){e.disableAutoHeight()});e.addListener("ready",function(){e.enableAutoHeight();var t;domUtils.on(browser.ie?e.body:e.document,browser.webkit?"dragover":"drop",function(){clearTimeout(t);t=setTimeout(function(){a.call(e)},100)});var i;window.onscroll=function(){if(i===null){i=this.scrollY}else if(this.scrollY==0&&i!=0){e.window.scrollTo(0,0);i=null}}})};UE.plugins["autofloat"]=function(){var e=this,t=e.getLang();e.setOpt({topOffset:0});var i=e.options.autoFloatEnabled!==false,n=e.options.topOffset;if(!i){return}var r=UE.ui.uiUtils,o=browser.ie&&browser.version<=6,a=browser.quirks;function s(){if(!UE.ui){alert(t.autofloatMsg);return 0}return 1}function l(){var e=document.body.style;e.backgroundImage='url("about:blank")';e.backgroundAttachment="fixed"}var d,u=document.createElement("div"),c,f,m,h=true;function p(){var t=domUtils.getXY(c),i=domUtils.getComputedStyle(c,"position"),r=domUtils.getComputedStyle(c,"left");c.style.width=c.offsetWidth+"px";c.style.zIndex=e.options.zIndex*1+1;c.parentNode.insertBefore(u,c);if(o||a&&browser.ie){if(c.style.position!="absolute"){c.style.position="absolute"}c.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-f+n+"px"}else{if(browser.ie7Compat&&h){h=false;c.style.left=domUtils.getXY(c).x-document.documentElement.getBoundingClientRect().left+2+"px"}if(c.style.position!="fixed"){c.style.position="fixed";c.style.top=n+"px";(i=="absolute"||i=="relative")&&parseFloat(r)&&(c.style.left=t.x+"px")}}}function g(){h=true;if(u.parentNode){u.parentNode.removeChild(u)}c.style.cssText=d}function v(){var t=m(e.container);var i=e.options.toolbarTopOffset||0;if(t.top<0&&t.bottom-c.offsetHeight>i){p()}else{g()}}var b=utils.defer(function(){v()},browser.ie?200:100,true);e.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],v);e.removeListener("keydown",b)});e.addListener("ready",function(){if(s(e)){if(!e.ui){return}m=r.getClientRect;c=e.ui.getDom("toolbarbox");f=m(c).top;d=c.style.cssText;u.style.height=c.offsetHeight+"px";if(o){l()}domUtils.on(window,["scroll","resize"],v);e.addListener("keydown",b);e.addListener("beforefullscreenchange",function(e,t){if(t){g()}});e.addListener("fullscreenchanged",function(e,t){if(!t){v()}});e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){v()},0)});e.addListener("clearDoc",function(){setTimeout(function(){v()},0)})}})};UE.plugins["video"]=function(){var e=this;function t(t,i,n,r,o,a,s){t=utils.unhtmlForUrl(t);o=utils.unhtml(o);a=utils.unhtml(a);i=parseInt(i,10)||0;n=parseInt(n,10)||0;var l;switch(s){case"image":l="<img "+(r?'id="'+r+'"':"")+' width="'+i+'" height="'+n+'" _url="'+t+'" class="'+a.replace(/\bvideo-js\b/,"")+'"'+' src="'+e.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+e.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(o?"float:"+o+";":"")+'" />';break;case"embed":l='<embed type="application/x-shockwave-flash" class="'+a+'" pluginspage="http://www.macromedia.com/go/getflashplayer"'+' src="'+utils.html(t)+'" width="'+i+'" height="'+n+'"'+(o?' style="float:'+o+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';break;case"video":var d=t.substr(t.lastIndexOf(".")+1);if(d=="ogv")d="ogg";l="<video"+(r?' id="'+r+'"':"")+' class="'+a+' video-js" '+(o?' style="float:'+o+'"':"")+' controls preload="none" width="'+i+'" height="'+n+'" src="'+t+'" data-setup="{}">'+'<source src="'+t+'" type="video/'+d+'" /></video>';break}return l}function i(e,i){utils.each(e.getNodesByTagName(i?"img":"embed video"),function(e){var n=e.getAttr("class");if(n&&n.indexOf("edui-faked-video")!=-1){var r=t(i?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",n,i?"embed":"image");e.parentNode.replaceChild(UE.uNode.createElement(r),e)}if(n&&n.indexOf("edui-upload-video")!=-1){var r=t(i?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",n,i?"video":"image");e.parentNode.replaceChild(UE.uNode.createElement(r),e)}})}e.addOutputRule(function(e){i(e,true)});e.addInputRule(function(e){i(e)});e.commands["insertvideo"]={execCommand:function(i,n,r){n=utils.isArray(n)?n:[n];var o=[],a="tmpVedio",s;for(var l=0,d,u=n.length;l<u;l++){d=n[l];s=r=="upload"?"edui-upload-video video-js vjs-default-skin":"edui-faked-video";o.push(t(d.url,d.width||420,d.height||280,a+l,null,s,"image"))}e.execCommand("inserthtml",o.join(""),true);var c=this.selection.getRange();for(var l=0,u=n.length;l<u;l++){var f=this.document.getElementById("tmpVedio"+l);domUtils.removeAttributes(f,"id");c.selectNode(f).select();e.execCommand("imagefloat",n[l].align)}},queryCommandState:function(){var t=e.selection.getRange().getClosedNode(),i=t&&(t.className=="edui-faked-video"||t.className.indexOf("edui-upload-video")!=-1);return i?1:0}}};(function(){var e=UE.UETable=function(e){this.table=e;this.indexTable=[];this.selectedTds=[];this.cellsRange={};this.update(e)};e.removeSelectedClass=function(e){utils.each(e,function(e){domUtils.removeClasses(e,"selectTdClass")})};e.addSelectedClass=function(e){utils.each(e,function(e){domUtils.addClass(e,"selectTdClass")})};e.isEmptyBlock=function(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0){return 0}for(var i in dtd.$isNotEmpty)if(dtd.$isNotEmpty.hasOwnProperty(i)){if(e.getElementsByTagName(i).length){return 0}}return 1};e.getWidth=function(e){if(!e)return 0;return parseInt(domUtils.getComputedStyle(e,"width"),10)};e.getTableCellAlignState=function(e){!utils.isArray(e)&&(e=[e]);var t={},i=["align","valign"],n=null,r=true;utils.each(e,function(e){utils.each(i,function(i){n=e.getAttribute(i);if(!t[i]&&n){t[i]=n}else if(!t[i]||n!==t[i]){r=false;return false}});return r});return r?t:null};e.getTableItemsByRange=function(e){var t=e.selection.getStart();if(t&&t.id&&t.id.indexOf("_baidu_bookmark_start_")===0&&t.nextSibling){t=t.nextSibling}var i=t&&domUtils.findParentByTagName(t,["td","th"],true),n=i&&i.parentNode,r=t&&domUtils.findParentByTagName(t,"caption",true),o=r?r.parentNode:n&&n.parentNode.parentNode;return{cell:i,tr:n,table:o,caption:r}};e.getUETableBySelected=function(t){var i=e.getTableItemsByRange(t).table;if(i&&i.ueTable&&i.ueTable.selectedTds.length){return i.ueTable}return null};e.getDefaultValue=function(e,t){var i={thin:"0px",medium:"1px",thick:"2px"},n,r,o,a;if(!t){t=e.document.createElement("table");t.insertRow(0).insertCell(0).innerHTML="xxx";e.body.appendChild(t);var s=t.getElementsByTagName("td")[0];a=domUtils.getComputedStyle(t,"border-left-width");n=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"padding-left");r=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"border-left-width");o=parseInt(i[a]||a,10);domUtils.remove(t);return{tableBorder:n,tdPadding:r,tdBorder:o}}else{s=t.getElementsByTagName("td")[0];a=domUtils.getComputedStyle(t,"border-left-width");n=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"padding-left");r=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"border-left-width");o=parseInt(i[a]||a,10);return{tableBorder:n,tdPadding:r,tdBorder:o}}};e.getUETable=function(t){var i=t.tagName.toLowerCase();t=i=="td"||i=="th"||i=="caption"?domUtils.findParentByTagName(t,"table",true):t;if(!t.ueTable){t.ueTable=new e(t)}return t.ueTable};e.cloneCell=function(e,t,i){if(!e||utils.isString(e)){return this.table.ownerDocument.createElement(e||"td")}var n=domUtils.hasClass(e,"selectTdClass");n&&domUtils.removeClasses(e,"selectTdClass");var r=e.cloneNode(true);if(t){r.rowSpan=r.colSpan=1}!i&&domUtils.removeAttributes(r,"width height");!i&&domUtils.removeAttributes(r,"style");r.style.borderLeftStyle="";r.style.borderTopStyle="";r.style.borderLeftColor=e.style.borderRightColor;r.style.borderLeftWidth=e.style.borderRightWidth;r.style.borderTopColor=e.style.borderBottomColor;r.style.borderTopWidth=e.style.borderBottomWidth;n&&domUtils.addClass(e,"selectTdClass");return r};e.prototype={getMaxRows:function(){var e=this.table.rows,t=1;for(var i=0,n;n=e[i];i++){var r=1;for(var o=0,a;a=n.cells[o++];){r=Math.max(a.rowSpan||1,r)}t=Math.max(r+i,t)}return t},getMaxCols:function(){var e=this.table.rows,t=0,i={};for(var n=0,r;r=e[n];n++){var o=0;for(var a=0,s;s=r.cells[a++];){o+=s.colSpan||1;if(s.rowSpan&&s.rowSpan>1){for(var l=1;l<s.rowSpan;l++){if(!i["row_"+(n+l)]){i["row_"+(n+l)]=s.colSpan||1}else{i["row_"+(n+l)]++}}}}o+=i["row_"+n]||0;t=Math.max(o,t)}return t},getCellColIndex:function(e){},getHSideCell:function(e,i){try{var n=this.getCellInfo(e),r,o;var a=this.selectedTds.length,s=this.cellsRange;if(!i&&(!a?!n.colIndex:!s.beginColIndex)||i&&(!a?n.colIndex==this.colsNum-1:s.endColIndex==this.colsNum-1))return null;r=!a?n.rowIndex:s.beginRowIndex;o=!i?!a?n.colIndex<1?0:n.colIndex-1:s.beginColIndex-1:!a?n.colIndex+1:s.endColIndex+1;return this.getCell(this.indexTable[r][o].rowIndex,this.indexTable[r][o].cellIndex)}catch(e){t(e)}},getTabNextCell:function(e,t){var i=this.getCellInfo(e),n=t||i.rowIndex,r=i.colIndex+1+(i.colSpan-1),o;try{o=this.getCell(this.indexTable[n][r].rowIndex,this.indexTable[n][r].cellIndex)}catch(e){try{n=n*1+1;r=0;o=this.getCell(this.indexTable[n][r].rowIndex,this.indexTable[n][r].cellIndex)}catch(e){}}return o},getVSideCell:function(e,i,n){try{var r=this.getCellInfo(e),o,a;var s=this.selectedTds.length&&!n,l=this.cellsRange;if(!i&&r.rowIndex==0||i&&(!s?r.rowIndex+r.rowSpan>this.rowsNum-1:l.endRowIndex==this.rowsNum-1))return null
;o=!i?!s?r.rowIndex-1:l.beginRowIndex-1:!s?r.rowIndex+r.rowSpan:l.endRowIndex+1;a=!s?r.colIndex:l.beginColIndex;return this.getCell(this.indexTable[o][a].rowIndex,this.indexTable[o][a].cellIndex)}catch(e){t(e)}},getSameEndPosCells:function(e,i){try{var n=i.toLowerCase()==="x",r=domUtils.getXY(e)[n?"x":"y"]+e["offset"+(n?"Width":"Height")],o=this.table.rows,a=null,s=[];for(var l=0;l<this.rowsNum;l++){a=o[l].cells;for(var d=0,u;u=a[d++];){var c=domUtils.getXY(u)[n?"x":"y"]+u["offset"+(n?"Width":"Height")];if(c>r&&n)break;if(e==u||r==c){if(u[n?"colSpan":"rowSpan"]==1){s.push(u)}if(n)break}}}return s}catch(e){t(e)}},setCellContent:function(e,t){e.innerHTML=t||(browser.ie?domUtils.fillChar:"<br />")},cloneCell:e.cloneCell,getSameStartPosXCells:function(e){try{var i=domUtils.getXY(e).x+e.offsetWidth,n=this.table.rows,r,o=[];for(var a=0;a<this.rowsNum;a++){r=n[a].cells;for(var s=0,l;l=r[s++];){var d=domUtils.getXY(l).x;if(d>i)break;if(d==i&&l.colSpan==1){o.push(l);break}}}return o}catch(e){t(e)}},update:function(e){this.table=e||this.table;this.selectedTds=[];this.cellsRange={};this.indexTable=[];var t=this.table.rows,i=this.getMaxRows(),n=i-t.length,r=this.getMaxCols();while(n--){this.table.insertRow(t.length)}this.rowsNum=i;this.colsNum=r;for(var o=0,a=t.length;o<a;o++){this.indexTable[o]=new Array(r)}for(var s=0,l;l=t[s];s++){for(var d=0,u,c=l.cells;u=c[d];d++){if(u.rowSpan>i){u.rowSpan=i}var f=d,m=u.rowSpan||1,h=u.colSpan||1;while(this.indexTable[s][f])f++;for(var p=0;p<m;p++){for(var g=0;g<h;g++){this.indexTable[s+p][f+g]={rowIndex:s,cellIndex:d,colIndex:f,rowSpan:m,colSpan:h}}}}}for(p=0;p<i;p++){for(g=0;g<r;g++){if(this.indexTable[p][g]===undefined){l=t[p];u=l.cells[l.cells.length-1];u=u?u.cloneNode(true):this.table.ownerDocument.createElement("td");this.setCellContent(u);if(u.colSpan!==1)u.colSpan=1;if(u.rowSpan!==1)u.rowSpan=1;l.appendChild(u);this.indexTable[p][g]={rowIndex:p,cellIndex:u.cellIndex,colIndex:g,rowSpan:1,colSpan:1}}}}var v=domUtils.getElementsByTagName(this.table,"td"),b=[];utils.each(v,function(e){if(domUtils.hasClass(e,"selectTdClass")){b.push(e)}});if(b.length){var y=b[0],C=b[b.length-1],w=this.getCellInfo(y),N=this.getCellInfo(C);this.selectedTds=b;this.cellsRange={beginRowIndex:w.rowIndex,beginColIndex:w.colIndex,endRowIndex:N.rowIndex+N.rowSpan-1,endColIndex:N.colIndex+N.colSpan-1}}if(!domUtils.hasClass(this.table.rows[0],"firstRow")){domUtils.addClass(this.table.rows[0],"firstRow");for(var o=1;o<this.table.rows.length;o++){domUtils.removeClasses(this.table.rows[o],"firstRow")}}},getCellInfo:function(e){if(!e)return;var t=e.cellIndex,i=e.parentNode.rowIndex,n=this.indexTable[i],r=this.colsNum;for(var o=t;o<r;o++){var a=n[o];if(a.rowIndex===i&&a.cellIndex===t){return a}}},getCell:function(e,t){return e<this.rowsNum&&this.table.rows[e].cells[t]||null},deleteCell:function(e,t){t=typeof t=="number"?t:e.parentNode.rowIndex;var i=this.table.rows[t];i.deleteCell(e.cellIndex)},getCellsRange:function(e,t){function i(e,t,r,o){var a=e,s=t,l=r,d=o,u,c,f;if(e>0){for(c=t;c<o;c++){u=n.indexTable[e][c];f=u.rowIndex;if(f<e){a=Math.min(f,a)}}}if(o<n.colsNum){for(f=e;f<r;f++){u=n.indexTable[f][o];c=u.colIndex+u.colSpan-1;if(c>o){d=Math.max(c,d)}}}if(r<n.rowsNum){for(c=t;c<o;c++){u=n.indexTable[r][c];f=u.rowIndex+u.rowSpan-1;if(f>r){l=Math.max(f,l)}}}if(t>0){for(f=e;f<r;f++){u=n.indexTable[f][t];c=u.colIndex;if(c<t){s=Math.min(u.colIndex,s)}}}if(a!=e||s!=t||l!=r||d!=o){return i(a,s,l,d)}else{return{beginRowIndex:e,beginColIndex:t,endRowIndex:r,endColIndex:o}}}try{var n=this,r=n.getCellInfo(e);if(e===t){return{beginRowIndex:r.rowIndex,beginColIndex:r.colIndex,endRowIndex:r.rowIndex+r.rowSpan-1,endColIndex:r.colIndex+r.colSpan-1}}var o=n.getCellInfo(t);var a=Math.min(r.rowIndex,o.rowIndex),s=Math.min(r.colIndex,o.colIndex),l=Math.max(r.rowIndex+r.rowSpan-1,o.rowIndex+o.rowSpan-1),d=Math.max(r.colIndex+r.colSpan-1,o.colIndex+o.colSpan-1);return i(a,s,l,d)}catch(e){}},getCells:function(e){this.clearSelected();var t=e.beginRowIndex,i=e.beginColIndex,n=e.endRowIndex,r=e.endColIndex,o,a,s,l={},d=[];for(var u=t;u<=n;u++){for(var c=i;c<=r;c++){o=this.indexTable[u][c];a=o.rowIndex;s=o.colIndex;var f=a+"|"+s;if(l[f])continue;l[f]=1;if(a<u||s<c||a+o.rowSpan-1>n||s+o.colSpan-1>r){return null}d.push(this.getCell(a,o.cellIndex))}}return d},clearSelected:function(){e.removeSelectedClass(this.selectedTds);this.selectedTds=[];this.cellsRange={}},setSelected:function(t){var i=this.getCells(t);e.addSelectedClass(i);this.selectedTds=i;this.cellsRange=t},isFullRow:function(){var e=this.cellsRange;return e.endColIndex-e.beginColIndex+1==this.colsNum},isFullCol:function(){var e=this.cellsRange,t=this.table,i=t.getElementsByTagName("th"),n=e.endRowIndex-e.beginRowIndex+1;return!i.length?n==this.rowsNum:n==this.rowsNum||n==this.rowsNum-1},getNextCell:function(e,i,n){try{var r=this.getCellInfo(e),o,a;var s=this.selectedTds.length&&!n,l=this.cellsRange;if(!i&&r.rowIndex==0||i&&(!s?r.rowIndex+r.rowSpan>this.rowsNum-1:l.endRowIndex==this.rowsNum-1))return null;o=!i?!s?r.rowIndex-1:l.beginRowIndex-1:!s?r.rowIndex+r.rowSpan:l.endRowIndex+1;a=!s?r.colIndex:l.beginColIndex;return this.getCell(this.indexTable[o][a].rowIndex,this.indexTable[o][a].cellIndex)}catch(e){t(e)}},getPreviewCell:function(e,i){try{var n=this.getCellInfo(e),r,o;var a=this.selectedTds.length,s=this.cellsRange;if(!i&&(!a?!n.colIndex:!s.beginColIndex)||i&&(!a?n.rowIndex>this.colsNum-1:s.endColIndex==this.colsNum-1))return null;r=!i?!a?n.rowIndex:s.beginRowIndex:!a?n.rowIndex<1?0:n.rowIndex-1:s.beginRowIndex;o=!i?!a?n.colIndex<1?0:n.colIndex-1:s.beginColIndex-1:!a?n.colIndex:s.endColIndex+1;return this.getCell(this.indexTable[r][o].rowIndex,this.indexTable[r][o].cellIndex)}catch(e){t(e)}},moveContent:function(t,i){if(e.isEmptyBlock(i))return;if(e.isEmptyBlock(t)){t.innerHTML=i.innerHTML;return}var n=t.lastChild;if(n.nodeType==3||!dtd.$block[n.tagName]){t.appendChild(t.ownerDocument.createElement("br"))}while(n=i.firstChild){t.appendChild(n)}},mergeRight:function(e){var t=this.getCellInfo(e),i=t.colIndex+t.colSpan,n=this.indexTable[t.rowIndex][i],r=this.getCell(n.rowIndex,n.cellIndex);e.colSpan=t.colSpan+n.colSpan;e.removeAttribute("width");this.moveContent(e,r);this.deleteCell(r,n.rowIndex);this.update()},mergeDown:function(e){var t=this.getCellInfo(e),i=t.rowIndex+t.rowSpan,n=this.indexTable[i][t.colIndex],r=this.getCell(n.rowIndex,n.cellIndex);e.rowSpan=t.rowSpan+n.rowSpan;e.removeAttribute("height");this.moveContent(e,r);this.deleteCell(r,n.rowIndex);this.update()},mergeRange:function(){var e=this.cellsRange,t=this.getCell(e.beginRowIndex,this.indexTable[e.beginRowIndex][e.beginColIndex].cellIndex);if(t.tagName=="TH"&&e.endRowIndex!==e.beginRowIndex){var i=this.indexTable,n=this.getCellInfo(t);t=this.getCell(1,i[1][n.colIndex].cellIndex);e=this.getCellsRange(t,this.getCell(i[this.rowsNum-1][n.colIndex].rowIndex,i[this.rowsNum-1][n.colIndex].cellIndex))}var r=this.getCells(e);for(var o=0,a;a=r[o++];){if(a!==t){this.moveContent(t,a);this.deleteCell(a)}}t.rowSpan=e.endRowIndex-e.beginRowIndex+1;t.rowSpan>1&&t.removeAttribute("height");t.colSpan=e.endColIndex-e.beginColIndex+1;t.colSpan>1&&t.removeAttribute("width");if(t.rowSpan==this.rowsNum&&t.colSpan!=1){t.colSpan=1}if(t.colSpan==this.colsNum&&t.rowSpan!=1){var s=t.parentNode.rowIndex;if(this.table.deleteRow){for(var o=s+1,l=s+1,d=t.rowSpan;o<d;o++){this.table.deleteRow(l)}}else{for(var o=0,d=t.rowSpan-1;o<d;o++){var u=this.table.rows[s+1];u.parentNode.removeChild(u)}}t.rowSpan=1}this.update()},insertRow:function(e,t){var i=this.colsNum,n=this.table,r=n.insertRow(e),o,a=typeof t=="string"&&t.toUpperCase()=="TH";function s(e,t,i){if(e==0){var n=i.nextSibling||i.previousSibling,r=n.cells[e];if(r.tagName=="TH"){r=t.ownerDocument.createElement("th");r.appendChild(t.firstChild);i.insertBefore(r,t);domUtils.remove(t)}}else{if(t.tagName=="TH"){var o=t.ownerDocument.createElement("td");o.appendChild(t.firstChild);i.insertBefore(o,t);domUtils.remove(t)}}}if(e==0||e==this.rowsNum){for(var l=0;l<i;l++){o=this.cloneCell(t,true);this.setCellContent(o);o.getAttribute("vAlign")&&o.setAttribute("vAlign",o.getAttribute("vAlign"));r.appendChild(o);if(!a)s(l,o,r)}}else{var d=this.indexTable[e],u=0;for(l=0;l<i;l++){var c=d[l];if(c.rowIndex<e){o=this.getCell(c.rowIndex,c.cellIndex);o.rowSpan=c.rowSpan+1}else{o=this.cloneCell(t,true);this.setCellContent(o);r.appendChild(o)}if(!a)s(l,o,r)}}this.update();return r},deleteRow:function(e){var t=this.table.rows[e],i=this.indexTable[e],n=this.colsNum,r=0;for(var o=0;o<n;){var a=i[o],s=this.getCell(a.rowIndex,a.cellIndex);if(s.rowSpan>1){if(a.rowIndex==e){var l=s.cloneNode(true);l.rowSpan=s.rowSpan-1;l.innerHTML="";s.rowSpan=1;var d=e+1,u=this.table.rows[d],c,f=this.getPreviewMergedCellsNum(d,o)-r;if(f<o){c=o-f-1;domUtils.insertAfter(u.cells[c],l)}else{if(u.cells.length)u.insertBefore(l,u.cells[0])}r+=1}}o+=s.colSpan||1}var m=[],h={};for(o=0;o<n;o++){var p=i[o].rowIndex,g=i[o].cellIndex,v=p+"_"+g;if(h[v])continue;h[v]=1;s=this.getCell(p,g);m.push(s)}var b=[];utils.each(m,function(e){if(e.rowSpan==1){e.parentNode.removeChild(e)}else{b.push(e)}});utils.each(b,function(e){e.rowSpan--});t.parentNode.removeChild(t);this.update()},insertCol:function(e,t,i){var n=this.rowsNum,r=0,o,a,s=parseInt((this.table.offsetWidth-(this.colsNum+1)*20-(this.colsNum+1))/(this.colsNum+1),10),l=typeof t=="string"&&t.toUpperCase()=="TH";function d(e,t,i){if(e==0){var n=t.nextSibling||t.previousSibling;if(n.tagName=="TH"){n=t.ownerDocument.createElement("th");n.appendChild(t.firstChild);i.insertBefore(n,t);domUtils.remove(t)}}else{if(t.tagName=="TH"){var r=t.ownerDocument.createElement("td");r.appendChild(t.firstChild);i.insertBefore(r,t);domUtils.remove(t)}}}var u;if(e==0||e==this.colsNum){for(;r<n;r++){o=this.table.rows[r];u=o.cells[e==0?e:o.cells.length];a=this.cloneCell(t,true);this.setCellContent(a);a.setAttribute("vAlign",a.getAttribute("vAlign"));u&&a.setAttribute("width",u.getAttribute("width"));if(!e){o.insertBefore(a,o.cells[0])}else{domUtils.insertAfter(o.cells[o.cells.length-1],a)}if(!l)d(r,a,o)}}else{for(;r<n;r++){var c=this.indexTable[r][e];if(c.colIndex<e){a=this.getCell(c.rowIndex,c.cellIndex);a.colSpan=c.colSpan+1}else{o=this.table.rows[r];u=o.cells[c.cellIndex];a=this.cloneCell(t,true);this.setCellContent(a);a.setAttribute("vAlign",a.getAttribute("vAlign"));u&&a.setAttribute("width",u.getAttribute("width"));u?o.insertBefore(a,u):o.appendChild(a)}if(!l)d(r,a,o)}}this.update();this.updateWidth(s,i||{tdPadding:10,tdBorder:1})},updateWidth:function(t,i){var n=this.table,r=e.getWidth(n)-i.tdPadding*2-i.tdBorder+t;if(r<n.ownerDocument.body.offsetWidth){n.setAttribute("width",r);return}var o=domUtils.getElementsByTagName(this.table,"td th");utils.each(o,function(e){e.setAttribute("width",t)})},deleteCol:function(e){var t=this.indexTable,i=this.table.rows,n=this.table.getAttribute("width"),r=0,o=this.rowsNum,a={};for(var s=0;s<o;){var l=t[s],d=l[e],u=d.rowIndex+"_"+d.colIndex;if(a[u])continue;a[u]=1;var c=this.getCell(d.rowIndex,d.cellIndex);if(!r)r=c&&parseInt(c.offsetWidth/c.colSpan,10).toFixed(0);if(c.colSpan>1){c.colSpan--}else{i[s].deleteCell(d.cellIndex)}s+=d.rowSpan||1}this.table.setAttribute("width",n-r);this.update()},splitToCells:function(e){var t=this,i=this.splitToRows(e);utils.each(i,function(e){t.splitToCols(e)})},splitToRows:function(e){var t=this.getCellInfo(e),i=t.rowIndex,n=t.colIndex,r=[];e.rowSpan=1;r.push(e);for(var o=i,a=i+t.rowSpan;o<a;o++){if(o==i)continue;var s=this.table.rows[o],l=s.insertCell(n-this.getPreviewMergedCellsNum(o,n));l.colSpan=t.colSpan;this.setCellContent(l);l.setAttribute("vAlign",e.getAttribute("vAlign"));l.setAttribute("align",e.getAttribute("align"));if(e.style.cssText){l.style.cssText=e.style.cssText}r.push(l)}this.update();return r},getPreviewMergedCellsNum:function(e,t){var i=this.indexTable[e],n=0;for(var r=0;r<t;){var o=i[r].colSpan,a=i[r].rowIndex;n+=o-(a==e?1:0);r+=o}return n},splitToCols:function(e){var t=(e.offsetWidth/e.colSpan-22).toFixed(0),i=this.getCellInfo(e),n=i.rowIndex,r=i.colIndex,o=[];e.colSpan=1;e.setAttribute("width",t);o.push(e);for(var a=r,s=r+i.colSpan;a<s;a++){if(a==r)continue;var l=this.table.rows[n],d=l.insertCell(this.indexTable[n][a].cellIndex+1);d.rowSpan=i.rowSpan;this.setCellContent(d);d.setAttribute("vAlign",e.getAttribute("vAlign"));d.setAttribute("align",e.getAttribute("align"));d.setAttribute("width",t);if(e.style.cssText){d.style.cssText=e.style.cssText}if(e.tagName=="TH"){var u=e.ownerDocument.createElement("th");u.appendChild(d.firstChild);u.setAttribute("vAlign",e.getAttribute("vAlign"));u.rowSpan=d.rowSpan;l.insertBefore(u,d);domUtils.remove(d)}o.push(d)}this.update();return o},isLastCell:function(e,t,i){t=t||this.rowsNum;i=i||this.colsNum;var n=this.getCellInfo(e);return n.rowIndex+n.rowSpan==t&&n.colIndex+n.colSpan==i},getLastCell:function(e){e=e||this.table.getElementsByTagName("td");var t=this.getCellInfo(e[0]);var i=this,n=e[0],r=n.parentNode,o=0,a=0,s;utils.each(e,function(e){if(e.parentNode==r)a+=e.colSpan||1;o+=e.rowSpan*e.colSpan||1});s=o/a;utils.each(e,function(e){if(i.isLastCell(e,s,a)){n=e;return false}});return n},selectRow:function(e){var t=this.indexTable[e],i=this.getCell(t[0].rowIndex,t[0].cellIndex),n=this.getCell(t[this.colsNum-1].rowIndex,t[this.colsNum-1].cellIndex),r=this.getCellsRange(i,n);this.setSelected(r)},selectTable:function(){var e=this.table.getElementsByTagName("td"),t=this.getCellsRange(e[0],e[e.length-1]);this.setSelected(t)},setBackground:function(e,t){if(typeof t==="string"){utils.each(e,function(e){e.style.backgroundColor=t})}else if(typeof t==="object"){t=utils.extend({repeat:true,colorList:["#ddd","#fff"]},t);var i=this.getCellInfo(e[0]).rowIndex,n=0,r=t.colorList,o=function(e,t,i){return e[t]?e[t]:i?e[t%e.length]:""};for(var a=0,s;s=e[a++];){var l=this.getCellInfo(s);s.style.backgroundColor=o(r,i+n==l.rowIndex?n:++n,t.repeat)}}},removeBackground:function(e){utils.each(e,function(e){e.style.backgroundColor=""})}};function t(e){}})();(function(){var e=UE.UETable,t=function(t){return e.getTableItemsByRange(t)},i=function(t){return e.getUETableBySelected(t)},n=function(t,i){return e.getDefaultValue(t,i)},r=function(t){return e.getUETable(t)};UE.commands["inserttable"]={queryCommandState:function(){return t(this).table?-1:0},execCommand:function(e,t){function i(e,t){var i=[],n=e.numRows,r=e.numCols;for(var o=0;o<n;o++){i.push("<tr"+(o==0?' class="firstRow"':"")+">");for(var a=0;a<r;a++){i.push('<td width="'+t+'"  vAlign="'+e.tdvalign+'" >'+(browser.ie&&browser.version<11?domUtils.fillChar:"<br/>")+"</td>")}i.push("</tr>")}return"<table><tbody>"+i.join("")+"</tbody></table>"}if(!t){t=utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign})}var r=this;var o=this.selection.getRange(),a=o.startContainer,s=domUtils.findParent(a,function(e){return domUtils.isBlockElm(e)},true)||r.body;var l=n(r),d=s.offsetWidth,u=Math.floor(d/t.numCols-l.tdPadding*2-l.tdBorder);!t.tdvalign&&(t.tdvalign=r.options.tdvalign);r.execCommand("inserthtml",i(t,u))}};UE.commands["insertparagraphbeforetable"]={queryCommandState:function(){return t(this).cell?0:-1},execCommand:function(){var e=t(this).table;if(e){var i=this.document.createElement("p");i.innerHTML=browser.ie?"&nbsp;":"<br />";e.parentNode.insertBefore(i,e);this.selection.getRange().setStart(i,0).setCursor()}}};UE.commands["deletetable"]={queryCommandState:function(){var e=this.selection.getRange();return domUtils.findParentByTagName(e.startContainer,"table",true)?0:-1},execCommand:function(e,t){var i=this.selection.getRange();t=t||domUtils.findParentByTagName(i.startContainer,"table",true);if(t){var n=t.nextSibling;if(!n){n=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});t.parentNode.insertBefore(n,t)}domUtils.remove(t);i=this.selection.getRange();if(n.nodeType==3){i.setStartBefore(n)}else{i.setStart(n,0)}i.setCursor(false,true);this.fireEvent("tablehasdeleted")}}};UE.commands["cellalign"]={queryCommandState:function(){return s(this).length?0:-1},execCommand:function(e,t){var i=s(this);if(i.length){for(var n=0,r;r=i[n++];){r.setAttribute("align",t)}}}};UE.commands["cellvalign"]={queryCommandState:function(){return s(this).length?0:-1},execCommand:function(e,t){var i=s(this);if(i.length){for(var n=0,r;r=i[n++];){r.setAttribute("vAlign",t)}}}};UE.commands["insertcaption"]={queryCommandState:function(){var e=t(this).table;if(e){return e.getElementsByTagName("caption").length==0?1:-1}return-1},execCommand:function(){var e=t(this).table;if(e){var i=this.document.createElement("caption");i.innerHTML=browser.ie?domUtils.fillChar:"<br/>";e.insertBefore(i,e.firstChild);var n=this.selection.getRange();n.setStart(i,0).setCursor()}}};UE.commands["deletecaption"]={queryCommandState:function(){var e=this.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,"table");if(t){return t.getElementsByTagName("caption").length==0?-1:1}return-1},execCommand:function(){var e=this.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,"table");if(t){domUtils.remove(t.getElementsByTagName("caption")[0]);var i=this.selection.getRange();i.setStart(t.rows[0].cells[0],0).setCursor()}}};UE.commands["inserttitle"]={queryCommandState:function(){var e=t(this).table;if(e){var i=e.rows[0];return i.cells[i.cells.length-1].tagName.toLowerCase()!="th"?0:-1}return-1},execCommand:function(){var e=t(this).table;if(e){r(e).insertRow(0,"th")}var i=e.getElementsByTagName("th")[0];this.selection.getRange().setStart(i,0).setCursor(false,true)}};UE.commands["deletetitle"]={queryCommandState:function(){var e=t(this).table;if(e){var i=e.rows[0];return i.cells[i.cells.length-1].tagName.toLowerCase()=="th"?0:-1}return-1},execCommand:function(){var e=t(this).table;if(e){domUtils.remove(e.rows[0])}var i=e.getElementsByTagName("td")[0];this.selection.getRange().setStart(i,0).setCursor(false,true)}};UE.commands["inserttitlecol"]={queryCommandState:function(){var e=t(this).table;if(e){var i=e.rows[e.rows.length-1];return i.getElementsByTagName("th").length?-1:0}return-1},execCommand:function(e){var i=t(this).table;if(i){r(i).insertCol(0,"th")}o(i,this);var n=i.getElementsByTagName("th")[0];this.selection.getRange().setStart(n,0).setCursor(false,true)}};UE.commands["deletetitlecol"]={queryCommandState:function(){var e=t(this).table;if(e){var i=e.rows[e.rows.length-1];return i.getElementsByTagName("th").length?0:-1}return-1},execCommand:function(){var e=t(this).table;if(e){for(var i=0;i<e.rows.length;i++){domUtils.remove(e.rows[i].children[0])}}o(e,this);var n=e.getElementsByTagName("td")[0];this.selection.getRange().setStart(n,0).setCursor(false,true)}};UE.commands["mergeright"]={queryCommandState:function(e){var i=t(this),n=i.table,o=i.cell;if(!n||!o)return-1;var a=r(n);if(a.selectedTds.length)return-1;var s=a.getCellInfo(o),l=s.colIndex+s.colSpan;if(l>=a.colsNum)return-1;var d=a.indexTable[s.rowIndex][l],u=n.rows[d.rowIndex].cells[d.cellIndex];if(!u||o.tagName!=u.tagName)return-1;return d.rowIndex==s.rowIndex&&d.rowSpan==s.rowSpan?0:-1},execCommand:function(e){var i=this.selection.getRange(),n=i.createBookmark(true);var o=t(this).cell,a=r(o);a.mergeRight(o);i.moveToBookmark(n).select()}};UE.commands["mergedown"]={queryCommandState:function(e){var i=t(this),n=i.table,o=i.cell;if(!n||!o)return-1;var a=r(n);if(a.selectedTds.length)return-1;var s=a.getCellInfo(o),l=s.rowIndex+s.rowSpan;if(l>=a.rowsNum)return-1;var d=a.indexTable[l][s.colIndex],u=n.rows[d.rowIndex].cells[d.cellIndex];if(!u||o.tagName!=u.tagName)return-1;return d.colIndex==s.colIndex&&d.colSpan==s.colSpan?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this).cell,o=r(n);o.mergeDown(n);e.moveToBookmark(i).select()}};UE.commands["mergecells"]={queryCommandState:function(){return i(this)?0:-1},execCommand:function(){var e=i(this);if(e&&e.selectedTds.length){var t=e.selectedTds[0];e.mergeRange();var n=this.selection.getRange();if(domUtils.isEmptyBlock(t)){n.setStart(t,0).collapse(true)}else{n.selectNodeContents(t)}n.select()}}};UE.commands["insertrow"]={queryCommandState:function(){var e=t(this),i=e.cell;return i&&(i.tagName=="TD"||i.tagName=="TH"&&e.tr!==e.table.rows[0])&&r(e.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this),o=n.cell,a=n.table,s=r(a),l=s.getCellInfo(o);if(!s.selectedTds.length){s.insertRow(l.rowIndex,o)}else{var d=s.cellsRange;for(var u=0,c=d.endRowIndex-d.beginRowIndex+1;u<c;u++){s.insertRow(d.beginRowIndex,o)}}e.moveToBookmark(i).select();if(a.getAttribute("interlaced")==="enabled")this.fireEvent("interlacetable",a)}};UE.commands["insertrownext"]={queryCommandState:function(){var e=t(this),i=e.cell;return i&&i.tagName=="TD"&&r(e.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this),o=n.cell,a=n.table,s=r(a),l=s.getCellInfo(o);if(!s.selectedTds.length){s.insertRow(l.rowIndex+l.rowSpan,o)}else{var d=s.cellsRange;for(var u=0,c=d.endRowIndex-d.beginRowIndex+1;u<c;u++){s.insertRow(d.endRowIndex+1,o)}}e.moveToBookmark(i).select();if(a.getAttribute("interlaced")==="enabled")this.fireEvent("interlacetable",a)}};UE.commands["deleterow"]={queryCommandState:function(){var e=t(this);return e.cell?0:-1},execCommand:function(){var e=t(this).cell,i=r(e),n=i.cellsRange,o=i.getCellInfo(e),a=i.getVSideCell(e),s=i.getVSideCell(e,true),l=this.selection.getRange();if(utils.isEmptyObject(n)){i.deleteRow(o.rowIndex)}else{for(var d=n.beginRowIndex;d<n.endRowIndex+1;d++){i.deleteRow(n.beginRowIndex)}}var u=i.table;if(!u.getElementsByTagName("td").length){var c=u.nextSibling;domUtils.remove(u);if(c){l.setStart(c,0).setCursor(false,true)}}else{if(o.rowSpan==1||o.rowSpan==n.endRowIndex-n.beginRowIndex+1){if(s||a)l.selectNodeContents(s||a).setCursor(false,true)}else{var f=i.getCell(o.rowIndex,i.indexTable[o.rowIndex][o.colIndex].cellIndex);if(f)l.selectNodeContents(f).setCursor(false,true)}}if(u.getAttribute("interlaced")==="enabled")this.fireEvent("interlacetable",u)}};UE.commands["insertcol"]={queryCommandState:function(e){var i=t(this),n=i.cell;return n&&(n.tagName=="TD"||n.tagName=="TH"&&n!==i.tr.cells[0])&&r(i.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(e){var i=this.selection.getRange(),n=i.createBookmark(true);if(this.queryCommandState(e)==-1)return;var o=t(this).cell,a=r(o),s=a.getCellInfo(o);if(!a.selectedTds.length){a.insertCol(s.colIndex,o)}else{var l=a.cellsRange;for(var d=0,u=l.endColIndex-l.beginColIndex+1;d<u;d++){a.insertCol(l.beginColIndex,o)}}i.moveToBookmark(n).select(true)}};UE.commands["insertcolnext"]={queryCommandState:function(){var e=t(this),i=e.cell;return i&&r(e.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this).cell,o=r(n),a=o.getCellInfo(n);if(!o.selectedTds.length){o.insertCol(a.colIndex+a.colSpan,n)}else{var s=o.cellsRange;for(var l=0,d=s.endColIndex-s.beginColIndex+1;l<d;l++){o.insertCol(s.endColIndex+1,n)}}e.moveToBookmark(i).select()}};UE.commands["deletecol"]={queryCommandState:function(){var e=t(this);return e.cell?0:-1},execCommand:function(){var e=t(this).cell,i=r(e),n=i.cellsRange,o=i.getCellInfo(e),a=i.getHSideCell(e),s=i.getHSideCell(e,true);if(utils.isEmptyObject(n)){i.deleteCol(o.colIndex)}else{for(var l=n.beginColIndex;l<n.endColIndex+1;l++){i.deleteCol(n.beginColIndex)}}var d=i.table,u=this.selection.getRange();if(!d.getElementsByTagName("td").length){var c=d.nextSibling;domUtils.remove(d);if(c){u.setStart(c,0).setCursor(false,true)}}else{if(domUtils.inDoc(e,this.document)){u.setStart(e,0).setCursor(false,true)}else{if(s&&domUtils.inDoc(s,this.document)){u.selectNodeContents(s).setCursor(false,true)}else{if(a&&domUtils.inDoc(a,this.document)){u.selectNodeContents(a).setCursor(true,true)}}}}}};UE.commands["splittocells"]={queryCommandState:function(){var e=t(this),i=e.cell;if(!i)return-1;var n=r(e.table);if(n.selectedTds.length>0)return-1;return i&&(i.colSpan>1||i.rowSpan>1)?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this).cell,o=r(n);o.splitToCells(n);e.moveToBookmark(i).select()}};UE.commands["splittorows"]={queryCommandState:function(){var e=t(this),i=e.cell;if(!i)return-1;var n=r(e.table);if(n.selectedTds.length>0)return-1;return i&&i.rowSpan>1?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this).cell,o=r(n);o.splitToRows(n);e.moveToBookmark(i).select()}};UE.commands["splittocols"]={queryCommandState:function(){var e=t(this),i=e.cell;if(!i)return-1;var n=r(e.table);if(n.selectedTds.length>0)return-1;return i&&i.colSpan>1?0:-1},execCommand:function(){var e=this.selection.getRange(),i=e.createBookmark(true);var n=t(this).cell,o=r(n);o.splitToCols(n);e.moveToBookmark(i).select()}};UE.commands["adaptbytext"]=UE.commands["adaptbywindow"]={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e){var i=t(this),n=i.table;if(n){if(e=="adaptbywindow"){o(n,this)}else{var r=domUtils.getElementsByTagName(n,"td th");utils.each(r,function(e){e.removeAttribute("width")});n.removeAttribute("width")}}}};UE.commands["averagedistributecol"]={queryCommandState:function(){var e=i(this);if(!e)return-1;return e.isFullRow()||e.isFullCol()?0:-1},execCommand:function(e){var t=this,r=i(t);function o(){var e=r.table,i,o=0,a=0,s=n(t,e);if(r.isFullRow()){o=e.offsetWidth;a=r.colsNum}else{var l=r.cellsRange.beginColIndex,d=r.cellsRange.endColIndex,u;for(var c=l;c<=d;){u=r.selectedTds[c];o+=u.offsetWidth;c+=u.colSpan;a+=1}}i=Math.ceil(o/a)-s.tdBorder*2-s.tdPadding*2;return i}function a(e){utils.each(domUtils.getElementsByTagName(r.table,"th"),function(e){e.setAttribute("width","")});var t=r.isFullRow()?domUtils.getElementsByTagName(r.table,"td"):r.selectedTds;utils.each(t,function(t){if(t.colSpan==1){t.setAttribute("width",e)}})}if(r&&r.selectedTds.length){a(o())}}};UE.commands["averagedistributerow"]={queryCommandState:function(){var e=i(this);if(!e)return-1;if(e.selectedTds&&/th/gi.test(e.selectedTds[0].tagName))return-1;return e.isFullRow()||e.isFullCol()?0:-1},execCommand:function(e){var t=this,r=i(t);function o(){var e,i,o=0,a=r.table,s=n(t,a),l=parseInt(domUtils.getComputedStyle(a.getElementsByTagName("td")[0],"padding-top"));if(r.isFullCol()){var d=domUtils.getElementsByTagName(a,"caption"),u=domUtils.getElementsByTagName(a,"th"),c,f;if(d.length>0){c=d[0].offsetHeight}if(u.length>0){f=u[0].offsetHeight}o=a.offsetHeight-(c||0)-(f||0);i=u.length==0?r.rowsNum:r.rowsNum-1}else{var m=r.cellsRange.beginRowIndex,h=r.cellsRange.endRowIndex,p=0,g=domUtils.getElementsByTagName(a,"tr");for(var v=m;v<=h;v++){o+=g[v].offsetHeight;p+=1}i=p}if(browser.ie&&browser.version<9){e=Math.ceil(o/i)}else{e=Math.ceil(o/i)-s.tdBorder*2-l*2}return e}function a(e){var t=r.isFullCol()?domUtils.getElementsByTagName(r.table,"td"):r.selectedTds;utils.each(t,function(t){if(t.rowSpan==1){t.setAttribute("height",e)}})}if(r&&r.selectedTds.length){a(o())}}};UE.commands["cellalignment"]={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e,t){var n=this,r=i(n);if(!r){var o=n.selection.getStart(),a=o&&domUtils.findParentByTagName(o,["td","th","caption"],true);if(!/caption/gi.test(a.tagName)){domUtils.setAttributes(a,t)}else{a.style.textAlign=t.align;a.style.verticalAlign=t.vAlign}n.selection.getRange().setCursor(true)}else{utils.each(r.selectedTds,function(e){domUtils.setAttributes(e,t)})}},queryCommandValue:function(e){var i=t(this).cell;if(!i){i=s(this)[0]}if(!i){return null}else{var n=UE.UETable.getUETable(i).selectedTds;!n.length&&(n=i);return UE.UETable.getTableCellAlignState(n)}}};UE.commands["tablealignment"]={queryCommandState:function(){if(browser.ie&&browser.version<8){return-1}return t(this).table?0:-1},execCommand:function(e,t){var i=this,n=i.selection.getStart(),r=n&&domUtils.findParentByTagName(n,["table"],true);if(r){r.setAttribute("align",t)}}};UE.commands["edittable"]={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e,t){var i=this.selection.getRange(),n=domUtils.findParentByTagName(i.startContainer,"table");if(n){var r=domUtils.getElementsByTagName(n,"td").concat(domUtils.getElementsByTagName(n,"th"),domUtils.getElementsByTagName(n,"caption"));utils.each(r,function(e){e.style.borderColor=t})}}};UE.commands["edittd"]={queryCommandState:function(){return t(this).table?0:-1},execCommand:function(e,t){var n=this,r=i(n);if(!r){var o=n.selection.getStart(),a=o&&domUtils.findParentByTagName(o,["td","th","caption"],true);if(a){a.style.backgroundColor=t}}else{utils.each(r.selectedTds,function(e){e.style.backgroundColor=t})}}};UE.commands["settablebackground"]={queryCommandState:function(){return s(this).length>1?0:-1},execCommand:function(e,t){var i,n;i=s(this);n=r(i[0]);n.setBackground(i,t)}};UE.commands["cleartablebackground"]={queryCommandState:function(){var e=s(this);if(!e.length)return-1;for(var t=0,i;i=e[t++];){if(i.style.backgroundColor!=="")return 0}return-1},execCommand:function(){var e=s(this),t=r(e[0]);t.removeBackground(e)}};UE.commands["interlacetable"]=UE.commands["uninterlacetable"]={queryCommandState:function(e){var i=t(this).table;if(!i)return-1;var n=i.getAttribute("interlaced");if(e=="interlacetable"){return n==="enabled"?-1:0}else{return!n||n==="disabled"?-1:0}},execCommand:function(e,i){var n=t(this).table;if(e=="interlacetable"){n.setAttribute("interlaced","enabled");this.fireEvent("interlacetable",n,i)}else{n.setAttribute("interlaced","disabled");this.fireEvent("uninterlacetable",n)}}};UE.commands["setbordervisible"]={queryCommandState:function(e){var i=t(this).table;if(!i)return-1;return 0},execCommand:function(){var e=t(this).table;utils.each(domUtils.getElementsByTagName(e,"td"),function(e){e.style.borderWidth="1px";e.style.borderStyle="solid"})}};function o(e,t){var i=domUtils.getElementsByTagName(e,"td th");utils.each(i,function(e){e.removeAttribute("width")});e.setAttribute("width",a(t,true,n(t,e)));var r=[];setTimeout(function(){utils.each(i,function(e){e.colSpan==1&&r.push(e.offsetWidth)});utils.each(i,function(e,t){e.colSpan==1&&e.setAttribute("width",r[t]+"")})},0)}function a(e,t,i){var n=e.body;return n.offsetWidth-(t?parseInt(domUtils.getComputedStyle(n,"margin-left"),10)*2:0)-i.tableBorder*2-(e.options.offsetWidth||0)}function s(e){var i=t(e).cell;if(i){var n=r(i);return n.selectedTds.length?n.selectedTds:[i]}else{return[]}}})();UE.plugins["table"]=function(){var e=this,t=null,i=null,n=null,r=5,o=false,a=5,s=10,l=0,d=null,u=360,c=UE.UETable,f=function(e){return c.getUETable(e)},m=function(e){return c.getUETableBySelected(e)},h=function(e,t){return c.getDefaultValue(e,t)},p=function(e){return c.removeSelectedClass(e)};function g(e){}e.ready(function(){var e=this;var t=e.selection.getText;e.selection.getText=function(){var i=m(e);if(i){var n="";utils.each(i.selectedTds,function(e){n+=e[browser.ie?"innerText":"textContent"]});return n}else{return t.call(e.selection)}}});var v=null,b=null,y="",C=false,w=null,N=false,x=null,U=null;var E=false,T=true;e.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:e.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:false,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]});e.getUETable=f;var S={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};e.ready(function(){
utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}"+"table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}"+"table{margin-bottom:10px;border-collapse:collapse;display:table;}"+"td,th{padding: 5px 10px;border: 1px solid #DDD;}"+"caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}"+"th{border-top:1px solid #BBB;background-color:#F7F7F7;}"+"table tr.firstRow th{border-top-width:2px;}"+".ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }"+"td p{margin:0;padding:0;}",e.document);var t,i,n;e.addListener("keydown",function(e,r){var o=this;var a=r.keyCode||r.which;if(a==8){var s=m(o);if(s&&s.selectedTds.length){if(s.isFullCol()){o.execCommand("deletecol")}else if(s.isFullRow()){o.execCommand("deleterow")}else{o.fireEvent("delcells")}domUtils.preventDefault(r)}var l=domUtils.findParentByTagName(o.selection.getStart(),"caption",true),d=o.selection.getRange();if(d.collapsed&&l&&_(l)){o.fireEvent("saveScene");var u=l.parentNode;domUtils.remove(l);if(u){d.setStart(u.rows[0].cells[0],0).setCursor(false,true)}o.fireEvent("saveScene")}}if(a==46){s=m(o);if(s){o.fireEvent("saveScene");for(var c=0,f;f=s.selectedTds[c++];){domUtils.fillNode(o.document,f)}o.fireEvent("saveScene");domUtils.preventDefault(r)}}if(a==13){var h=o.selection.getRange(),l=domUtils.findParentByTagName(h.startContainer,"caption",true);if(l){var u=domUtils.findParentByTagName(l,"table");if(!h.collapsed){h.deleteContents();o.fireEvent("saveScene")}else{if(l){h.setStart(u.rows[0].cells[0],0).setCursor(false,true)}}domUtils.preventDefault(r);return}if(h.collapsed){var u=domUtils.findParentByTagName(h.startContainer,"table");if(u){var p=u.rows[0].cells[0],g=domUtils.findParentByTagName(o.selection.getStart(),["td","th"],true),v=u.previousSibling;if(p===g&&(!v||v.nodeType==1&&v.tagName=="TABLE")&&domUtils.isStartInblock(h)){var b=domUtils.findParent(o.selection.getStart(),function(e){return domUtils.isBlockElm(e)},true);if(b&&(/t(h|d)/i.test(b.tagName)||b===g.firstChild)){o.execCommand("insertparagraphbeforetable");domUtils.preventDefault(r)}}}}}if((r.ctrlKey||r.metaKey)&&r.keyCode=="67"){t=null;var s=m(o);if(s){var y=s.selectedTds;i=s.isFullCol();n=s.isFullRow();t=[[s.cloneCell(y[0],null,true)]];for(var c=1,f;f=y[c];c++){if(f.parentNode!==y[c-1].parentNode){t.push([s.cloneCell(f,null,true)])}else{t[t.length-1].push(s.cloneCell(f,null,true))}}}}});e.addListener("tablehasdeleted",function(){$(this,false,"",null);if(w)domUtils.remove(w)});e.addListener("beforepaste",function(e,r){var o=this;var a=o.selection.getRange();if(domUtils.findParentByTagName(a.startContainer,"caption",true)){var s=o.document.createElement("div");s.innerHTML=r.html;r.html=s[browser.ie9below?"innerText":"textContent"];return}var l=m(o);if(t){o.fireEvent("saveScene");var a=o.selection.getRange();var d=domUtils.findParentByTagName(a.startContainer,["td","th"],true),u,p;if(d){var g=f(d);if(n){var v=g.getCellInfo(d).rowIndex;if(d.tagName=="TH"){v++}for(var b=0,y;y=t[b++];){var C=g.insertRow(v++,"td");for(var w=0,N;N=y[w];w++){var x=C.cells[w];if(!x){x=C.insertCell(w)}x.innerHTML=N.innerHTML;N.getAttribute("width")&&x.setAttribute("width",N.getAttribute("width"));N.getAttribute("vAlign")&&x.setAttribute("vAlign",N.getAttribute("vAlign"));N.getAttribute("align")&&x.setAttribute("align",N.getAttribute("align"));N.style.cssText&&(x.style.cssText=N.style.cssText)}for(var w=0,N;N=C.cells[w];w++){if(!y[w])break;N.innerHTML=y[w].innerHTML;y[w].getAttribute("width")&&N.setAttribute("width",y[w].getAttribute("width"));y[w].getAttribute("vAlign")&&N.setAttribute("vAlign",y[w].getAttribute("vAlign"));y[w].getAttribute("align")&&N.setAttribute("align",y[w].getAttribute("align"));y[w].style.cssText&&(N.style.cssText=y[w].style.cssText)}}}else{if(i){S=g.getCellInfo(d);var U=0;for(var w=0,y=t[0],N;N=y[w++];){U+=N.colSpan||1}o.__hasEnterExecCommand=true;for(b=0;b<U;b++){o.execCommand("insertcol")}o.__hasEnterExecCommand=false;d=g.table.rows[0].cells[S.cellIndex];if(d.tagName=="TH"){d=g.table.rows[1].cells[S.cellIndex]}}for(var b=0,y;y=t[b++];){u=d;for(var w=0,N;N=y[w++];){if(d){d.innerHTML=N.innerHTML;N.getAttribute("width")&&d.setAttribute("width",N.getAttribute("width"));N.getAttribute("vAlign")&&d.setAttribute("vAlign",N.getAttribute("vAlign"));N.getAttribute("align")&&d.setAttribute("align",N.getAttribute("align"));N.style.cssText&&(d.style.cssText=N.style.cssText);p=d;d=d.nextSibling}else{var E=N.cloneNode(true);domUtils.removeAttributes(E,["class","rowSpan","colSpan"]);p.parentNode.appendChild(E)}}d=g.getNextCell(u,true,true);if(!t[b])break;if(!d){var S=g.getCellInfo(u);g.table.insertRow(g.table.rows.length);g.update();d=g.getVSideCell(u,true)}}}g.update()}else{l=o.document.createElement("table");for(var b=0,y;y=t[b++];){var C=l.insertRow(l.rows.length);for(var w=0,N;N=y[w++];){E=c.cloneCell(N,null,true);domUtils.removeAttributes(E,["class"]);C.appendChild(E)}if(w==2&&E.rowSpan>1){E.rowSpan=1}}var B=h(o),I=o.body.offsetWidth-(T?parseInt(domUtils.getComputedStyle(o.body,"margin-left"),10)*2:0)-B.tableBorder*2-(o.options.offsetWidth||0);o.execCommand("insertHTML","<table  "+(i&&n?'width="'+I+'"':"")+">"+l.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"</table>")}o.fireEvent("contentchange");o.fireEvent("saveScene");r.html="";return true}else{var s=o.document.createElement("div"),R;s.innerHTML=r.html;R=s.getElementsByTagName("table");if(domUtils.findParentByTagName(o.selection.getStart(),"table")){utils.each(R,function(e){domUtils.remove(e)});if(domUtils.findParentByTagName(o.selection.getStart(),"caption",true)){s.innerHTML=s[browser.ie?"innerText":"textContent"]}}else{utils.each(R,function(e){k(e,true);domUtils.removeAttributes(e,["style","border"]);utils.each(domUtils.getElementsByTagName(e,"td"),function(e){if(_(e)){domUtils.fillNode(o.document,e)}k(e,true)})})}r.html=s.innerHTML}});e.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(e.body,"table"),function(t){if(t.offsetWidth>e.body.offsetWidth){var i=h(e,t);t.style.width=e.body.offsetWidth-(T?parseInt(domUtils.getComputedStyle(e.body,"margin-left"),10)*2:0)-i.tableBorder*2-(e.options.offsetWidth||0)+"px"}})});e.addListener("blur",function(){t=null});var r;e.addListener("keydown",function(){clearTimeout(r);r=setTimeout(function(){var t=e.selection.getRange(),i=domUtils.findParentByTagName(t.startContainer,["th","td"],true);if(i){var n=i.parentNode.parentNode.parentNode;if(n.offsetWidth>n.getAttribute("width")){i.style.wordBreak="break-all"}}},100)});e.addListener("selectionchange",function(){$(e,false,"",null)});e.addListener("contentchange",function(){var e=this;he(e);if(m(e))return;var t=e.selection.getRange();var i=t.startContainer;i=domUtils.findParentByTagName(i,["td","th"],true);utils.each(domUtils.getElementsByTagName(e.document,"table"),function(t){if(e.fireEvent("excludetable",t)===true)return;t.ueTable=new c(t);t.onmouseover=function(){e.fireEvent("tablemouseover",t)};t.onmousemove=function(){e.fireEvent("tablemousemove",t);e.options.tableDragable&&D(true,this,e);utils.defer(function(){e.fireEvent("contentchange",50)},true)};t.onmouseout=function(){e.fireEvent("tablemouseout",t);$(e,false,"",null);he(e)};t.onclick=function(t){t=e.window.event||t;var i=I(t.target||t.srcElement);if(!i)return;var n=f(i),r=n.table,o=n.getCellInfo(i),a,s=e.selection.getRange();if(P(r,i,t,true)){var l=n.getCell(n.indexTable[n.rowsNum-1][o.colIndex].rowIndex,n.indexTable[n.rowsNum-1][o.colIndex].cellIndex);if(t.shiftKey&&n.selectedTds.length){if(n.selectedTds[0]!==l){a=n.getCellsRange(n.selectedTds[0],l);n.setSelected(a)}else{s&&s.selectNodeContents(l).select()}}else{if(i!==l){a=n.getCellsRange(i,l);n.setSelected(a)}else{s&&s.selectNodeContents(l).select()}}return}if(P(r,i,t)){var d=n.getCell(n.indexTable[o.rowIndex][n.colsNum-1].rowIndex,n.indexTable[o.rowIndex][n.colsNum-1].cellIndex);if(t.shiftKey&&n.selectedTds.length){if(n.selectedTds[0]!==d){a=n.getCellsRange(n.selectedTds[0],d);n.setSelected(a)}else{s&&s.selectNodeContents(d).select()}}else{if(i!==d){a=n.getCellsRange(i,d);n.setSelected(a)}else{s&&s.selectNodeContents(d).select()}}}}});ge(e,true)});domUtils.on(e.document,"mousemove",L);domUtils.on(e.document,"mouseout",function(t){var i=t.target||t.srcElement;if(i.tagName=="TABLE"){$(e,false,"",null)}});e.addListener("interlacetable",function(e,t,i){if(!t)return;var n=this,r=t.rows,o=r.length,a=function(e,t,i){return e[t]?e[t]:i?e[t%e.length]:""};for(var s=0;s<o;s++){r[s].className=a(i||n.options.classList,s,true)}});e.addListener("uninterlacetable",function(e,t){if(!t)return;var i=this,n=t.rows,r=i.options.classList,o=n.length;for(var a=0;a<o;a++){domUtils.removeClasses(n[a],r)}});e.addListener("mousedown",z);e.addListener("mouseup",ee);domUtils.on(e.body,"dragstart",function(t){ee.call(e,"dragstart",t)});e.addOutputRule(function(e){utils.each(e.getNodesByTagName("div"),function(e){if(e.getAttr("id")=="ue_tableDragLine"){e.parentNode.removeChild(e)}})});var o=0;e.addListener("mousedown",function(){o=0});e.addListener("tabkeydown",function(){var t=this.selection.getRange(),i=t.getCommonAncestor(true,true),n=domUtils.findParentByTagName(i,"table");if(n){if(domUtils.findParentByTagName(i,"caption",true)){var r=domUtils.getElementsByTagName(n,"th td");if(r&&r.length){t.setStart(r[0],0).setCursor(false,true)}}else{var r=domUtils.findParentByTagName(i,["td","th"],true),a=f(r);o=r.rowSpan>1?o:a.getCellInfo(r).rowIndex;var s=a.getTabNextCell(r,o);if(s){if(_(s)){t.setStart(s,0).setCursor(false,true)}else{t.selectNodeContents(s).select()}}else{e.fireEvent("saveScene");e.__hasEnterExecCommand=true;this.execCommand("insertrownext");e.__hasEnterExecCommand=false;t=this.selection.getRange();t.setStart(n.rows[n.rows.length-1].cells[0],0).setCursor();e.fireEvent("saveScene")}}return true}});browser.ie&&e.addListener("selectionchange",function(){$(this,false,"",null)});e.addListener("keydown",function(e,t){var i=this;var n=t.keyCode||t.which;if(n==8||n==46){return}var r=!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey;r&&p(domUtils.getElementsByTagName(i.body,"td"));var o=m(i);if(!o)return;r&&o.clearSelected()});e.addListener("beforegetcontent",function(){ge(this,false);browser.ie&&utils.each(this.document.getElementsByTagName("caption"),function(e){if(domUtils.isEmptyNode(e)){e.innerHTML="&nbsp;"}})});e.addListener("aftergetcontent",function(){ge(this,true)});e.addListener("getAllHtml",function(){p(e.document.getElementsByTagName("td"))});e.addListener("fullscreenchanged",function(t,i){if(!i){var n=this.body.offsetWidth/document.body.offsetWidth,r=domUtils.getElementsByTagName(this.body,"table");utils.each(r,function(t){if(t.offsetWidth<e.body.offsetWidth)return false;var i=domUtils.getElementsByTagName(t,"td"),r=[];utils.each(i,function(e){r.push(e.offsetWidth)});for(var o=0,a;a=i[o];o++){a.setAttribute("width",Math.floor(r[o]*n))}t.setAttribute("width",Math.floor(ve(e,T,h(e))))})}});var a=e.execCommand;e.execCommand=function(e,t){var i=this,n=arguments;e=e.toLowerCase();var r=m(i),o,s=new dom.Range(i.document),l=i.commands[e]||UE.commands[e],d;if(!l)return;if(r&&!S[e]&&!l.notNeedUndo&&!i.__hasEnterExecCommand){i.__hasEnterExecCommand=true;i.fireEvent("beforeexeccommand",e);o=r.selectedTds;var u=-2,c=-2,f,h;for(var p=0,g;g=o[p];p++){if(_(g)){s.setStart(g,0).setCursor(false,true)}else{s.selectNode(g).select(true)}h=i.queryCommandState(e);f=i.queryCommandValue(e);if(h!=-1){if(u!==h||c!==f){i._ignoreContentChange=true;d=a.apply(i,arguments);i._ignoreContentChange=false}u=i.queryCommandState(e);c=i.queryCommandValue(e);if(domUtils.isEmptyBlock(g)){domUtils.fillNode(i.document,g)}}}s.setStart(o[0],0).shrinkBoundary(true).setCursor(false,true);i.fireEvent("contentchange");i.fireEvent("afterexeccommand",e);i.__hasEnterExecCommand=false;i._selectionChange()}else{d=a.apply(i,arguments)}return d}});function k(e,t){B(e,"width",true);B(e,"height",true)}function B(e,t,i){if(e.style[t]){i&&e.setAttribute(t,parseInt(e.style[t],10));e.style[t]=""}}function I(e){if(e.tagName=="TD"||e.tagName=="TH")return e;var t;if(t=domUtils.findParentByTagName(e,"td",true)||domUtils.findParentByTagName(e,"th",true))return t;return null}function _(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0){return 0}for(var i in dtd.$isNotEmpty){if(e.getElementsByTagName(i).length){return 0}}return 1}function R(t){if(t.pageX||t.pageY){return{x:t.pageX,y:t.pageY}}return{x:t.clientX+e.document.body.scrollLeft-e.document.body.clientLeft,y:t.clientY+e.document.body.scrollTop-e.document.body.clientTop}}function L(t){if(oe()){return}try{var i=I(t.target||t.srcElement),n;if(o){e.body.style.webkitUserSelect="none";if(Math.abs(d.x-t.clientX)>s||Math.abs(d.y-t.clientY)>s){J();o=false;l=0;Z(t)}}if(y&&U){l=0;e.body.style.webkitUserSelect="none";e.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();n=R(t);$(e,true,y,n,i);if(y=="h"){x.style.left=M(U,t)+"px"}else if(y=="v"){x.style.top=H(U,t)+"px"}return}if(i){if(e.fireEvent("excludetable",i)===true)return;n=R(t);var r=W(i,n),a=domUtils.findParentByTagName(i,"table",true);if(P(a,i,t,true)){if(e.fireEvent("excludetable",a)===true)return;e.body.style.cursor="url("+e.options.cursorpath+"h.png),pointer"}else if(P(a,i,t)){if(e.fireEvent("excludetable",a)===true)return;e.body.style.cursor="url("+e.options.cursorpath+"v.png),pointer"}else{e.body.style.cursor="text";var u=i;if(/\d/.test(r)){r=r.replace(/\d/,"");i=f(i).getPreviewCell(i,r=="v")}$(e,i?!!r:false,i?r:"",n,i)}}else{D(false,a,e)}}catch(e){g(e)}}var A;function D(e,t,i){if(!e){if(N)return;A=setTimeout(function(){!N&&w&&w.parentNode&&w.parentNode.removeChild(w)},2e3)}else{O(t,i)}}function O(e,t){var i=domUtils.getXY(e),n=e.ownerDocument;if(w&&w.parentNode)return w;w=n.createElement("div");w.contentEditable=false;w.innerHTML="";w.style.cssText="width:15px;height:15px;background-image:url("+t.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(i.y-15)+"px;left:"+i.x+"px;";domUtils.unSelectable(w);w.onmouseover=function(e){N=true};w.onmouseout=function(e){N=false};domUtils.on(w,"click",function(e,t){o(t,this)});domUtils.on(w,"dblclick",function(e,t){a(t)});domUtils.on(w,"dragstart",function(e,t){domUtils.preventDefault(t)});var r;function o(i,n){clearTimeout(r);r=setTimeout(function(){t.fireEvent("tableClicked",e,n)},300)}function a(i){clearTimeout(r);var n=f(e),o=e.rows[0].cells[0],a=n.getLastCell(),s=n.getCellsRange(o,a);t.selection.getRange().setStart(o,0).setCursor(false,true);n.setSelected(s)}n.body.appendChild(w)}function P(e,t,i,n){var r=R(i),o=W(t,r);if(n){var a=e.getElementsByTagName("caption")[0],s=a?a.offsetHeight:0;return o=="v1"&&r.y-domUtils.getXY(e).y-s<8}else{return o=="h1"&&r.x-domUtils.getXY(e).x<8}}function M(t,i){var n=f(t);if(n){var o=n.getSameEndPosCells(t,"x")[0],a=n.getSameStartPosXCells(t)[0],s=R(i).x,l=(o?domUtils.getXY(o).x:domUtils.getXY(n.table).x)+20,d=a?domUtils.getXY(a).x+a.offsetWidth-20:e.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(e.body,"width"),10);l+=r;d-=r;return s<l?l:s>d?d:s}}function H(e,t){try{var i=domUtils.getXY(e).y,n=R(t).y;return n<i?i:n}catch(e){g(e)}}function $(e,t,i,n,r){try{e.body.style.cursor=i=="h"?"col-resize":i=="v"?"row-resize":"text";if(browser.ie){if(i&&!E&&!m(e)){me(e,e.document);pe(i,r)}else{he(e)}}C=t}catch(e){g(e)}}function F(){var e="_UETableResizeLine",t=this.document.getElementById(e);if(!t){t=this.document.createElement("div");t.id=e;t.contnetEditable=false;t.setAttribute("unselectable","on");var i={width:2*a+1+"px",position:"absolute","z-index":1e5,cursor:"col-resize",background:"red",display:"none"};t.onmouseout=function(){this.style.display="none"};utils.extend(t.style,i);this.document.body.appendChild(t)}return t}function q(e,t){var i=F.call(this),n=t.table,r={top:domUtils.getXY(n).y+"px",left:domUtils.getXY(e).x+e.offsetWidth-a+"px",display:"block",height:n.offsetHeight+"px"};utils.extend(i.style,r)}function V(e){var t=f(e);q.call(this,e,t)}function W(e,t){var i=domUtils.getXY(e);if(!i){return""}if(i.x+e.offsetWidth-t.x<a){return"h"}if(t.x-i.x<a){return"h1"}if(i.y+e.offsetHeight-t.y<a){return"v"}if(t.y-i.y<a){return"v1"}return""}function z(t,i){if(oe()){return}d={x:i.clientX,y:i.clientY};if(i.button==2){var n=m(e),r=false;if(n){var o=be(e,i);utils.each(n.selectedTds,function(e){if(e===o){r=true}});if(!r){p(domUtils.getElementsByTagName(e.body,"th td"));n.clearSelected()}else{o=n.selectedTds[0];setTimeout(function(){e.selection.getRange().setStart(o,0).setCursor(false,true)},0)}}}else{Y(i)}}function j(){t&&clearTimeout(t);t=null}function X(t){l=0;t=t||e.window.event;var i=I(t.target||t.srcElement);if(i){var n;if(n=W(i,R(t))){he(e);if(n=="h1"){n="h";if(P(domUtils.findParentByTagName(i,"table"),i,t)){e.execCommand("adaptbywindow")}else{i=f(i).getPreviewCell(i);if(i){var r=e.selection.getRange();r.selectNodeContents(i).setCursor(true,true)}}}if(n=="h"){var o=f(i),a=o.table,s=se(i,a,true);s=G(s,"left");o.width=o.offsetWidth;var d=[],u=[];utils.each(s,function(e){d.push(e.offsetWidth)});utils.each(s,function(e){e.removeAttribute("width")});window.setTimeout(function(){var e=true;utils.each(s,function(t,i){var n=t.offsetWidth;if(n>d[i]){e=false;return false}u.push(n)});var t=e?u:d;utils.each(s,function(e,i){e.width=t[i]-fe()})},0)}}}}function Y(t){p(domUtils.getElementsByTagName(e.body,"td th"));utils.each(e.document.getElementsByTagName("table"),function(e){e.ueTable=null});v=be(e,t);if(!v)return;var i=domUtils.findParentByTagName(v,"table",true);ut=f(i);ut&&ut.clearSelected();if(!C){e.document.body.style.webkitUserSelect="";E=true;e.addListener("mouseover",te)}else{K(t)}}function K(e){if(browser.ie){e=Q(e)}J();o=true;i=setTimeout(function(){Z(e)},u)}function G(e,t){var i=[],n=null;for(var r=0,o=e.length;r<o;r++){n=e[r][t];if(n){i.push(n)}}return i}function J(){i&&clearTimeout(i);i=null}function Q(e){var t=["pageX","pageY","clientX","clientY","srcElement","target"],i={};if(e){for(var n=0,r,o;r=t[n];n++){o=e[r];o&&(i[r]=o)}}return i}function Z(t){o=false;v=t.target||t.srcElement;if(!v)return;var i=W(v,R(t));if(/\d/.test(i)){i=i.replace(/\d/,"");v=f(v).getPreviewCell(v,i=="v")}he(e);me(e,e.document);e.fireEvent("saveScene");pe(i,v);E=true;y=i;U=v}function ee(e,t){if(oe()){return}J();o=false;if(C){l=++l%3;d={x:t.clientX,y:t.clientY};n=setTimeout(function(){l>0&&l--},u);if(l===2){l=0;X(t);return}}if(t.button==2)return;var i=this;var r=i.selection.getRange(),a=domUtils.findParentByTagName(r.startContainer,"table",true),s=domUtils.findParentByTagName(r.endContainer,"table",true);if(a||s){if(a===s){a=domUtils.findParentByTagName(r.startContainer,["td","th","caption"],true);s=domUtils.findParentByTagName(r.endContainer,["td","th","caption"],true);if(a!==s){i.selection.clearRange()}}else{i.selection.clearRange()}}E=false;i.document.body.style.webkitUserSelect="";if(y&&U){i.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();l=0;x=i.document.getElementById("ue_tableDragLine");if(x){var c=domUtils.getXY(U),m=domUtils.getXY(x);switch(y){case"h":re(U,m.x-c.x);break;case"v":ae(U,m.y-c.y-U.offsetHeight);break;default:}y="";U=null;he(i);i.fireEvent("saveScene");return}}if(!v){var h=domUtils.findParentByTagName(t.target||t.srcElement,"td",true);if(!h)h=domUtils.findParentByTagName(t.target||t.srcElement,"th",true);if(h&&(h.tagName=="TD"||h.tagName=="TH")){if(i.fireEvent("excludetable",h)===true)return;r=new dom.Range(i.document);r.setStart(h,0).setCursor(false,true)}}else{var p=f(v),g=p?p.selectedTds[0]:null;if(g){r=new dom.Range(i.document);if(domUtils.isEmptyBlock(g)){r.setStart(g,0).setCursor(false,true)}else{r.selectNodeContents(g).shrinkBoundary().setCursor(false,true)}}else{r=i.selection.getRange().shrinkBoundary();if(!r.collapsed){var a=domUtils.findParentByTagName(r.startContainer,["td","th"],true),s=domUtils.findParentByTagName(r.endContainer,["td","th"],true);if(a&&!s||!a&&s||a&&s&&a!==s){r.setCursor(false,true)}}}v=null;i.removeListener("mouseover",te)}i._selectionChange(250,t)}function te(e,t){if(oe()){return}var i=this,n=t.target||t.srcElement;b=domUtils.findParentByTagName(n,"td",true)||domUtils.findParentByTagName(n,"th",true);if(v&&b&&(v.tagName=="TD"&&b.tagName=="TD"||v.tagName=="TH"&&b.tagName=="TH")&&domUtils.findParentByTagName(v,"table")==domUtils.findParentByTagName(b,"table")){var r=f(b);if(v!=b){i.document.body.style.webkitUserSelect="none";i.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();var o=r.getCellsRange(v,b);r.setSelected(o)}else{i.document.body.style.webkitUserSelect="";r.clearSelected()}}t.preventDefault?t.preventDefault():t.returnValue=false}function ie(e,t,i){var n=parseInt(domUtils.getComputedStyle(e,"line-height"),10),r=i+t;t=r<n?n:r;if(e.style.height)e.style.height="";e.rowSpan==1?e.setAttribute("height",t):e.removeAttribute&&e.removeAttribute("height")}function ne(e){if(!e)return 0;return parseInt(domUtils.getComputedStyle(e,"width"),10)}function re(e,t){var i=f(e);if(i){var n=i.table,r=se(e,n);n.style.width="";n.removeAttribute("width");t=de(t,e,r);if(e.nextSibling){var o=0;utils.each(r,function(e){e.left.width=+e.left.width+t;e.right&&(e.right.width=+e.right.width-t)})}else{utils.each(r,function(e){e.left.width-=-t})}}}function oe(){return e.body.contentEditable==="false"}function ae(e,t){if(Math.abs(t)<10)return;var i=f(e);if(i){var n=i.getSameEndPosCells(e,"y"),r=n[0]?n[0].offsetHeight:0;for(var o=0,a;a=n[o++];){ie(a,t,r)}}}function se(e,t,i){if(!t){t=domUtils.findParentByTagName(e,"table")}if(!t){return null}var n=domUtils.getNodeIndex(e),r=e,o=t.rows,a=0;while(r){if(r.nodeType===1){a+=r.colSpan||1}r=r.previousSibling}r=null;var s=[];utils.each(o,function(e){var t=e.cells,n=0;utils.each(t,function(e){n+=e.colSpan||1;if(n===a){s.push({left:e,right:e.nextSibling||null});return false}else if(n>a){if(i){s.push({left:e})}return false}})});return s}function le(e){var t=Number.MAX_VALUE;for(var i=0,n;n=e[i];i++){t=Math.min(t,n.width||ue(n))}return t}function de(e,t,i){e-=fe();if(e<0){return 0}e-=ue(t);var n=e<0?"left":"right";e=Math.abs(e);utils.each(i,function(t){var i=t[n];if(i){e=Math.min(e,ue(i)-r)}});e=e<0?0:e;return n==="left"?-e:e}function ue(e){var t=0,i=0,t=e.offsetWidth-fe();if(!e.nextSibling){t-=ce(e)}t=t<0?0:t;try{e.width=t}catch(e){}return t}function ce(e){tab=domUtils.findParentByTagName(e,"table",false);if(tab.offsetVal===undefined){var t=e.previousSibling;if(t){tab.offsetVal=e.offsetWidth-t.offsetWidth===c.borderWidth?c.borderWidth:0}else{tab.offsetVal=0}}return tab.offsetVal}function fe(){if(c.tabcellSpace===undefined){var t=null,i=e.document.createElement("table"),n=e.document.createElement("tbody"),r=e.document.createElement("tr"),o=e.document.createElement("td"),a=null;o.style.cssText="border: 0;";o.width=1;r.appendChild(o);r.appendChild(a=o.cloneNode(false));n.appendChild(r);i.appendChild(n);i.style.cssText="visibility: hidden;";e.body.appendChild(i);c.paddingSpace=o.offsetWidth-1;var s=i.offsetWidth;o.style.cssText="";a.style.cssText="";c.borderWidth=(i.offsetWidth-s)/3;c.tabcellSpace=c.paddingSpace+c.borderWidth;e.body.removeChild(i)}fe=function(){return c.tabcellSpace};return c.tabcellSpace}function me(e,t){if(E)return;x=e.document.createElement("div");domUtils.setAttributes(x,{id:"ue_tableDragLine",unselectable:"on",contenteditable:false,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"});e.body.appendChild(x)}function he(e){if(E)return;var t;while(t=e.document.getElementById("ue_tableDragLine")){domUtils.remove(t)}}function pe(e,t){if(!t)return;var i=domUtils.findParentByTagName(t,"table"),n=i.getElementsByTagName("caption"),r=i.offsetWidth,o=i.offsetHeight-(n.length>0?n[0].offsetHeight:0),a=domUtils.getXY(i),s=domUtils.getXY(t),l;switch(e){case"h":l="height:"+o+"px;top:"+(a.y+(n.length>0?n[0].offsetHeight:0))+"px;left:"+(s.x+t.offsetWidth);x.style.cssText=l+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":l="width:"+r+"px;left:"+a.x+"px;top:"+(s.y+t.offsetHeight);x.style.cssText=l+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)";break;default:}}function ge(e,t){var i=domUtils.getElementsByTagName(e.body,"table"),n;for(var r=0,o;o=i[r++];){var a=domUtils.getElementsByTagName(o,"td");if(a[0]){if(t){n=a[0].style.borderColor.replace(/\s/g,"");if(/(#ffffff)|(rgb\(255,255,255\))/gi.test(n))domUtils.addClass(o,"noBorderTable")}else{domUtils.removeClasses(o,"noBorderTable")}}}}function ve(e,t,i){var n=e.body;return n.offsetWidth-(t?parseInt(domUtils.getComputedStyle(n,"margin-left"),10)*2:0)-i.tableBorder*2-(e.options.offsetWidth||0)}function be(e,t){var i=domUtils.findParentByTagName(t.target||t.srcElement,["td","th"],true),n=null;if(!i){return null}n=W(i,R(t));if(!i){return null}if(n==="h1"&&i.previousSibling){var r=domUtils.getXY(i),o=i.offsetWidth;if(Math.abs(r.x+o-t.clientX)>o/3){i=i.previousSibling}}else if(n==="v1"&&i.parentNode.previousSibling){var r=domUtils.getXY(i),a=i.offsetHeight;if(Math.abs(r.y+a-t.clientY)>a/3){i=i.parentNode.previousSibling.firstChild}}return i&&!(e.fireEvent("excludetable",i)===true)?i:null}};UE.plugins["contextmenu"]=function(){var e=this;e.setOpt("enableContextMenu",true);if(e.getOpt("enableContextMenu")===false){return}var t=e.getLang("contextMenu"),i,n=e.options.contextMenu||[{label:t["selectall"],cmdName:"selectall"},{label:t.unlink,cmdName:"unlink"},{group:t.paragraph,icon:"justifyjustify",subMenu:[{label:t.justifyleft,cmdName:"justify",value:"left"},{label:t.justifyright,cmdName:"justify",value:"right"},{label:t.justifycenter,cmdName:"justify",value:"center"}]},{group:t.table,icon:"table",subMenu:[{label:t.inserttable,cmdName:"inserttable"},{label:t.deletetable,cmdName:"deletetable"},"-",{label:t.deleterow,cmdName:"deleterow"},{label:t.deletecol,cmdName:"deletecol"},{label:t.insertcol,cmdName:"insertcol"},{label:t.insertcolnext,cmdName:"insertcolnext"},{label:t.insertrow,cmdName:"insertrow"},{label:t.insertrownext,cmdName:"insertrownext"},"-",{label:t.insertcaption,cmdName:"insertcaption"},{label:t.deletecaption,cmdName:"deletecaption"},{label:t.inserttitle,cmdName:"inserttitle"},{label:t.deletetitle,cmdName:"deletetitle"},{label:t.inserttitlecol,cmdName:"inserttitlecol"},{label:t.deletetitlecol,cmdName:"deletetitlecol"},"-",{label:t.mergecells,cmdName:"mergecells"},{label:t.mergeright,cmdName:"mergeright"},{label:t.mergedown,cmdName:"mergedown"},"-",{label:t.splittorows,cmdName:"splittorows"},{label:t.splittocols,cmdName:"splittocols"},{label:t.splittocells,cmdName:"splittocells"},"-",{label:t.averageDiseRow,cmdName:"averagedistributerow"},{label:t.averageDisCol,cmdName:"averagedistributecol"},"-",{label:t.edittd,cmdName:"edittd",exec:function(){if(UE.ui["edittd"]){new UE.ui["edittd"](this)}this.getDialog("edittd").open()}},{label:t.edittable,cmdName:"edittable",exec:function(){if(UE.ui["edittable"]){new UE.ui["edittable"](this)}this.getDialog("edittable").open()}},{label:t.setbordervisible,cmdName:"setbordervisible"}]},{group:t.borderbk,icon:"borderBack",subMenu:[{label:t.setcolor,cmdName:"interlacetable",exec:function(){this.execCommand("interlacetable")}},{label:t.unsetcolor,cmdName:"uninterlacetable",exec:function(){this.execCommand("uninterlacetable")}},{label:t.setbackground,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["#bbb","#ccc"]})}},{label:t.unsetbackground,cmdName:"cleartablebackground",exec:function(){this.execCommand("cleartablebackground")}},{label:t.redandblue,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["red","blue"]})}},{label:t.threecolorgradient,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["#aaa","#bbb","#ccc"]})}}]},{group:t.aligntd,icon:"aligntd",subMenu:[{cmdName:"cellalignment",value:{align:"left",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"bottom"}}]},{group:t.aligntable,icon:"aligntable",subMenu:[{cmdName:"tablealignment",className:"left",label:t.tableleft,value:"left"},{cmdName:"tablealignment",className:"center",label:t.tablecenter,value:"center"},{cmdName:"tablealignment",className:"right",label:t.tableright,value:"right"}]},"-",{label:t.insertparagraphbefore,cmdName:"insertparagraph",value:true},{label:t.insertparagraphafter,cmdName:"insertparagraph"},{label:t["copy"],cmdName:"copy"},{label:t["paste"],cmdName:"paste"}];if(!n.length){return}var r=UE.ui.uiUtils;e.addListener("contextmenu",function(o,a){var s=r.getViewportOffsetByEvent(a);e.fireEvent("beforeselectionchange");if(i){i.destroy()}for(var l=0,d,u=[];d=n[l];l++){var c;(function(i){if(i=="-"){if((c=u[u.length-1])&&c!=="-"){u.push("-")}}else if(i.hasOwnProperty("group")){for(var n=0,r,o=[];r=i.subMenu[n];n++){(function(t){if(t=="-"){if((c=o[o.length-1])&&c!=="-"){o.push("-")}else{o.splice(o.length-1)}}else{if((e.commands[t.cmdName]||UE.commands[t.cmdName]||t.query)&&(t.query?t.query():e.queryCommandState(t.cmdName))>-1){o.push({label:t.label||e.getLang("contextMenu."+t.cmdName+(t.value||""))||"",className:"edui-for-"+t.cmdName+(t.className?" edui-for-"+t.cmdName+"-"+t.className:""),onclick:t.exec?function(){t.exec.call(e)}:function(){e.execCommand(t.cmdName,t.value)}})}}})(r)}if(o.length){function a(){switch(i.icon){case"table":return e.getLang("contextMenu.table");case"justifyjustify":return e.getLang("contextMenu.paragraph");case"aligntd":return e.getLang("contextMenu.aligntd");case"aligntable":return e.getLang("contextMenu.aligntable");case"tablesort":return t.tablesort;case"borderBack":return t.borderbk;default:return""}}u.push({label:a(),className:"edui-for-"+i.icon,subMenu:{items:o,editor:e}})}}else{if((e.commands[i.cmdName]||UE.commands[i.cmdName]||i.query)&&(i.query?i.query.call(e):e.queryCommandState(i.cmdName))>-1){u.push({label:i.label||e.getLang("contextMenu."+i.cmdName),className:"edui-for-"+(i.icon?i.icon:i.cmdName+(i.value||"")),onclick:i.exec?function(){i.exec.call(e)}:function(){e.execCommand(i.cmdName,i.value)}})}}})(d)}if(u[u.length-1]=="-"){u.pop()}i=new UE.ui.Menu({items:u,className:"edui-contextmenu",editor:e});i.render();i.showAt(s);e.fireEvent("aftershowcontextmenu",i);domUtils.preventDefault(a);if(browser.ie){var f;try{f=e.selection.getNative().createRange()}catch(e){return}if(f.item){var m=new dom.Range(e.document);m.selectNode(f.item(0)).select(true,true)}}});e.addListener("aftershowcontextmenu",function(t,i){if(e.zeroclipboard){var n=i.items;for(var r in n){if(n[r].className=="edui-for-copy"){e.zeroclipboard.clip(n[r].getDom())}}}})};UE.plugins["basestyle"]=function(){var e={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},t=function(e,t){return domUtils.filterNodeList(e.selection.getStartElementPath(),t)},i=this;i.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"});i.addInputRule(function(e){utils.each(e.getNodesByTagName("b i"),function(e){switch(e.tagName){case"b":e.tagName="strong";break;case"i":e.tagName="em"}})});for(var n in e){(function(e,n){i.commands[e]={execCommand:function(e){
var r=i.selection.getRange(),o=t(this,n);if(r.collapsed){if(o){var a=i.document.createTextNode("");r.insertNode(a).removeInlineStyle(n);r.setStartBefore(a);domUtils.remove(a)}else{var s=r.document.createElement(n[0]);if(e=="superscript"||e=="subscript"){a=i.document.createTextNode("");r.insertNode(a).removeInlineStyle(["sub","sup"]).setStartBefore(a).collapse(true)}r.insertNode(s).setStart(s,0)}r.collapse(true)}else{if(e=="superscript"||e=="subscript"){if(!o||o.tagName.toLowerCase()!=e){r.removeInlineStyle(["sub","sup"])}}o?r.removeInlineStyle(n):r.applyInlineStyle(n[0])}r.select()},queryCommandState:function(){return t(this,n)?1:0}}})(n,e[n])}};UE.plugins["customstyle"]=function(){var e=this;e.setOpt({customstyle:[{tag:"h1",name:"tc",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;"},{tag:"h1",name:"tl",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;"},{tag:"span",name:"im",style:"font-size:16px;font-style:italic;font-weight:bold;line-height:18px;"},{tag:"span",name:"hi",style:"font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;"}]});e.commands["customstyle"]={execCommand:function(e,t){var i=this,n=t.tag,r=domUtils.findParent(i.selection.getStart(),function(e){return e.getAttribute("label")},true),o,a,s={};for(var l in t){if(t[l]!==undefined)s[l]=t[l]}delete s.tag;if(r&&r.getAttribute("label")==t.label){o=this.selection.getRange();a=o.createBookmark();if(o.collapsed){if(dtd.$block[r.tagName]){var d=i.document.createElement("p");domUtils.moveChild(r,d);r.parentNode.insertBefore(d,r);domUtils.remove(r)}else{domUtils.remove(r,true)}}else{var u=domUtils.getCommonAncestor(a.start,a.end),c=domUtils.getElementsByTagName(u,n);if(new RegExp(n,"i").test(u.tagName)){c.push(u)}for(var f=0,m;m=c[f++];){if(m.getAttribute("label")==t.label){var h=domUtils.getPosition(m,a.start),p=domUtils.getPosition(m,a.end);if((h&domUtils.POSITION_FOLLOWING||h&domUtils.POSITION_CONTAINS)&&(p&domUtils.POSITION_PRECEDING||p&domUtils.POSITION_CONTAINS))if(dtd.$block[n]){var d=i.document.createElement("p");domUtils.moveChild(m,d);m.parentNode.insertBefore(d,m)}domUtils.remove(m,true)}}r=domUtils.findParent(u,function(e){return e.getAttribute("label")==t.label},true);if(r){domUtils.remove(r,true)}}o.moveToBookmark(a).select()}else{if(dtd.$block[n]){this.execCommand("paragraph",n,s,"customstyle");o=i.selection.getRange();if(!o.collapsed){o.collapse();r=domUtils.findParent(i.selection.getStart(),function(e){return e.getAttribute("label")==t.label},true);var g=i.document.createElement("p");domUtils.insertAfter(r,g);domUtils.fillNode(i.document,g);o.setStart(g,0).setCursor()}}else{o=i.selection.getRange();if(o.collapsed){r=i.document.createElement(n);domUtils.setAttributes(r,s);o.insertNode(r).setStart(r,0).setCursor();return}a=o.createBookmark();o.applyInlineStyle(n,s).moveToBookmark(a).select()}}},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return e.getAttribute("label")});return e?e.getAttribute("label"):""}};e.addListener("keyup",function(t,i){var n=i.keyCode||i.which;if(n==32||n==13){var r=e.selection.getRange();if(r.collapsed){var o=domUtils.findParent(e.selection.getStart(),function(e){return e.getAttribute("label")},true);if(o&&dtd.$block[o.tagName]&&domUtils.isEmptyNode(o)){var a=e.document.createElement("p");domUtils.insertAfter(o,a);domUtils.fillNode(e.document,a);domUtils.remove(o);r.setStart(a,0).setCursor()}}}})};UE.plugins["catchremoteimage"]=function(){var me=this,ajax=UE.ajax;if(me.options.catchRemoteImageEnable===false)return;me.setOpt({catchRemoteImageEnable:false});me.addListener("afterpaste",function(){me.fireEvent("catchRemoteImage")});me.addListener("catchRemoteImage",function(){var catcherLocalDomain=me.getOpt("catcherLocalDomain"),catcherActionUrl=me.getActionUrl(me.getOpt("catcherActionName")),catcherUrlPrefix=me.getOpt("catcherUrlPrefix"),catcherFieldName=me.getOpt("catcherFieldName");var remoteImages=[],imgs=domUtils.getElementsByTagName(me.document,"img"),test=function(e,t){if(e.indexOf(location.host)!=-1||/(^\.)|(^\/)/.test(e)){return true}if(t){for(var i=0,n;n=t[i++];){if(e.indexOf(n)!==-1){return true}}}return false};for(var i=0,ci;ci=imgs[i++];){if(ci.getAttribute("word_img")){continue}var src=ci.getAttribute("_src")||ci.src||"";if(/^(https?|ftp):/i.test(src)&&!test(src,catcherLocalDomain)){remoteImages.push(src)}}if(remoteImages.length){catchremoteimage(remoteImages,{success:function(r){try{var info=r.state!==undefined?r:eval("("+r.responseText+")")}catch(e){return}var i,j,ci,cj,oldSrc,newSrc,list=info.list;for(i=0;ci=imgs[i++];){oldSrc=ci.getAttribute("_src")||ci.src||"";for(j=0;cj=list[j++];){if(oldSrc==cj.source&&cj.state=="SUCCESS"){newSrc=catcherUrlPrefix+cj.url;domUtils.setAttributes(ci,{src:newSrc,_src:newSrc});break}}}me.fireEvent("catchremotesuccess")},error:function(){me.fireEvent("catchremoteerror")}})}function catchremoteimage(e,t){var i=utils.serializeParam(me.queryCommandValue("serverparam"))||"",n=utils.formatUrl(catcherActionUrl+(catcherActionUrl.indexOf("?")==-1?"?":"&")+i),r=utils.isCrossDomainUrl(n),o={method:"POST",dataType:r?"jsonp":"",timeout:6e4,onsuccess:t["success"],onerror:t["error"]};o[catcherFieldName]=e;ajax.request(n,o)}})};UE.commands["insertparagraph"]={execCommand:function(e,t){var i=this,n=i.selection.getRange(),r=n.startContainer,o;while(r){if(domUtils.isBody(r)){break}o=r;r=r.parentNode}if(o){var a=i.document.createElement("p");if(t){o.parentNode.insertBefore(a,o)}else{o.parentNode.insertBefore(a,o.nextSibling)}domUtils.fillNode(i.document,a);n.setStart(a,0).setCursor(false,true)}}};UE.commands["insertpbefore"]={execCommand:function(e){this.execCommand("insertparagraph",true)}};UE.commands["insertpafter"]={execCommand:function(e){this.execCommand("insertparagraph")}};UE.plugin.register("autoupload",function(){function e(e,t){var i=t;var n,r,o,a,s,l,d,u,c=/image\/\w+/i.test(e.type)?"image":"file",f="loading_"+(+new Date).toString(36);n=i.getOpt(c+"FieldName");r=i.getOpt(c+"UrlPrefix");o=i.getOpt(c+"MaxSize");a=i.getOpt(c+"AllowFiles");s=i.getActionUrl(i.getOpt(c+"ActionName"));d=function(e){var t=i.document.getElementById(f);t&&domUtils.remove(t);i.fireEvent("showmessage",{id:f,content:e,type:"error",timeout:4e3})};if(c=="image"){l='<img class="loadingclass" id="'+f+'" src="'+i.options.themePath+i.options.theme+'/images/spacer.gif" title="'+(i.getLang("autoupload.loading")||"")+'" >';u=function(e){var t=r+e.url,n=i.document.getElementById(f);if(n){n.setAttribute("src",t);n.setAttribute("_src",t);n.setAttribute("title",e.title||"");n.setAttribute("alt",e.original||"");n.removeAttribute("id");domUtils.removeClasses(n,"loadingclass")}}}else{l="<p>"+'<img class="loadingclass" id="'+f+'" src="'+i.options.themePath+i.options.theme+'/images/spacer.gif" title="'+(i.getLang("autoupload.loading")||"")+'" >'+"</p>";u=function(e){var t=r+e.url,n=i.document.getElementById(f);var o=i.selection.getRange(),a=o.createBookmark();o.selectNode(n).select();i.execCommand("insertfile",{url:t});o.moveToBookmark(a).select()}}i.execCommand("inserthtml",l);if(!i.getOpt(c+"ActionName")){d(i.getLang("autoupload.errorLoadConfig"));return}if(e.size>o){d(i.getLang("autoupload.exceedSizeError"));return}var m=e.name?e.name.substr(e.name.lastIndexOf(".")):"";if(m&&c!="image"||a&&(a.join("")+".").indexOf(m.toLowerCase()+".")==-1){d(i.getLang("autoupload.exceedTypeError"));return}var h=new XMLHttpRequest,p=new FormData,g=utils.serializeParam(i.queryCommandValue("serverparam"))||"",v=utils.formatUrl(s+(s.indexOf("?")==-1?"?":"&")+g);p.append(n,e,e.name||"blob."+e.type.substr("image/".length));p.append("type","ajax");h.open("post",v,true);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.addEventListener("load",function(e){try{var t=new Function("return "+utils.trim(e.target.response))();if(t.state=="SUCCESS"&&t.url){u(t)}else{d(t.state)}}catch(e){d(i.getLang("autoupload.loadError"))}});h.send(p)}function t(e){return e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length==1&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function i(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}return{outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){if(/\b(loaderrorclass)|(bloaderrorclass)\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}});utils.each(e.getNodesByTagName("p"),function(e){if(/\bloadpara\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}})},bindEvents:{ready:function(n){var r=this;if(window.FormData&&window.FileReader){domUtils.on(r.body,"paste drop",function(n){var o=false,a;a=n.type=="paste"?t(n):i(n);if(a){var s=a.length,l;while(s--){l=a[s];if(l.getAsFile)l=l.getAsFile();if(l&&l.size>0){e(l,r);o=true}}o&&n.preventDefault()}});domUtils.on(r.body,"dragover",function(e){if(e.dataTransfer.types[0]=="Files"){e.preventDefault()}});utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\n"+".loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;"+"}",this.document)}}}}});UE.plugin.register("simpleupload",function(){var e=this,t=false,i;function n(){var n=i.offsetWidth||20,r=i.offsetHeight||20,o=document.createElement("iframe"),a="display:block;width:"+n+"px;height:"+r+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";domUtils.on(o,"load",function(){var i=(+new Date).toString(36),s,l,d;l=o.contentDocument||o.contentWindow.document;d=l.body;s=l.createElement("div");s.innerHTML='<form id="edui_form_'+i+'" target="edui_iframe_'+i+'" method="POST" enctype="multipart/form-data" action="'+e.getOpt("serverUrl")+'" '+'style="'+a+'">'+'<input id="edui_input_'+i+'" type="file" accept="image/*" name="'+e.options.imageFieldName+'" '+'style="'+a+'">'+"</form>"+'<iframe id="edui_iframe_'+i+'" name="edui_iframe_'+i+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>';s.className="edui-"+e.options.theme;s.id=e.ui.id+"_iframeupload";d.style.cssText=a;d.style.width=n+"px";d.style.height=r+"px";d.appendChild(s);if(d.parentNode){d.parentNode.style.width=n+"px";d.parentNode.style.height=n+"px"}var u=l.getElementById("edui_form_"+i);var c=l.getElementById("edui_input_"+i);var f=l.getElementById("edui_iframe_"+i);domUtils.on(c,"change",function(){if(!c.value)return;var t="loading_"+(+new Date).toString(36);var i=utils.serializeParam(e.queryCommandValue("serverparam"))||"";var n=e.getActionUrl(e.getOpt("imageActionName"));var r=e.getOpt("imageAllowFiles");e.focus();e.execCommand("inserthtml",'<img class="loadingclass" id="'+t+'" src="'+e.options.themePath+e.options.theme+'/images/spacer.gif" title="'+(e.getLang("simpleupload.loading")||"")+'" >');function o(){try{var i,n,r,s=(f.contentDocument||f.contentWindow.document).body,l=s.innerText||s.textContent||"";n=new Function("return "+l)();i=e.options.imageUrlPrefix+n.url;if(n.state=="SUCCESS"&&n.url){r=e.document.getElementById(t);r.setAttribute("src",i);r.setAttribute("_src",i);r.setAttribute("title",n.title||"");r.setAttribute("alt",n.original||"");r.removeAttribute("id");domUtils.removeClasses(r,"loadingclass")}else{a&&a(n.state)}}catch(t){a&&a(e.getLang("simpleupload.loadError"))}u.reset();domUtils.un(f,"load",o)}function a(i){if(t){var n=e.document.getElementById(t);n&&domUtils.remove(n);e.fireEvent("showmessage",{id:t,content:i,type:"error",timeout:4e3})}}if(!e.getOpt("imageActionName")){errorHandler(e.getLang("autoupload.errorLoadConfig"));return}var s=c.value,l=s?s.substr(s.lastIndexOf(".")):"";if(!l||r&&(r.join("")+".").indexOf(l.toLowerCase()+".")==-1){a(e.getLang("simpleupload.exceedTypeError"));return}domUtils.on(f,"load",o);u.action=utils.formatUrl(n+(n.indexOf("?")==-1?"?":"&")+i);u.submit()});var m;e.addListener("selectionchange",function(){clearTimeout(m);m=setTimeout(function(){var t=e.queryCommandState("simpleupload");if(t==-1){c.disabled="disabled"}else{c.disabled=false}},400)});t=true});o.style.cssText=a;i.appendChild(o)}return{bindEvents:{ready:function(){utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n"+".loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;"+"}",this.document)},simpleuploadbtnready:function(t,r){i=r;e.afterConfigReady(n)}},outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){if(/\b(loaderrorclass)|(bloaderrorclass)\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}})},commands:{simpleupload:{queryCommandState:function(){return t?0:-1}}}}});UE.plugin.register("serverparam",function(){var e=this,t={};return{commands:{serverparam:{execCommand:function(e,i,n){if(i===undefined||i===null){t={}}else if(utils.isString(i)){if(n===undefined||n===null){delete t[i]}else{t[i]=n}}else if(utils.isObject(i)){utils.extend(t,i,true)}else if(utils.isFunction(i)){utils.extend(t,i(),true)}},queryCommandValue:function(){return t||{}}}}}});UE.plugin.register("insertfile",function(){var e=this;return{commands:{insertfile:{execCommand:function(t,i){i=utils.isArray(i)?i:[i];var n,r,o,a,s="";for(n=0;n<i.length;n++){r=i[n];a=r.title||r.url.substr(r.url.lastIndexOf("/")+1);s+="<p>[download="+r.id+"]"+a+"[/download]</p>"}e.execCommand("insertHtml",s)}}}}});UE.plugins.xssFilter=function(){var e=UEDITOR_CONFIG;var t=e.whitList;function i(e){var i=e.tagName;var n=e.attrs;if(!t.hasOwnProperty(i)){e.parentNode.removeChild(e);return false}UE.utils.each(n,function(n,r){if(t[i].indexOf(r)===-1){e.setAttr(r)}})}if(t&&e.xssFilterRules){this.options.filterRules=function(){var e={};UE.utils.each(t,function(t,n){e[n]=function(e){return i(e)}});return e}()}var n=[];UE.utils.each(t,function(e,t){n.push(t)});if(t&&e.inputXssFilter){this.addInputRule(function(e){e.traversal(function(e){if(e.type!=="element"){return false}i(e)})})}if(t&&e.outputXssFilter){this.addOutputRule(function(e){e.traversal(function(e){if(e.type!=="element"){return false}i(e)})})}};var baidu=baidu||{};baidu.editor=baidu.editor||{};UE.ui=baidu.editor.ui={};(function(){var e=baidu.editor.browser,t=baidu.editor.dom.domUtils;var i="$EDITORUI";var n=window[i]={};var r="ID"+i;var o=0;var a=baidu.editor.ui.uiUtils={uid:function(e){return e?e[r]||(e[r]=++o):++o},hook:function(e,t){var i;if(e&&e._callbacks){i=e}else{i=function(){var t;if(e){t=e.apply(this,arguments)}var n=i._callbacks;var r=n.length;while(r--){var o=n[r].apply(this,arguments);if(t===undefined){t=o}}return t};i._callbacks=[]}i._callbacks.push(t);return i},createElementByHtml:function(e){var t=document.createElement("div");t.innerHTML=e;t=t.firstChild;t.parentNode.removeChild(t);return t},getViewportElement:function(){return e.ie&&e.quirks?document.body:document.documentElement},getClientRect:function(e){var i;try{i=e.getBoundingClientRect()}catch(e){i={left:0,top:0,height:0,width:0}}var n={left:Math.round(i.left),top:Math.round(i.top),height:Math.round(i.bottom-i.top),width:Math.round(i.right-i.left)};var r;while((r=e.ownerDocument)!==document&&(e=t.getWindow(r).frameElement)){i=e.getBoundingClientRect();n.left+=i.left;n.top+=i.top}n.bottom=n.top+n.height;n.right=n.left+n.width;return n},getViewportRect:function(){var e=a.getViewportElement();var t=(window.innerWidth||e.clientWidth)|0;var i=(window.innerHeight||e.clientHeight)|0;return{left:0,top:0,height:i,width:t,bottom:i,right:t}},setViewportOffset:function(e,i){var n;var r=a.getFixedLayer();if(e.parentNode===r){e.style.left=i.left+"px";e.style.top=i.top+"px"}else{t.setViewportOffset(e,i)}},getEventOffset:function(e){var t=e.target||e.srcElement;var i=a.getClientRect(t);var n=a.getViewportOffsetByEvent(e);return{left:n.left-i.left,top:n.top-i.top}},getViewportOffsetByEvent:function(e){var i=e.target||e.srcElement;var n=t.getWindow(i).frameElement;var r={left:e.clientX,top:e.clientY};if(n&&i.ownerDocument!==document){var o=a.getClientRect(n);r.left+=o.left;r.top+=o.top}return r},setGlobal:function(e,t){n[e]=t;return i+'["'+e+'"]'},unsetGlobal:function(e){delete n[e]},copyAttributes:function(i,n){var r=n.attributes;var o=r.length;while(o--){var a=r[o];if(a.nodeName!="style"&&a.nodeName!="class"&&(!e.ie||a.specified)){i.setAttribute(a.nodeName,a.nodeValue)}}if(n.className){t.addClass(i,n.className)}if(n.style.cssText){i.style.cssText+=";"+n.style.cssText}},removeStyle:function(e,t){if(e.style.removeProperty){e.style.removeProperty(t)}else if(e.style.removeAttribute){e.style.removeAttribute(t)}else throw""},contains:function(e,t){return e&&t&&(e===t?false:e.contains?e.contains(t):e.compareDocumentPosition(t)&16)},startDrag:function(e,t,i){var i=i||document;var n=e.clientX;var r=e.clientY;function o(e){var i=e.clientX-n;var o=e.clientY-r;t.ondragmove(i,o,e);if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}if(i.addEventListener){function a(e){i.removeEventListener("mousemove",o,true);i.removeEventListener("mouseup",a,true);window.removeEventListener("mouseup",a,true);t.ondragstop()}i.addEventListener("mousemove",o,true);i.addEventListener("mouseup",a,true);window.addEventListener("mouseup",a,true);e.preventDefault()}else{var s=e.srcElement;s.setCapture();function l(){s.releaseCapture();s.detachEvent("onmousemove",o);s.detachEvent("onmouseup",l);s.detachEvent("onlosecaptrue",l);t.ondragstop()}s.attachEvent("onmousemove",o);s.attachEvent("onmouseup",l);s.attachEvent("onlosecaptrue",l);e.returnValue=false}t.ondragstart()},getFixedLayer:function(){var t=document.getElementById("edui_fixedlayer");if(t==null){t=document.createElement("div");t.id="edui_fixedlayer";document.body.appendChild(t);if(e.ie&&e.version<=8){t.style.position="absolute";l();setTimeout(s)}else{t.style.position="fixed"}t.style.left="0";t.style.top="0";t.style.width="0";t.style.height="0"}return t},makeUnselectable:function(t){if(e.opera||e.ie&&e.version<9){t.unselectable="on";if(t.hasChildNodes()){for(var i=0;i<t.childNodes.length;i++){if(t.childNodes[i].nodeType==1){a.makeUnselectable(t.childNodes[i])}}}}else{if(t.style.MozUserSelect!==undefined){t.style.MozUserSelect="none"}else if(t.style.WebkitUserSelect!==undefined){t.style.WebkitUserSelect="none"}else if(t.style.KhtmlUserSelect!==undefined){t.style.KhtmlUserSelect="none"}}}};function s(){var e=document.getElementById("edui_fixedlayer");a.setViewportOffset(e,{left:0,top:0})}function l(e){t.on(window,"scroll",s);t.on(window,"resize",baidu.editor.utils.defer(s,0,true))}})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.EventBase,n=baidu.editor.ui.UIBase=function(){};n.prototype={className:"",uiName:"",initOptions:function(e){var i=this;for(var n in e){i[n]=e[n]}this.id=this.id||"edui"+t.uid()},initUIBase:function(){this._globalKey=e.unhtml(t.setGlobal(this.id,this))},render:function(e){var i=this.renderHtml();var n=t.createElementByHtml(i);var r=domUtils.getElementsByTagName(n,"*");var o="edui-"+(this.theme||this.editor.options.theme);var a=document.getElementById("edui_fixedlayer");for(var s=0,l;l=r[s++];){domUtils.addClass(l,o)}domUtils.addClass(n,o);if(a){a.className="";domUtils.addClass(a,o)}var d=this.getDom();if(d!=null){d.parentNode.replaceChild(n,d);t.copyAttributes(n,d)}else{if(typeof e=="string"){e=document.getElementById(e)}e=e||t.getFixedLayer();domUtils.addClass(e,o);e.appendChild(n)}this.postRender()},getDom:function(e){if(!e){return document.getElementById(this.id)}else{return document.getElementById(this.id+"_"+e)}},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(e){var t="edui-"+this.uiName;return e.replace(/##/g,this.id).replace(/%%-/g,this.uiName?t+"-":"").replace(/%%/g,(this.uiName?t:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var e=this.getDom();if(e)baidu.editor.dom.domUtils.remove(e);t.unsetGlobal(this.id)}};e.inherits(n,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.Separator=function(e){this.initOptions(e);this.initSeparator()};i.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}};e.inherits(i,t)})();(function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,i=baidu.editor.ui.UIBase,n=baidu.editor.ui.uiUtils;var r=baidu.editor.ui.Mask=function(e){this.initOptions(e);this.initUIBase()};r.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onclick="return $$._onClick(event, this);" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var e=this;t.on(window,"resize",function(){setTimeout(function(){if(!e.isHidden()){e._fill()}})})},show:function(e){this._fill();this.getDom().style.display="";this.getDom().style.zIndex=e},hide:function(){this.getDom().style.display="none";this.getDom().style.zIndex=""},isHidden:function(){return this.getDom().style.display=="none"},_onMouseDown:function(){return false},_onClick:function(e,t){this.fireEvent("click",e,t)},_fill:function(){var e=this.getDom();var t=n.getViewportRect();e.style.width=t.width+"px";e.style.height=t.height+"px"}};e.inherits(r,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.dom.domUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.Popup=function(e){this.initOptions(e);this.initPopup()};var o=[];function a(e,t){for(var i=0;i<o.length;i++){var n=o[i];if(!n.isHidden()){if(n.queryAutoHide(t)!==false){if(e&&/scroll/gi.test(e.type)&&n.className=="edui-wordpastepop")return;n.hide()}}}if(o.length)n.editor.fireEvent("afterhidepop")}r.postHide=a;var s=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];r.prototype={SHADOW_RADIUS:5,content:null,_hidden:false,autoRender:true,canSideLeft:true,canSideUp:true,initPopup:function(){this.initUIBase();o.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%" onmousedown="return false;">'+' <div id="##_body" class="edui-popup-body">'+' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe>'+' <div class="edui-shadow"></div>'+' <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div>"+" </div>"+"</div>"},getContentHtmlTpl:function(){if(this.content){if(typeof this.content=="string"){return this.content}return this.content.renderHtml()}else{return""}},_UIBase_postRender:n.prototype.postRender,postRender:function(){if(this.content instanceof n){this.content.postRender()}if(this.captureWheel&&!this.captured){this.captured=true;var e=(document.documentElement.clientHeight||document.body.clientHeight)-80,r=this.getDom().offsetHeight,o=t.getClientRect(this.combox.getDom()).top,a=this.getDom("content"),s=this.getDom("body").getElementsByTagName("iframe"),l=this;s.length&&(s=s[0]);while(o+r>e){r-=30}a.style.height=r+"px";s&&(s.style.height=r+"px");if(window.XMLHttpRequest){i.on(a,"onmousewheel"in document.body?"mousewheel":"DOMMouseScroll",function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}if(e.wheelDelta){a.scrollTop-=e.wheelDelta/120*60}else{a.scrollTop-=e.detail/-3*60}})}else{i.on(this.getDom(),"mousewheel",function(e){e.returnValue=false;l.getDom("content").scrollTop-=e.wheelDelta/120*60})}}this.fireEvent("postRenderAfter");this.hide(true);this._UIBase_postRender()},_doAutoRender:function(){if(!this.getDom()&&this.autoRender){this.render()}},mesureSize:function(){var e=this.getDom("content");return t.getClientRect(e)},fitSize:function(){if(this.captureWheel&&this.sized){return this.__size}this.sized=true;var e=this.getDom("body");e.style.width="";e.style.height="";var t=this.mesureSize();if(this.captureWheel){e.style.width=-(-20-t.width)+"px";var i=parseInt(this.getDom("content").style.height,10);!window.isNaN(i)&&(t.height=i)}else{e.style.width=t.width+"px"}e.style.height=t.height+"px";this.__size=t;this.captureWheel&&(this.getDom("content").style.overflow="auto");return t},showAnchor:function(e,i){this.showAnchorRect(t.getClientRect(e),i)},showAnchorRect:function(e,n,r){this._doAutoRender();var o=t.getViewportRect();this.getDom().style.visibility="hidden";this._show();var a=this.fitSize();var l,d,u,c;if(n){l=this.canSideLeft&&(e.right+a.width>o.right&&e.left>a.width);d=this.canSideUp&&(e.top+a.height>o.bottom&&e.bottom>a.height);u=l?e.left-a.width:e.right;c=d?e.bottom-a.height:e.top}else{l=this.canSideLeft&&(e.right+a.width>o.right&&e.left>a.width);d=this.canSideUp&&(e.top+a.height>o.bottom&&e.bottom>a.height);u=l?e.right-a.width:e.left;c=d?e.top-a.height:e.bottom}var f=this.getDom();t.setViewportOffset(f,{left:u,top:c});i.removeClasses(f,s);f.className+=" "+s[(d?1:0)*2+(l?1:0)];if(this.editor){f.style.zIndex=this.editor.container.style.zIndex*1+10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=f.style.zIndex-1}this.getDom().style.visibility="visible"},showAt:function(e){var t=e.left;var i=e.top;var n={left:t,top:i,right:t,bottom:i,height:0,width:0};this.showAnchorRect(n,false,true)},_show:function(){if(this._hidden){var e=this.getDom();e.style.display="";this._hidden=false;this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender();this._show()},hide:function(e){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;if(!e){this.fireEvent("hide")}}},queryAutoHide:function(e){return!e||!t.contains(this.getDom(),e)}};e.inherits(r,n);i.on(document,"mousedown",function(e){var t=e.target||e.srcElement;a(e,t)});i.on(window,"scroll",function(e,t){a(e,t)})})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.ColorPicker=function(e){this.initOptions(e);this.noColorText=this.noColorText||this.editor.getLang("clearColor");this.initUIBase()};i.prototype={getHtmlTpl:function(){return r(this.noColorText,this.editor)},_onTableClick:function(e){var t=e.target||e.srcElement;var i=t.getAttribute("data-color");if(i){this.fireEvent("pickcolor",i)}},_onTableOver:function(e){var t=e.target||e.srcElement;var i=t.getAttribute("data-color");if(i){this.getDom("preview").style.backgroundColor=i}},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}};e.inherits(i,t);var n=("ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,"+"f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,"+"d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,"+"bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,"+"a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,"+"7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,"+"c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,").split(",");function r(e,t){var i='<div id="##" class="edui-colorpicker %%">'+'<div class="edui-colorpicker-topbar edui-clearfix">'+'<div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div>'+'<div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+e+"</div>"+"</div>"+'<table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0">'+'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+t.getLang("themeColor")+"</td> </tr>"+'<tr class="edui-colorpicker-tablefirstrow" >';for(var r=0;r<n.length;r++){if(r&&r%10===0){i+="</tr>"+(r==60?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+t.getLang("standardColor")+"</td></tr>":"")+"<tr"+(r==60?' class="edui-colorpicker-tablefirstrow"':"")+">"}i+=r<70?'<td style="padding: 0 2px;"><a hidefocus title="'+n[r]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell"'+' data-color="#'+n[r]+'"'+' style="background-color:#'+n[r]+";border:solid #ccc;"+(r<10||r>=60?"border-width:1px;":r>=10&&r<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":""}i+="</tr></table></div>";return i}})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.ui.UIBase;var n=baidu.editor.ui.TablePicker=function(e){this.initOptions(e);this.initTablePicker()};n.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){var e=this;return'<div id="##" class="edui-tablepicker %%">'+'<div class="edui-tablepicker-body">'+'<div class="edui-infoarea">'+'<span id="##_label" class="edui-label"></span>'+"</div>"+'<div class="edui-pickarea"'+' onmousemove="$$._onMouseMove(event, this);"'+' onmouseover="$$._onMouseOver(event, this);"'+' onmouseout="$$._onMouseOut(event, this);"'+' onclick="$$._onClick(event, this);"'+">"+'<div id="##_overlay" class="edui-overlay"></div>'+"</div>"+"</div>"+"</div>"},_UIBase_render:i.prototype.render,render:function(e){this._UIBase_render(e);this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(e,t){var i=this.getDom("overlay").style;var n=this.lengthOfCellSide;i.width=e*n+"px";i.height=t*n+"px";var r=this.getDom("label");r.innerHTML=e+this.editor.getLang("t_col")+" x "+t+this.editor.getLang("t_row");this.numCols=e;this.numRows=t},_onMouseOver:function(e,i){var n=e.relatedTarget||e.fromElement;if(!t.contains(i,n)&&i!==n){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility=""}},_onMouseOut:function(e,i){var n=e.relatedTarget||e.toElement;if(!t.contains(i,n)&&i!==n){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility="hidden"}},_onMouseMove:function(e,i){var n=this.getDom("overlay").style;var r=t.getEventOffset(e);var o=this.lengthOfCellSide;var a=Math.ceil(r.left/o);var s=Math.ceil(r.top/o);this._track(a,s)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}};e.inherits(n,i)})();(function(){var e=baidu.editor.browser,t=baidu.editor.dom.domUtils,i=baidu.editor.ui.uiUtils;var n='onmousedown="$$.Stateful_onMouseDown(event, this);"'+' onmouseup="$$.Stateful_onMouseUp(event, this);"'+(e.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);"'+' onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);"'+' onmouseout="$$.Stateful_onMouseOut(event, this);"');baidu.editor.ui.Stateful={alwalysHoverable:false,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl;this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var e=this._Stateful_dGetHtmlTpl();return e.replace(/stateful/g,function(){return n})},Stateful_onMouseEnter:function(e,t){
this.target=t;if(!this.isDisabled()||this.alwalysHoverable){this.addState("hover");this.fireEvent("over")}},Stateful_onMouseLeave:function(e,t){if(!this.isDisabled()||this.alwalysHoverable){this.removeState("hover");this.removeState("active");this.fireEvent("out")}},Stateful_onMouseOver:function(e,t){var n=e.relatedTarget;if(!i.contains(t,n)&&t!==n){this.Stateful_onMouseEnter(e,t)}},Stateful_onMouseOut:function(e,t){var n=e.relatedTarget;if(!i.contains(t,n)&&t!==n){this.Stateful_onMouseLeave(e,t)}},Stateful_onMouseDown:function(e,t){if(!this.isDisabled()){this.addState("active")}},Stateful_onMouseUp:function(e,t){if(!this.isDisabled()){this.removeState("active")}},Stateful_postRender:function(){if(this.disabled&&!this.hasState("disabled")){this.addState("disabled")}},hasState:function(e){return t.hasClass(this.getStateDom(),"edui-state-"+e)},addState:function(e){if(!this.hasState(e)){this.getStateDom().className+=" edui-state-"+e}},removeState:function(e){if(this.hasState(e)){t.removeClasses(this.getStateDom(),["edui-state-"+e])}},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(e){if(!this.isDisabled()&&e){this.addState("checked")}else{this.removeState("checked")}},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(e){if(e){this.removeState("hover");this.removeState("checked");this.removeState("active");this.addState("disabled")}else{this.removeState("disabled")}}}})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.Stateful,n=baidu.editor.ui.Button=function(e){if(e.name){var t=e.name;var i=e.cssRules;if(!e.className){e.className="edui-for-"+t}e.cssRules=".edui-default  .edui-for-"+t+" .edui-icon {"+i+"}"}this.initOptions(e);this.initButton()};n.prototype={uiName:"button",label:"",title:"",showIcon:true,showText:true,cssRules:"",initButton:function(){this.initUIBase();this.Stateful_init();if(this.cssRules){e.cssRule("edui-customize-"+this.name+"-style",this.cssRules)}},getHtmlTpl:function(){return'<div id="##" class="edui-box %%">'+'<div id="##_state" stateful>'+'<div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return $$._onMouseDown(event, this);" onclick="return $$._onClick(event, this);">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div></div>"},postRender:function(){this.Stateful_postRender();this.setDisabled(this.disabled)},_onMouseDown:function(e){var t=e.target||e.srcElement,i=t&&t.tagName&&t.tagName.toLowerCase();if(i=="input"||i=="object"||i=="object"){return false}},_onClick:function(){if(!this.isDisabled()){this.fireEvent("click")}},setTitle:function(e){var t=this.getDom("label");t.innerHTML=e}};e.inherits(n,t);e.extend(n.prototype,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.dom.domUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.Stateful,o=baidu.editor.ui.SplitButton=function(e){this.initOptions(e);this.initSplitButton()};o.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){this.initUIBase();this.Stateful_init();var e=this;if(this.popup!=null){var t=this.popup;this.popup=null;this.setPopup(t)}},_UIBase_postRender:n.prototype.postRender,postRender:function(){this.Stateful_postRender();this._UIBase_postRender()},setPopup:function(i){if(this.popup===i)return;if(this.popup!=null){this.popup.dispose()}i.addListener("show",e.bind(this._onPopupShow,this));i.addListener("hide",e.bind(this._onPopupHide,this));i.addListener("postrender",e.bind(function(){i.getDom("body").appendChild(t.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(t.getClientRect(this.getDom()).width-2)+'px"></div>'));i.getDom().className+=" "+this.className},this));this.popup=i},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%">'+"<div "+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body">'+'<div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);">'+'<div class="edui-box edui-icon"></div>'+"</div>"+'<div class="edui-box edui-splitborder"></div>'+'<div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div>'+"</div></div></div>"},showPopup:function(){var e=t.getClientRect(this.getDom());e.top-=this.popup.SHADOW_RADIUS;e.height+=this.popup.SHADOW_RADIUS;this.popup.showAnchorRect(e)},_onArrowClick:function(e,t){if(!this.isDisabled()){this.showPopup()}},_onButtonClick:function(){if(!this.isDisabled()){this.fireEvent("buttonclick")}}};e.inherits(o,n);e.extend(o.prototype,r,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.ui.ColorPicker,n=baidu.editor.ui.Popup,r=baidu.editor.ui.SplitButton,o=baidu.editor.ui.ColorButton=function(e){this.initOptions(e);this.initColorButton()};o.prototype={initColorButton:function(){var e=this;this.popup=new n({content:new i({noColorText:e.editor.getLang("clearColor"),editor:e.editor,onpickcolor:function(t,i){e._onPickColor(i)},onpicknocolor:function(t,i){e._onPickNoColor(i)}}),editor:e.editor});this.initSplitButton()},_SplitButton_postRender:r.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.getDom("button_body").appendChild(t.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>'));this.getDom().className+=" edui-colorbutton"},setColor:function(e){this.getDom("colorlump").style.backgroundColor=e;this.color=e},_onPickColor:function(e){if(this.fireEvent("pickcolor",e)!==false){this.setColor(e);this.popup.hide()}},_onPickNoColor:function(e){if(this.fireEvent("picknocolor")!==false){this.popup.hide()}}};e.inherits(o,r)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,i=baidu.editor.ui.TablePicker,n=baidu.editor.ui.SplitButton,r=baidu.editor.ui.TableButton=function(e){this.initOptions(e);this.initTableButton()};r.prototype={initTableButton:function(){var e=this;this.popup=new t({content:new i({editor:e.editor,onpicktable:function(t,i,n){e._onPickTable(i,n)}}),editor:e.editor});this.initSplitButton()},_onPickTable:function(e,t){if(this.fireEvent("picktable",e,t)!==false){this.popup.hide()}}};e.inherits(r,n)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,i=baidu.editor.ui.Stateful,n=baidu.editor.ui.UIBase;var r=baidu.editor.ui.CellAlignPicker=function(e){this.initOptions(e);this.initSelected();this.initCellAlignPicker()};r.prototype={initSelected:function(){var e={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3},t=-1;if(this.selected){this.selectedIndex=e.valign[this.selected.valign]*e.count+e.align[this.selected.align]}},initCellAlignPicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){var e=["left","center","right"],t=9,i=null,n=-1,r=[];for(var o=0;o<t;o++){i=this.selectedIndex===o?' class="edui-cellalign-selected" ':"";n=o%3;n===0&&r.push("<tr>");r.push('<td index="'+o+'" '+i+' stateful><div class="edui-icon edui-'+e[n]+'"></div></td>');n===2&&r.push("</tr>")}return'<div id="##" class="edui-cellalignpicker %%">'+'<div class="edui-cellalignpicker-body">'+'<table onclick="$$._onClick(event);">'+r.join("")+"</table>"+"</div>"+"</div>"},getStateDom:function(){return this.target},_onClick:function(e){var i=e.target||e.srcElement;if(/icon/.test(i.className)){this.items[i.parentNode.getAttribute("index")].onclick();t.postHide(e)}},_UIBase_render:n.prototype.render};e.inherits(r,n);e.extend(r.prototype,i,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Stateful,i=baidu.editor.ui.uiUtils,n=baidu.editor.ui.UIBase;var r=baidu.editor.ui.PastePicker=function(e){this.initOptions(e);this.initPastePicker()};r.prototype={initPastePicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"></div>'+'<div class="edui-pastecontainer">'+'<div class="edui-title">'+this.editor.getLang("pasteOpt")+"</div>"+'<div class="edui-button">'+'<div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful>'+'<div class="edui-richtxticon"></div></div>'+'<div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful>'+'<div class="edui-tagicon"></div></div>'+'<div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful>'+'<div class="edui-plaintxticon"></div></div>'+"</div>"+"</div>"+"</div>"},getStateDom:function(){return this.target},format:function(e){this.editor.ui._isTransfer=true;this.editor.fireEvent("pasteTransfer",e)},_onClick:function(e){var t=domUtils.getNextDomNode(e),n=i.getViewportRect().height,r=i.getClientRect(t);if(r.top+r.height>n)t.style.top=-r.height-e.offsetHeight+"px";else t.style.top="";if(/hidden/gi.test(domUtils.getComputedStyle(t,"visibility"))){t.style.visibility="visible";domUtils.addClass(e,"edui-state-opened")}else{t.style.visibility="hidden";domUtils.removeClasses(e,"edui-state-opened")}},_UIBase_render:n.prototype.render};e.inherits(r,n);e.extend(r.prototype,t,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.ui.UIBase,n=baidu.editor.ui.Toolbar=function(e){this.initOptions(e);this.initToolbar()};n.prototype={items:null,initToolbar:function(){this.items=this.items||[];this.initUIBase()},add:function(e,t){if(t===undefined){this.items.push(e)}else{this.items.splice(t,0,e)}},getHtmlTpl:function(){var e=[];for(var t=0;t<this.items.length;t++){e[t]=this.items[t].renderHtml()}return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+e.join("")+"</div>"},postRender:function(){var e=this.getDom();for(var i=0;i<this.items.length;i++){this.items[i].postRender()}t.makeUnselectable(e)},_onMouseDown:function(e){var t=e.target||e.srcElement,i=t&&t.tagName&&t.tagName.toLowerCase();if(i=="input"||i=="object"||i=="object"){return false}}};e.inherits(n,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,i=baidu.editor.ui.uiUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.Popup,o=baidu.editor.ui.Stateful,a=baidu.editor.ui.CellAlignPicker,s=baidu.editor.ui.Menu=function(e){this.initOptions(e);this.initMenu()};var l={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return true}};s.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[];this.initPopup();this.initItems()},initItems:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];if(t=="-"){this.items[e]=this.getSeparator()}else if(!(t instanceof d)){t.editor=this.editor;t.theme=this.editor.options.theme;this.items[e]=this.createItem(t)}}},getSeparator:function(){return l},createItem:function(e){e.menu=this;return new d(e)},_Popup_getContentHtmlTpl:r.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(this.items.length==0){return this._Popup_getContentHtmlTpl()}var e=[];for(var t=0;t<this.items.length;t++){var i=this.items[t];e[t]=i.renderHtml()}return'<div class="%%-body">'+e.join("")+"</div>"},_Popup_postRender:r.prototype.postRender,postRender:function(){var e=this;for(var n=0;n<this.items.length;n++){var r=this.items[n];r.ownerMenu=this;r.postRender()}t.on(this.getDom(),"mouseover",function(t){t=t||event;var n=t.relatedTarget||t.fromElement;var r=e.getDom();if(!i.contains(r,n)&&r!==n){e.fireEvent("over")}});this._Popup_postRender()},queryAutoHide:function(e){if(e){if(i.contains(this.getDom(),e)){return false}for(var t=0;t<this.items.length;t++){var n=this.items[t];if(n.queryAutoHide(e)===false){return false}}}},clearItems:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];clearTimeout(t._showingTimer);clearTimeout(t._closingTimer);if(t.subMenu){t.subMenu.destroy()}}this.items=[]},destroy:function(){if(this.getDom()){t.remove(this.getDom())}this.clearItems()},dispose:function(){this.destroy()}};e.inherits(s,r);var d=baidu.editor.ui.MenuItem=function(e){this.initOptions(e);this.initUIBase();this.Stateful_init();if(this.subMenu&&!(this.subMenu instanceof s)){if(e.className&&e.className.indexOf("aligntd")!=-1){var i=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment");this.subMenu=new r({content:new a(this.subMenu),parentMenu:i,editor:i.editor,destroy:function(){if(this.getDom()){t.remove(this.getDom())}}});this.subMenu.addListener("postRenderAfter",function(){t.on(this.getDom(),"mouseover",function(){i.addState("opened")})})}else{this.subMenu=new s(this.subMenu)}}};d.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:true,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);">'+'<div class="%%-body">'+this.renderLabelHtml()+"</div>"+"</div>"},postRender:function(){var e=this;this.addListener("over",function(){e.ownerMenu.fireEvent("submenuover",e);if(e.subMenu){e.delayShowSubMenu()}});if(this.subMenu){this.getDom().className+=" edui-hassubmenu";this.subMenu.render();this.addListener("out",function(){e.delayHideSubMenu()});this.subMenu.addListener("over",function(){clearTimeout(e._closingTimer);e._closingTimer=null;e.addState("opened")});this.ownerMenu.addListener("hide",function(){e.hideSubMenu()});this.ownerMenu.addListener("submenuover",function(t,i){if(i!==e){e.delayHideSubMenu()}});this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide;this.subMenu.queryAutoHide=function(t){if(t&&i.contains(e.getDom(),t)){return false}return this._bakQueryAutoHide(t)}}this.getDom().style.tabIndex="-1";i.makeUnselectable(this.getDom());this.Stateful_postRender()},delayShowSubMenu:function(){var e=this;if(!e.isDisabled()){e.addState("opened");clearTimeout(e._showingTimer);clearTimeout(e._closingTimer);e._closingTimer=null;e._showingTimer=setTimeout(function(){e.showSubMenu()},250)}},delayHideSubMenu:function(){var e=this;if(!e.isDisabled()){e.removeState("opened");clearTimeout(e._showingTimer);if(!e._closingTimer){e._closingTimer=setTimeout(function(){if(!e.hasState("opened")){e.hideSubMenu()}e._closingTimer=null},400)}}},renderLabelHtml:function(){return'<div class="edui-arrow"></div>'+'<div class="edui-box edui-icon"></div>'+'<div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(e){if(this.subMenu&&this.hasState("opened")){return this.subMenu.queryAutoHide(e)}},_onClick:function(e,t){if(this.hasState("disabled"))return;if(this.fireEvent("click",e,t)!==false){if(this.subMenu){this.showSubMenu()}else{r.postHide(e)}}},showSubMenu:function(){var e=i.getClientRect(this.getDom());e.right-=5;e.left+=2;e.width-=7;e.top-=4;e.bottom+=4;e.height+=8;this.subMenu.showAnchorRect(e,true,true)},hideSubMenu:function(){this.subMenu.hide()}};e.inherits(d,n);e.extend(d.prototype,o,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.ui.Menu,n=baidu.editor.ui.SplitButton,r=baidu.editor.ui.Combox=function(e){this.initOptions(e);this.initCombox()};r.prototype={uiName:"combox",onbuttonclick:function(){this.showPopup()},initCombox:function(){var e=this;this.items=this.items||[];for(var t=0;t<this.items.length;t++){var n=this.items[t];n.uiName="listitem";n.index=t;n.onclick=function(){e.selectByIndex(this.index)}}this.popup=new i({items:this.items,uiName:"list",editor:this.editor,captureWheel:true,combox:this});this.initSplitButton()},_SplitButton_postRender:n.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.setLabel(this.label||"");this.setValue(this.initValue||"")},showPopup:function(){var e=t.getClientRect(this.getDom());e.top+=1;e.bottom-=1;e.height-=2;this.popup.showAnchorRect(e)},getValue:function(){return this.value},setValue:function(e){var t=this.indexByValue(e);if(t!=-1){this.selectedIndex=t;this.setLabel(this.items[t].label);this.value=this.items[t].value}else{this.selectedIndex=-1;this.setLabel(this.getLabelForUnknowValue(e));this.value=e}},setLabel:function(e){this.getDom("button_body").innerHTML=e;this.label=e},getLabelForUnknowValue:function(e){return e},indexByValue:function(e){for(var t=0;t<this.items.length;t++){if(e==this.items[t].value){return t}}return-1},getItem:function(e){return this.items[e]},selectByIndex:function(e){if(e<this.items.length&&this.fireEvent("select",e)!==false){this.selectedIndex=e;this.value=this.items[e].value;this.setLabel(this.items[e].label)}}};e.inherits(r,n)})();(function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,i=baidu.editor.ui.uiUtils,n=baidu.editor.ui.Mask,r=baidu.editor.ui.UIBase,o=baidu.editor.ui.Button,a=baidu.editor.ui.Dialog=function(t){if(t.name){var i=t.name;var n=t.cssRules;if(!t.className){t.className="edui-for-"+i}if(n){t.cssRules=".edui-default .edui-for-"+i+" .edui-dialog-content  {"+n+"}"}}this.initOptions(e.extend({autoReset:true,draggable:true,onok:function(){},oncancel:function(){},onclose:function(e,t){return t?this.onok():this.oncancel()},holdScroll:false},t));this.initDialog()};var s;var l;var d;a.prototype={draggable:false,uiName:"dialog",initDialog:function(){var t=this,i=this.editor.options.theme;if(this.cssRules){e.cssRule("edui-customize-"+this.name+"-style",this.cssRules)}this.initUIBase();this.modalMask=s||(s=new n({className:"edui-dialog-modalmask",theme:i,onclick:function(){d&&d.close(false)}}));this.dragMask=l||(l=new n({className:"edui-dialog-dragmask",theme:i}));this.closeButton=new o({className:"edui-dialog-closebutton",title:t.closeDialog,theme:i,onclick:function(){t.close(false)}});this.fullscreen&&this.initResizeEvent();if(this.buttons){for(var r=0;r<this.buttons.length;r++){if(!(this.buttons[r]instanceof o)){this.buttons[r]=new o(e.extend(this.buttons[r],{editor:this.editor},true))}}}},initResizeEvent:function(){var e=this;t.on(window,"resize",function(){if(e._hidden||e._hidden===undefined){return}if(e.__resizeTimer){window.clearTimeout(e.__resizeTimer)}e.__resizeTimer=window.setTimeout(function(){e.__resizeTimer=null;var t=e.getDom(),n=e.getDom("content"),r=UE.ui.uiUtils.getClientRect(t),o=UE.ui.uiUtils.getClientRect(n),a=i.getViewportRect();n.style.width=a.width-r.width+o.width+"px";n.style.height=a.height-r.height+o.height+"px";t.style.width=a.width+"px";t.style.height=a.height+"px";e.fireEvent("resize")},100)})},fitSize:function(){var e=this.getDom("body");var t=this.mesureSize();e.style.width=t.width+"px";e.style.height=t.height+"px";return t},safeSetOffset:function(e){var t=this;var n=t.getDom();var r=i.getViewportRect();var o=i.getClientRect(n);var a=e.left;if(a+o.width>r.right){a=r.right-o.width}var s=e.top;if(s+o.height>r.bottom){s=r.bottom-o.height}n.style.left=Math.max(a,0)+"px";n.style.top=Math.max(s,0)+"px"},showAtCenter:function(){var e=i.getViewportRect();if(!this.fullscreen){this.getDom().style.display="";var n=this.fitSize();var r=this.getDom("titlebar").offsetHeight|0;var o=e.width/2-n.width/2;var a=e.height/2-(n.height-r)/2-r;var s=this.getDom();this.safeSetOffset({left:Math.max(o|0,0),top:Math.max(a|0,0)});if(!t.hasClass(s,"edui-state-centered")){s.className+=" edui-state-centered"}}else{var l=this.getDom(),d=this.getDom("content");l.style.display="block";var u=UE.ui.uiUtils.getClientRect(l),c=UE.ui.uiUtils.getClientRect(d);l.style.left="-100000px";d.style.width=e.width-u.width+c.width+"px";d.style.height=e.height-u.height+c.height+"px";l.style.width=e.width+"px";l.style.height=e.height+"px";l.style.left=0;this._originalContext={html:{overflowX:document.documentElement.style.overflowX,overflowY:document.documentElement.style.overflowY},body:{overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY}};document.documentElement.style.overflowX="hidden";document.documentElement.style.overflowY="hidden";document.body.style.overflowX="hidden";document.body.style.overflowY="hidden"}this._show()},getContentHtml:function(){var e="";if(typeof this.content=="string"){e=this.content}else if(this.iframeUrl){e='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'}return e},getHtmlTpl:function(){var e="";if(this.buttons){var t=[];for(var i=0;i<this.buttons.length;i++){t[i]=this.buttons[i].renderHtml()}e='<div class="%%-foot">'+'<div id="##_buttons" class="%%-buttons">'+t.join("")+"</div>"+"</div>"}return'<div id="##" class="%%"><div '+(!this.fullscreen?'class="%%"':'class="%%-wrap edui-dialog-fullscreen-flag"')+'><div id="##_body" class="%%-body">'+'<div class="%%-shadow"></div>'+'<div id="##_titlebar" class="%%-titlebar">'+'<div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);">'+'<span class="%%-caption">'+(this.title||"")+"</span>"+"</div>"+this.closeButton.renderHtml()+"</div>"+'<div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+e+"</div></div></div>"},postRender:function(){if(!this.modalMask.getDom()){this.modalMask.render();this.modalMask.hide()}if(!this.dragMask.getDom()){this.dragMask.render();this.dragMask.hide()}var e=this;this.addListener("show",function(){e.modalMask.show(this.getDom().style.zIndex-2)});this.addListener("hide",function(){e.modalMask.hide()});if(this.buttons){for(var n=0;n<this.buttons.length;n++){this.buttons[n].postRender()}}t.on(window,"resize",function(){setTimeout(function(){if(!e.isHidden()){e.safeSetOffset(i.getClientRect(e.getDom()))}})});this._hide()},mesureSize:function(){var e=this.getDom("body");var t=i.getClientRect(this.getDom("content")).width;var n=e.style;n.width=t;return i.getClientRect(e)},_onTitlebarMouseDown:function(e,n){if(this.draggable){var r;var o=i.getViewportRect();var a=this;i.startDrag(e,{ondragstart:function(){r=i.getClientRect(a.getDom());a.getDom("contmask").style.visibility="visible";a.dragMask.show(a.getDom().style.zIndex-1)},ondragmove:function(e,t){var i=r.left+e;var n=r.top+t;a.safeSetOffset({left:i,top:n})},ondragstop:function(){a.getDom("contmask").style.visibility="hidden";t.removeClasses(a.getDom(),["edui-state-centered"]);a.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml();this.fireEvent("dialogafterreset")},_show:function(){if(this._hidden){this.getDom().style.display="";this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10);this._hidden=false;this.fireEvent("show");baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4}},isHidden:function(){return this._hidden},_hide:function(){if(!this._hidden){var e=this.getDom();e.style.display="none";e.style.zIndex="";e.style.width="";e.style.height="";this._hidden=true;this.fireEvent("hide")}},open:function(){if(this.autoReset){try{this.reset()}catch(e){this.render();this.open()}}this.showAtCenter();if(this.iframeUrl){try{this.getDom("iframe").focus()}catch(e){}}d=this},_onCloseButtonClick:function(e,t){this.close(false)},close:function(e){if(this.fireEvent("close",e)!==false){if(this.fullscreen){document.documentElement.style.overflowX=this._originalContext.html.overflowX;document.documentElement.style.overflowY=this._originalContext.html.overflowY;document.body.style.overflowX=this._originalContext.body.overflowX;document.body.style.overflowY=this._originalContext.body.overflowY;delete this._originalContext}this._hide();var i=this.getDom("content");var n=this.getDom("iframe");if(i&&n){var r=n.contentDocument||n.contentWindow.document;r&&(r.body.innerHTML="");t.remove(i)}}}};e.inherits(a,r)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Menu,i=baidu.editor.ui.SplitButton,n=baidu.editor.ui.MenuButton=function(e){this.initOptions(e);this.initMenuButton()};n.prototype={initMenuButton:function(){var e=this;this.uiName="menubutton";this.popup=new t({items:e.items,className:e.className,editor:e.editor});this.popup.addListener("show",function(){var t=this;for(var i=0;i<t.items.length;i++){t.items[i].removeState("checked");if(t.items[i].value==e._value){t.items[i].addState("checked");this.value=e._value}}});this.initSplitButton()},setValue:function(e){this._value=e}};e.inherits(n,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,i=baidu.editor.ui.SplitButton,n=baidu.editor.ui.MultiMenuPop=function(e){this.initOptions(e);this.initMultiMenu()};n.prototype={initMultiMenu:function(){var e=this;this.popup=new t({content:"",editor:e.editor,iframe_rendered:false,onshow:function(){if(!this.iframe_rendered){this.iframe_rendered=true;this.getDom("content").innerHTML='<iframe id="'+e.id+'_iframe" src="'+e.iframeUrl+'" frameborder="0"></iframe>';e.editor.container.style.zIndex&&(this.getDom().style.zIndex=e.editor.container.style.zIndex*1+1)}}});this.onbuttonclick=function(){this.showPopup()};this.initSplitButton()}};e.inherits(n,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.Breakline=function(e){this.initOptions(e);this.initSeparator()};i.prototype={uiName:"Breakline",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return"<br/>"}};e.inherits(i,t)})();(function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,i=baidu.editor.ui.UIBase,n=baidu.editor.ui.Message=function(e){this.initOptions(e);this.initMessage()};n.prototype={initMessage:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-message %%">'+' <div id="##_closer" class="edui-message-closer">×</div>'+' <div id="##_body" class="edui-message-body edui-message-type-info">'+' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe>'+' <div class="edui-shadow"></div>'+' <div id="##_content" class="edui-message-content">'+"  </div>"+" </div>"+"</div>"},reset:function(e){var t=this;if(!e.keepshow){clearTimeout(this.timer);t.timer=setTimeout(function(){t.hide()},e.timeout||4e3)}e.content!==undefined&&t.setContent(e.content);e.type!==undefined&&t.setType(e.type);t.show()},postRender:function(){var e=this,i=this.getDom("closer");i&&t.on(i,"click",function(){e.hide()})},setContent:function(e){this.getDom("content").innerHTML=e},setType:function(e){e=e||"info";var t=this.getDom("body");t.className=t.className.replace(/edui-message-type-[\w-]+/,"edui-message-type-"+e)},getContent:function(){return this.getDom("content").innerHTML},getType:function(){var e=this.getDom("body").match(/edui-message-type-([\w-]+)/);return e?e[1]:""},show:function(){this.getDom().style.display="block"},hide:function(){var e=this.getDom();if(e){e.style.display="none";e.parentNode&&e.parentNode.removeChild(e)}}};e.inherits(n,i)})();(function(){var e=baidu.editor.utils;var t=baidu.editor.ui;var i=t.Dialog;t.buttons={};t.Dialog=function(e){var t=new i(e);t.addListener("hide",function(){if(t.editor){var e=t.editor;try{if(browser.gecko){var i=e.window.scrollY,n=e.window.scrollX;e.body.focus();e.window.scrollTo(n,i)}else{e.focus()}}catch(e){}}});return t};var n={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",map:"~/dialogs/map/map.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",preview:"~/dialogs/preview/preview.html",emotion:"~/dialogs/emotion/emotion.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html"};var r=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable","drafts","insertpbefore","insertpafter"];for(var o=0,a;a=r[o++];){a=a.toLowerCase();t[a]=function(e){return function(i){var n=new t.Button({className:"edui-for-"+e,title:i.options.labelMap[e]||i.getLang("labelMap."+e)||"",onclick:function(){i.execCommand(e)},theme:i.options.theme,showText:false});t.buttons[e]=n;i.addListener("selectionchange",function(t,r,o){var a=i.queryCommandState(e);if(a==-1){n.setDisabled(true);n.setChecked(false)}else{if(!o){n.setDisabled(false);n.setChecked(a)}}});return n}}(a)}var s={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var l in s){(function(e,i){for(var n=0,r;r=i[n++];){(function(i){t[e.replace("float","")+i]=function(n){var r=new t.Button({className:"edui-for-"+e.replace("float","")+i,title:n.options.labelMap[e.replace("float","")+i]||n.getLang("labelMap."+e.replace("float","")+i)||"",theme:n.options.theme,onclick:function(){n.execCommand(e,i)}});t.buttons[e]=r;n.addListener("selectionchange",function(t,o,a){r.setDisabled(n.queryCommandState(e)==-1);r.setChecked(n.queryCommandValue(e)==i&&!a)});return r}})(r)}})(l,s[l])}for(var o=0,a;a=["backcolor","forecolor"][o++];){t[a]=function(e){return function(i){var n=new t.ColorButton({className:"edui-for-"+e,color:"default",title:i.options.labelMap[e]||i.getLang("labelMap."+e)||"",editor:i,onpickcolor:function(t,n){i.execCommand(e,n)},onpicknocolor:function(){i.execCommand(e,"default");this.setColor("transparent");this.color="default"},onbuttonclick:function(){i.execCommand(e,this.color)}});t.buttons[e]=n;i.addListener("selectionchange",function(){n.setDisabled(i.queryCommandState(e)==-1)});return n}}(a)}var d={noOk:["help","spechars","preview"],ok:["attachment","anchor","link","insertimage","map","insertframe","insertvideo","insertframe","edittip","edittable","edittd","background","phpokinfo"]};for(var l in d){(function(i,r){for(var o=0,a;a=r[o++];){(function(r){t[r]=function(o,a,s){a=a||(o.options.iframeUrlMap||{})[r]||n[r];s=o.options.labelMap[r]||o.getLang("labelMap."+r)||"";var l;if(a){l=new t.Dialog(e.extend({iframeUrl:o.ui.mapUrl(a),editor:o,className:"edui-for-"+r,title:s,holdScroll:r==="insertimage",fullscreen:/charts|preview/.test(r),closeDialog:o.getLang("closeDialog")},i=="ok"?{buttons:[{className:"edui-okbutton",label:o.getLang("ok"),editor:o,onclick:function(){l.close(true)}},{className:"edui-cancelbutton",label:o.getLang("cancel"),editor:o,onclick:function(){l.close(false)}}]}:{}));o.ui._dialogs[r+"Dialog"]=l}var d=new t.Button({className:"edui-for-"+r,title:s,onclick:function(){if(l){switch(r){default:l.render();l.open()}}},theme:o.options.theme,disabled:r=="scrawl"&&o.queryCommandState("scrawl")==-1||r=="charts"});t.buttons[r]=d;o.addListener("selectionchange",function(){var e={edittable:1};if(r in e)return;var t=o.queryCommandState(r);if(d.getDom()){d.setDisabled(t==-1);d.setChecked(t)}});return d}})(a.toLowerCase())}})(l,d[l])}t.insertcode=function(i,n,r){n=i.options["insertcode"]||[];r=i.options.labelMap["insertcode"]||i.getLang("labelMap.insertcode")||"";var o=[];e.each(n,function(e,t){o.push({label:e,value:t,theme:i.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"</div>"}})});var a=new t.Combox({editor:i,items:o,onselect:function(e,t){i.execCommand("insertcode",this.items[t].value)},onbuttonclick:function(){this.showPopup()},title:r,initValue:r,className:"edui-for-insertcode",indexByValue:function(e){if(e){for(var t=0,i;i=this.items[t];t++){if(i.value.indexOf(e)!=-1)return t}}return-1}});t.buttons["insertcode"]=a;i.addListener("selectionchange",function(e,t,n){if(!n){
var o=i.queryCommandState("insertcode");if(o==-1){a.setDisabled(true)}else{a.setDisabled(false);var s=i.queryCommandValue("insertcode");if(!s){a.setValue(r);return}s&&(s=s.replace(/['"]/g,"").split(",")[0]);a.setValue(s)}}});return a};t.fontfamily=function(i,n,r){n=i.options["fontfamily"]||[];r=i.options.labelMap["fontfamily"]||i.getLang("labelMap.fontfamily")||"";if(!n.length)return;for(var o=0,a,s=[];a=n[o];o++){var l=i.getLang("fontfamily")[a.name]||"";(function(t,n){s.push({label:t,value:n,theme:i.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+e.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})})(a.label||l,a.val)}var d=new t.Combox({editor:i,items:s,onselect:function(e,t){i.execCommand("FontFamily",this.items[t].value)},onbuttonclick:function(){this.showPopup()},title:r,initValue:r,className:"edui-for-fontfamily",indexByValue:function(e){if(e){for(var t=0,i;i=this.items[t];t++){if(i.value.indexOf(e)!=-1)return t}}return-1}});t.buttons["fontfamily"]=d;i.addListener("selectionchange",function(e,t,n){if(!n){var r=i.queryCommandState("FontFamily");if(r==-1){d.setDisabled(true)}else{d.setDisabled(false);var o=i.queryCommandValue("FontFamily");o&&(o=o.replace(/['"]/g,"").split(",")[0]);d.setValue(o)}}});return d};t.fontsize=function(e,i,n){n=e.options.labelMap["fontsize"]||e.getLang("labelMap.fontsize")||"";i=i||e.options["fontsize"]||[];if(!i.length)return;var r=[];for(var o=0;o<i.length;o++){var a=i[o]+"px";r.push({label:a,value:a,theme:e.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var s=new t.Combox({editor:e,items:r,title:n,initValue:n,onselect:function(t,i){e.execCommand("FontSize",this.items[i].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});t.buttons["fontsize"]=s;e.addListener("selectionchange",function(t,i,n){if(!n){var r=e.queryCommandState("FontSize");if(r==-1){s.setDisabled(true)}else{s.setDisabled(false);s.setValue(e.queryCommandValue("FontSize"))}}});return s};t.paragraph=function(i,n,r){r=i.options.labelMap["paragraph"]||i.getLang("labelMap.paragraph")||"";n=i.options["paragraph"]||[];if(e.isEmptyObject(n))return;var o=[];for(var a in n){o.push({value:a,label:n[a]||i.getLang("paragraph")[a],theme:i.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}})}var s=new t.Combox({editor:i,items:o,title:r,initValue:r,className:"edui-for-paragraph",onselect:function(e,t){i.execCommand("Paragraph",this.items[t].value)},onbuttonclick:function(){this.showPopup()}});t.buttons["paragraph"]=s;i.addListener("selectionchange",function(e,t,n){if(!n){var r=i.queryCommandState("Paragraph");if(r==-1){s.setDisabled(true)}else{s.setDisabled(false);var o=i.queryCommandValue("Paragraph");var a=s.indexByValue(o);if(a!=-1){s.setValue(o)}else{s.setValue(s.initValue)}}}});return s};t.customstyle=function(e){var i=e.options["customstyle"]||[],n=e.options.labelMap["customstyle"]||e.getLang("labelMap.customstyle")||"";if(!i.length)return;var r=e.getLang("customstyle");for(var o=0,a=[],s;s=i[o++];){(function(t){var i={};i.label=t.label?t.label:r[t.name];i.style=t.style;i.className=t.className;i.tag=t.tag;a.push({label:i.label,value:i,theme:e.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label">'+"<"+i.tag+" "+(i.className?' class="'+i.className+'"':"")+(i.style?' style="'+i.style+'"':"")+">"+i.label+"</"+i.tag+">"+"</div>"}})})(s)}var l=new t.Combox({editor:e,items:a,title:n,initValue:n,className:"edui-for-customstyle",onselect:function(t,i){e.execCommand("customstyle",this.items[i].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(e){for(var t=0,i;i=this.items[t++];){if(i.label==e){return t-1}}return-1}});t.buttons["customstyle"]=l;e.addListener("selectionchange",function(t,i,n){if(!n){var r=e.queryCommandState("customstyle");if(r==-1){l.setDisabled(true)}else{l.setDisabled(false);var o=e.queryCommandValue("customstyle");var a=l.indexByValue(o);if(a!=-1){l.setValue(o)}else{l.setValue(l.initValue)}}}});return l};t.inserttable=function(e,i,n){n=e.options.labelMap["inserttable"]||e.getLang("labelMap.inserttable")||"";var r=new t.TableButton({editor:e,title:n,className:"edui-for-inserttable",onpicktable:function(t,i,n){e.execCommand("InsertTable",{numRows:n,numCols:i,border:1})},onbuttonclick:function(){this.showPopup()}});t.buttons["inserttable"]=r;e.addListener("selectionchange",function(){r.setDisabled(e.queryCommandState("inserttable")==-1)});return r};t.lineheight=function(e){var i=e.options.lineheight||[];if(!i.length)return;for(var n=0,r,o=[];r=i[n++];){o.push({label:r,value:r,theme:e.options.theme,onclick:function(){e.execCommand("lineheight",this.value)}})}var a=new t.MenuButton({editor:e,className:"edui-for-lineheight",title:e.options.labelMap["lineheight"]||e.getLang("labelMap.lineheight")||"",items:o,onbuttonclick:function(){var t=e.queryCommandValue("LineHeight")||this.value;e.execCommand("LineHeight",t)}});t.buttons["lineheight"]=a;e.addListener("selectionchange",function(){var t=e.queryCommandState("LineHeight");if(t==-1){a.setDisabled(true)}else{a.setDisabled(false);var i=e.queryCommandValue("LineHeight");i&&a.setValue((i+"").replace(/cm/,""));a.setChecked(t)}});return a};var u=["top","bottom"];for(var c=0,f;f=u[c++];){(function(e){t["rowspacing"+e]=function(i){var n=i.options["rowspacing"+e]||[];if(!n.length)return null;for(var r=0,o,a=[];o=n[r++];){a.push({label:o,value:o,theme:i.options.theme,onclick:function(){i.execCommand("rowspacing",this.value,e)}})}var s=new t.MenuButton({editor:i,className:"edui-for-rowspacing"+e,title:i.options.labelMap["rowspacing"+e]||i.getLang("labelMap.rowspacing"+e)||"",items:a,onbuttonclick:function(){var t=i.queryCommandValue("rowspacing",e)||this.value;i.execCommand("rowspacing",t,e)}});t.buttons[e]=s;i.addListener("selectionchange",function(){var t=i.queryCommandState("rowspacing",e);if(t==-1){s.setDisabled(true)}else{s.setDisabled(false);var n=i.queryCommandValue("rowspacing",e);n&&s.setValue((n+"").replace(/%/,""));s.setChecked(t)}});return s}})(f)}var m=["insertorderedlist","insertunorderedlist"];for(var h=0,p;p=m[h++];){(function(e){t[e]=function(i){var n=i.options[e],r=function(){i.execCommand(e,this.value)},o=[];for(var a in n){o.push({label:n[a]||i.getLang()[e][a]||"",value:a,theme:i.options.theme,onclick:r})}var s=new t.MenuButton({editor:i,className:"edui-for-"+e,title:i.getLang("labelMap."+e)||"",items:o,onbuttonclick:function(){var t=i.queryCommandValue(e)||this.value;i.execCommand(e,t)}});t.buttons[e]=s;i.addListener("selectionchange",function(){var t=i.queryCommandState(e);if(t==-1){s.setDisabled(true)}else{s.setDisabled(false);var n=i.queryCommandValue(e);s.setValue(n);s.setChecked(t)}});return s}})(p)}t.fullscreen=function(e,i){i=e.options.labelMap["fullscreen"]||e.getLang("labelMap.fullscreen")||"";var n=new t.Button({className:"edui-for-fullscreen",title:i,theme:e.options.theme,onclick:function(){if(e.ui){e.ui.setFullScreen(!e.ui.isFullScreen())}this.setChecked(e.ui.isFullScreen())}});t.buttons["fullscreen"]=n;e.addListener("selectionchange",function(){var t=e.queryCommandState("fullscreen");n.setDisabled(t==-1);n.setChecked(e.ui.isFullScreen())});return n};t["emotion"]=function(e,i){var r="emotion";var o=new t.MultiMenuPop({title:e.options.labelMap[r]||e.getLang("labelMap."+r+"")||"",editor:e,className:"edui-for-"+r,iframeUrl:e.ui.mapUrl(i||(e.options.iframeUrlMap||{})[r]||n[r])});t.buttons[r]=o;e.addListener("selectionchange",function(){o.setDisabled(e.queryCommandState(r)==-1)});return o};t["simpleupload"]=function(e){var i="simpleupload",n=new t.Button({className:"edui-for-"+i,title:e.options.labelMap[i]||e.getLang("labelMap."+i)||"",onclick:function(){},theme:e.options.theme,showText:false});t.buttons[i]=n;e.addListener("ready",function(){var t=n.getDom("body"),i=t.children[0];e.fireEvent("simpleuploadbtnready",i)});e.addListener("selectionchange",function(t,r,o){var a=e.queryCommandState(i);if(a==-1){n.setDisabled(true);n.setChecked(false)}else{if(!o){n.setDisabled(false);n.setChecked(a)}}});return n}})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,i=baidu.editor.ui.UIBase,n=baidu.editor.dom.domUtils;var r=[];function o(e){this.initOptions(e);this.initEditorUI()}o.prototype={uiName:"editor",initEditorUI:function(){this.editor.ui=this;this._dialogs={};this.initUIBase();this._initToolbars();var e=this.editor,t=this;e.addListener("ready",function(){e.getDialog=function(t){return e.ui._dialogs[t+"Dialog"]};n.on(e.window,"scroll",function(e){baidu.editor.ui.Popup.postHide(e)});e.ui._actualFrameWidth=e.options.initialFrameWidth;UE.browser.ie&&UE.browser.version===6&&e.container.ownerDocument.execCommand("BackgroundImageCache",false,true);if(e.options.elementPathEnabled){e.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+e.getLang("elementPathTip")+":</div>"}if(e.options.wordCount){function i(){a(e,t);n.un(e.document,"click",arguments.callee)}n.on(e.document,"click",i);e.ui.getDom("wordcount").innerHTML=e.getLang("wordCountTip")}e.ui._scale();if(e.options.scaleEnabled){if(e.autoHeightEnabled){e.disableAutoHeight()}t.enableScale()}else{t.disableScale()}if(!e.options.elementPathEnabled&&!e.options.wordCount&&!e.options.scaleEnabled){e.ui.getDom("elementpath").style.display="none";e.ui.getDom("wordcount").style.display="none";e.ui.getDom("scale").style.display="none"}if(!e.selection.isFocus())return;e.fireEvent("selectionchange",false,true)});e.addListener("mousedown",function(e,t){var i=t.target||t.srcElement;baidu.editor.ui.Popup.postHide(t,i)});e.addListener("delcells",function(){if(UE.ui["edittip"]){new UE.ui["edittip"](e)}e.getDialog("edittip").open()});var i,r=false,o;e.addListener("afterpaste",function(){if(e.queryCommandState("pasteplain"))return;if(baidu.editor.ui.PastePicker){i=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:e}),editor:e,className:"edui-wordpastepop"});i.render()}r=true});e.addListener("afterinserthtml",function(){clearTimeout(o);o=setTimeout(function(){if(i&&(r||e.ui._isTransfer)){if(i.isHidden()){var t=n.createElement(e.document,"span",{style:"line-height:0px;",innerHTML:"\ufeff"}),o=e.selection.getRange();o.insertNode(t);var a=getDomNode(t,"firstChild","previousSibling");a&&i.showAnchor(a.nodeType==3?a.parentNode:a);n.remove(t)}else{i.show()}delete e.ui._isTransfer;r=false}},200)});e.addListener("contextmenu",function(e,t){baidu.editor.ui.Popup.postHide(t)});e.addListener("keydown",function(e,t){if(i)i.dispose(t);var n=t.keyCode||t.which;if(t.altKey&&n==90){UE.ui.buttons["fullscreen"].onclick()}});e.addListener("wordcount",function(e){a(this,t)});function a(e,t){e.setOpt({wordCount:true,maximumWords:1e4,wordCountMsg:e.options.wordCountMsg||e.getLang("wordCountMsg"),wordOverFlowMsg:e.options.wordOverFlowMsg||e.getLang("wordOverFlowMsg")});var i=e.options,n=i.maximumWords,r=i.wordCountMsg,o=i.wordOverFlowMsg,a=t.getDom("wordcount");if(!i.wordCount){return}var s=e.getContentLength(true);if(s>n){a.innerHTML=o;e.fireEvent("wordcountoverflow")}else{a.innerHTML=r.replace("{#leave}",n-s).replace("{#count}",s)}}e.addListener("selectionchange",function(){if(e.options.elementPathEnabled){t[(e.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"]()}if(e.options.scaleEnabled){t[(e.queryCommandState("scale")==-1?"dis":"en")+"ableScale"]()}});var s=new baidu.editor.ui.Popup({editor:e,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide();e.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(t){this.hide();e.ui._dialogs[t]&&e.ui._dialogs[t].open()},_onImgSetFloat:function(t){this.hide();e.execCommand("imagefloat",t)},_setIframeAlign:function(e){var t=s.anchorEl;var i=t.cloneNode(true);switch(e){case-2:i.setAttribute("align","");break;case-1:i.setAttribute("align","left");break;case 1:i.setAttribute("align","right");break}t.parentNode.insertBefore(i,t);n.remove(t);s.anchorEl=i;s.showAnchor(s.anchorEl)},_updateIframe:function(){var t=e._iframe=s.anchorEl;if(n.hasClass(t,"ueditor_baidumap")){e.selection.getRange().selectNode(t).select();e.ui._dialogs.mapDialog.open();s.hide()}else{e.ui._dialogs.insertframeDialog.open();s.hide()}},_onRemoveButtonClick:function(t){e.execCommand(t);this.hide()},queryAutoHide:function(t){if(t&&t.ownerDocument==e.document){if(t.tagName.toLowerCase()=="img"||n.findParentByTagName(t,"a",true)){return t!==s.anchorEl}}return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,t)}});s.render();if(e.options.imagePopup){e.addListener("mouseover",function(t,i){i=i||window.event;var n=i.target||i.srcElement;if(e.ui._dialogs.insertframeDialog&&/iframe/gi.test(n.tagName)){var r=s.formatHtml("<nobr>"+e.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+e.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+e.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+e.getLang("justifyright")+"</span>&nbsp;&nbsp;"+' <span onclick="$$._updateIframe( this);" class="edui-clickable">'+e.getLang("modify")+"</span></nobr>");if(r){s.getDom("content").innerHTML=r;s.anchorEl=n;s.showAnchor(s.anchorEl)}else{s.hide()}}});e.addListener("selectionchange",function(t,i){if(!i)return;var r="",o="",a=e.selection.getRange().getClosedNode(),l=e.ui._dialogs;if(a&&a.tagName=="IMG"){var d="insertimageDialog";if(a.className.indexOf("edui-faked-video")!=-1||a.className.indexOf("edui-upload-video")!=-1){d="insertvideoDialog"}if(a.src.indexOf("http://api.map.baidu.com")!=-1){d="mapDialog"}if(a.className.indexOf("edui-faked-music")!=-1){d="musicDialog"}if(a.getAttribute("anchorname")){d="anchorDialog";r=s.formatHtml("<nobr>"+e.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+e.getLang("modify")+"</span>&nbsp;&nbsp;"+"<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+e.getLang("delete")+"</span></nobr>")}if(a.getAttribute("word_img")){e.word_img=[a.getAttribute("word_img")];d="wordimageDialog"}if(n.hasClass(a,"loadingclass")||n.hasClass(a,"loaderrorclass")){d=""}if(!l[d]){return}o="<nobr>"+e.getLang("property")+": "+'<span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+e.getLang("default")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+e.getLang("justifyleft")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+e.getLang("justifyright")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+e.getLang("justifycenter")+"</span>&nbsp;&nbsp;"+"<span onclick=\"$$._onImgEditButtonClick('"+d+'\');" class="edui-clickable">'+e.getLang("modify")+"</span></nobr>";!r&&(r=s.formatHtml(o))}if(e.ui._dialogs.linkDialog){var u=e.queryCommandValue("link");var c;if(u&&(c=u.getAttribute("_href")||u.getAttribute("href",2))){var f=c;if(c.length>30){f=c.substring(0,20)+"..."}if(r){r+='<div style="height:5px;"></div>'}r+=s.formatHtml("<nobr>"+e.getLang("anthorMsg")+': <a target="_blank" href="'+c+'" title="'+c+'" >'+f+"</a>"+' <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+e.getLang("modify")+"</span>"+' <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+e.getLang("clear")+"</span></nobr>");s.showAnchor(u)}}if(r){s.getDom("content").innerHTML=r;s.anchorEl=a||u;s.showAnchor(s.anchorEl)}else{s.hide()}})}},_initToolbars:function(){var t=this.editor;var i=this.toolbars||[];var n=[];for(var r=0;r<i.length;r++){var o=i[r];var a=new baidu.editor.ui.Toolbar({theme:t.options.theme});for(var s=0;s<o.length;s++){var l=o[s];var d=null;if(typeof l=="string"){l=l.toLowerCase();if(l=="|"){l="Separator"}if(l=="||"){l="Breakline"}if(baidu.editor.ui[l]){d=new baidu.editor.ui[l](t)}if(l=="fullscreen"){if(n&&n[0]){n[0].items.splice(0,0,d)}else{d&&a.items.splice(0,0,d)}continue}}else{d=l}if(d&&d.id){a.add(d)}}n[r]=a}e.each(UE._customizeUI,function(e,i){var n,r;if(e.id&&e.id!=t.key){return false}n=e.execFn.call(t,t,i);if(n){r=e.index;if(r===undefined){r=a.items.length}a.add(n,r)}});this.toolbars=n},getHtmlTpl:function(){return'<div id="##" class="%%">'+'<div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;">'+'<div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+"</div>"+'<div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div>'+'<div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div>'+'<div style="height:0;overflow:hidden;clear:both;"></div>'+"</div>"+'<div id="##_message_holder" class="%%-messageholder"></div>'+"</div>"+'<div id="##_iframeholder" class="%%-iframeholder">'+"</div>"+'<div id="##_bottombar" class="%%-bottomContainer"><table><tr>'+'<td id="##_elementpath" class="%%-bottombar"></td>'+'<td id="##_wordcount" class="%%-wordcount"></td>'+'<td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td>'+"</tr></table></div>"+'<div id="##_scalelayer"></div>'+"</div>"},showWordImageDialog:function(){this._dialogs["wordimageDialog"].open()},renderToolbarBoxHtml:function(){var e=[];for(var t=0;t<this.toolbars.length;t++){e.push(this.toolbars[t].renderHtml())}return e.join("")},setFullScreen:function(e){var t=this.editor,i=t.container.parentNode.parentNode;if(this._fullscreen!=e){this._fullscreen=e;this.editor.fireEvent("beforefullscreenchange",e);if(baidu.editor.browser.gecko){var n=t.selection.getRange().createBookmark()}if(e){while(i.tagName!="BODY"){var o=baidu.editor.dom.domUtils.getComputedStyle(i,"position");r.push(o);i.style.position="static";i=i.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow;this._bakBodyOverflow=document.body.style.overflow;this._bakAutoHeight=this.editor.autoHeightEnabled;this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop);this._bakEditorContaninerWidth=t.iframe.parentNode.offsetWidth;if(this._bakAutoHeight){t.autoHeightEnabled=false;this.editor.disableAutoHeight()}document.documentElement.style.overflow="hidden";window.scrollTo(0,window.scrollY);this._bakCssText=this.getDom().style.cssText;this._bakCssText1=this.getDom("iframeholder").style.cssText;t.iframe.parentNode.style.width="";this._updateFullScreen()}else{while(i.tagName!="BODY"){i.style.position=r.shift();i=i.parentNode}this.getDom().style.cssText=this._bakCssText;this.getDom("iframeholder").style.cssText=this._bakCssText1;if(this._bakAutoHeight){t.autoHeightEnabled=true;this.editor.enableAutoHeight()}document.documentElement.style.overflow=this._bakHtmlOverflow;document.body.style.overflow=this._bakBodyOverflow;t.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px";window.scrollTo(0,this._bakScrollTop)}if(browser.gecko&&t.body.contentEditable==="true"){var a=document.createElement("input");document.body.appendChild(a);t.body.contentEditable=false;setTimeout(function(){a.focus();setTimeout(function(){t.body.contentEditable=true;t.fireEvent("fullscreenchanged",e);t.selection.getRange().moveToBookmark(n).select(true);baidu.editor.dom.domUtils.remove(a);e&&window.scroll(0,0)},0)},0)}if(t.body.contentEditable==="true"){this.editor.fireEvent("fullscreenchanged",e);this.triggerLayout()}}},_updateFullScreen:function(){if(this._fullscreen){var e=t.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+e.width+"px;height:"+e.height+"px;z-index:"+(this.getDom().style.zIndex*1+100);t.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0});this.editor.setHeight(e.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0),true);if(browser.gecko){try{window.onresize()}catch(e){}}}},_updateElementPath:function(){var e=this.getDom("elementpath"),t;if(this.elementPathEnabled&&(t=this.editor.queryCommandValue("elementpath"))){var i=[];for(var n=0,r;r=t[n];n++){i[n]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+n+'&quot;);">'+r+"</span>")}e.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+i.join(" &gt; ")+"</div>"}else{e.style.display="none"}},disableElementPath:function(){var e=this.getDom("elementpath");e.innerHTML="";e.style.display="none";this.elementPathEnabled=false},enableElementPath:function(){var e=this.getDom("elementpath");e.style.display="";this.elementPathEnabled=true;this._updateElementPath()},_scale:function(){var e=document,t=this.editor,i=t.container,r=t.document,o=this.getDom("toolbarbox"),a=this.getDom("bottombar"),s=this.getDom("scale"),l=this.getDom("scalelayer");var d=false,u=null,c=0,f=t.options.minFrameWidth,m=0,h=0,p=0,g=0;function v(){u=n.getXY(i);if(!c){c=t.options.minFrameHeight+o.offsetHeight+a.offsetHeight}l.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+i.offsetWidth+"px;height:"+i.offsetHeight+"px;z-index:"+(t.options.zIndex+1);n.on(e,"mousemove",y);n.on(r,"mouseup",C);n.on(e,"mouseup",C)}var b=this;this.editor.addListener("fullscreenchanged",function(e,t){if(t){b.disableScale()}else{if(b.editor.options.scaleEnabled){b.enableScale();var i=b.editor.document.createElement("span");b.editor.body.appendChild(i);b.editor.body.style.height=Math.max(n.getXY(i).y,b.editor.iframe.offsetHeight-20)+"px";n.remove(i)}}});function y(t){w();var i=t||window.event;m=i.pageX||e.documentElement.scrollLeft+i.clientX;h=i.pageY||e.documentElement.scrollTop+i.clientY;p=m-u.x;g=h-u.y;if(p>=f){d=true;l.style.width=p+"px"}if(g>=c){d=true;l.style.height=g+"px"}}function C(){if(d){d=false;t.ui._actualFrameWidth=l.offsetWidth-2;i.style.width=t.ui._actualFrameWidth+"px";t.setHeight(l.offsetHeight-a.offsetHeight-o.offsetHeight-2,true)}if(l){l.style.display="none"}w();n.un(e,"mousemove",y);n.un(r,"mouseup",C);n.un(e,"mouseup",C)}function w(){if(browser.ie)e.selection.clear();else window.getSelection().removeAllRanges()}this.enableScale=function(){if(t.queryCommandState("source")==1)return;s.style.display="";this.scaleEnabled=true;n.on(s,"mousedown",v)};this.disableScale=function(){s.style.display="none";this.scaleEnabled=false;n.un(s,"mousedown",v)}},isFullScreen:function(){return this._fullscreen},postRender:function(){i.prototype.postRender.call(this);for(var e=0;e<this.toolbars.length;e++){this.toolbars[e].postRender()}var t=this;var n,r=baidu.editor.dom.domUtils,o=function(){clearTimeout(n);n=setTimeout(function(){t._updateFullScreen()})};r.on(window,"resize",o);t.addListener("destroy",function(){r.un(window,"resize",o);clearTimeout(n)})},showToolbarMsg:function(e,t){this.getDom("toolbarmsg_label").innerHTML=e;this.getDom("toolbarmsg").style.display="";if(!t){var i=this.getDom("upload_dialog");i.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(e){return e?e.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var e=this.getDom();if(e.style.zoom=="1"){e.style.zoom="100%"}else{e.style.zoom="1"}}};e.inherits(o,baidu.editor.ui.UIBase);var a={};UE.ui.Editor=function(t){var i=new UE.Editor(t);i.options.editor=i;e.loadFile(document,{href:i.options.themePath+i.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var r=i.render;i.render=function(t){if(t.constructor===String){i.key=t;a[t]=i}e.domReady(function(){i.langIsReady?e():i.addListener("langReady",e);function e(){i.setOpt({labelMap:i.options.labelMap||i.getLang("labelMap")});new o(i.options);if(t){if(t.constructor===String){t=document.getElementById(t)}t&&t.getAttribute("name")&&(i.options.textarea=t.getAttribute("name"));if(t&&/script|textarea/gi.test(t.tagName)){var e=document.createElement("div");t.parentNode.insertBefore(e,t);var a=t.value||t.innerHTML;i.options.initialContent=/^[\t\r\n ]*$/.test(a)?i.options.initialContent:a.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><");t.className&&(e.className=t.className);t.style.cssText&&(e.style.cssText=t.style.cssText);if(/textarea/i.test(t.tagName)){i.textarea=t;i.textarea.style.display="none"}else{t.parentNode.removeChild(t)}if(t.id){e.id=t.id;n.removeAttributes(t,"id")}t=e;t.innerHTML=""}}n.addClass(t,"edui-"+i.options.theme);i.ui.render(t);var s=i.options;i.container=i.ui.getDom();var l=n.findParents(t,true);var d=[];for(var u=0,c;c=l[u];u++){d[u]=c.style.display;c.style.display="block"}if(s.initialFrameWidth){s.minFrameWidth=s.initialFrameWidth}else{s.minFrameWidth=s.initialFrameWidth=t.offsetWidth;var f=t.style.width;if(/%$/.test(f)){s.initialFrameWidth=f}}if(s.initialFrameHeight){s.minFrameHeight=s.initialFrameHeight}else{s.initialFrameHeight=s.minFrameHeight=t.offsetHeight}for(var u=0,c;c=l[u];u++){c.style.display=d[u]}if(t.style.height){t.style.height=""}i.container.style.width=s.initialFrameWidth+(/%$/.test(s.initialFrameWidth)?"":"px");i.container.style.zIndex=s.zIndex;r.call(i,i.ui.getDom("iframeholder"));i.fireEvent("afteruiready")}})};return i};UE.getEditor=function(e,t){var i=a[e];if(!i){i=a[e]=new UE.ui.Editor(t);i.render(e)}return i};UE.delEditor=function(e){var t;if(t=a[e]){t.key&&t.destroy();delete a[e]}};UE.registerUI=function(t,i,n,r){e.each(t.split(/\s+/),function(e){UE._customizeUI[e]={id:r,execFn:i,index:n}})}})();UE.registerUI("message",function(e){var t=baidu.editor.ui;var i=t.Message;var n;var r=[];var o=e;o.addListener("ready",function(){n=document.getElementById(o.ui.id+"_message_holder");a();setTimeout(function(){a()},500)});o.addListener("showmessage",function(e,t){t=utils.isString(t)?{content:t}:t;var s=new i({timeout:t.timeout,type:t.type,content:t.content,keepshow:t.keepshow,editor:o}),l=t.id||"msg_"+(+new Date).toString(36);s.render(n);r[l]=s;s.reset(t);a();return l});o.addListener("updatemessage",function(e,t,i){i=utils.isString(i)?{content:i}:i;var o=r[t];o.render(n);o&&o.reset(i)});o.addListener("hidemessage",function(e,t){var i=r[t];i&&i.hide()});function a(){var e=o.ui.getDom("toolbarbox");if(e){n.style.top=e.offsetHeight+3+"px"}n.style.zIndex=Math.max(o.options.zIndex,o.iframe.style.zIndex)+1}})})();